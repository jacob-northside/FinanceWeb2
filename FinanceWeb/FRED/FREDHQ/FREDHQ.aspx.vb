Imports System
Imports System.IO
Imports System.Xml
Imports System.Data
Imports System.Data.SqlClient
Imports System.DirectoryServices
Imports System.Web
Imports System.Web.UI.HtmlControls
Imports DocumentFormat.OpenXml

Imports System.Configuration
Imports System.Collections
Imports System.Web.Security
Imports System.Web.UI
Imports System.Web.UI.WebControls
Imports System.Web.UI.WebControls.WebParts

Imports FinanceWeb.WebFinGlobal

Public Class FREDHQ
    Inherits System.Web.UI.Page
    Dim SQL, SQL2, SQL3 As String
    Dim conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    Dim cmd, cmd2, cmdquery As SqlCommand
    Dim cmdNS1 As SqlCommand
    Dim dr As SqlDataReader
    Public SQLArray() As String
    Public FREDData As SqlDataSource
    Public Shared doctor As DataRow
    Public Shared favorite As Boolean
    'Public Shared accordionstatus As Integer
    Public Shared FilterSet As New DataSet
    Public Shared FilterSet2 As New DataSet
    Public Shared qr As DataRow
    Public Shared Palette As New DataTable
    Public Shared rbltesting As Integer
    Public Shared timestamp As String = ""


    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        'Try
        If IsPostBack Then
            Page.Form.DefaultButton = btnRunReport.UniqueID
            CheckFavorite()
            If favorite Then
                lblFavoriteNameActive.Visible = True
                lblFavoriteNameActive2.Visible = True
            Else
                lblFavoriteNameActive.Visible = False
                lblFavoriteNameActive2.Visible = False
            End If


            'If rbltesting < 4 Then
            '    ExportExample()
            'End If
            'rbltesting = 4

            'If acrFREDFilter.SelectedIndex <> accordionstatus Then
            'RecalculateNumbers()
            'accordionstatus = acrFREDFilter.SelectedIndex
            'End If
        Else
            'accordionstatus = acrFREDFilter.SelectedIndex
            CostingCheck()
            'SetFREDSelectAccordion(0)

            Try
                Dim ds As DataSet
                Dim da As New SqlDataAdapter
                ddlFREDTables.Visible = True

                Dim Costing As String
                Dim PHI As String
                Dim Financial As String
                Dim BO_Financial As String

                If lblCosting.Text = "" Then
                    Costing = "0"
                Else
                    Costing = "0,1"
                End If

                If lblPHI.Text = "" Then
                    PHI = "0"
                Else
                    PHI = "0,1"
                End If

                If lblFinancial.Text = "" Then
                    Financial = "0"
                Else
                    Financial = "0,1"
                End If

                If lblBO_Financial.Text = "" Then
                    BO_Financial = "0"
                Else
                    BO_Financial = "0,1"
                End If

                SQL = "select distinct FREDType, Table_Alias, TABLE_ID " & _
            " from WebFD.FRED.vw_AvailableData " & _
            " where FREDType <> 0 " & _
            " and Costing in (" & Costing & ") " & _
            " and PHI in (" & PHI & ") " & _
            " and Financial in (" & Financial & ") " & _
            " and BO_Financial in (" & BO_Financial & ") " & _
            " order by 1 desc, 2 "



                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    ds = New DataSet
                    cmd = New SqlCommand(SQL, conn)
                    da.SelectCommand = cmd
                    da.SelectCommand.CommandTimeout = 86400
                    da.Fill(ds, "FRED")

                    ddlFREDTables.DataSource = ds
                    ddlFREDTables.DataMember = "FRED"
                    ddlFREDTables.DataTextField = "Table_Alias"
                    ddlFREDTables.DataValueField = "TABLE_ID"
                    ddlFREDTables.DataBind()
                End Using

            Catch ex As Exception
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            End Try

            CreateColorPalette()
            ddlFREDTables.SelectedIndex = 0
            SetFREDSelectAccordion(ddlFREDTables.SelectedValue)
            acrFREDSelectTrans.Visible = False
            ddlFREDTables.Visible = False
            rblDataType.SelectedIndex = 0
            'FREDReportType(0)
            LoadFREDFreeFilters()
            rbltesting = 4
            ResetFREDFilters()
            'acrFREDSelect.
            'pnlEncounterChk
            FillForcedColumnddl()


            Dim getfavorite As String
            Dim favoriteinfo As New DataSet


            getfavorite = "SELECT [FavoriteName] as [Favorite Name], convert(varchar, LoadDate, 107) as [Date Added]" & _
    "  FROM [WebFD].[FRED].[FredFavorites] ff" & _
    " where Userlogin = '" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "' order by FavoriteName asc"

            Try

                Dim da As SqlDataAdapter

                favoriteinfo.Clear()
                Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    da = New SqlDataAdapter(getfavorite, conn2)
                    da.Fill(favoriteinfo, "DEMO")
                    newgvFavorites.DataSource = favoriteinfo
                    newgvFavorites.DataMember = "DEMO"
                    newgvFavorites.DataBind()
                End Using


            Catch ex As Exception
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            End Try
            'RecalculateNumbers()

            Exit Sub

        End If

        ' Catch ex As Exception
        'LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        ' End Try
    End Sub


    Private Sub CostingCheck()
        Try
            Dim dr As SqlDataReader

            SQL = "Select CostingAccess, PHIAccess, FinancialAccess, BO_FinancialAccess " & _
                "From WebFD.FRED.USERAccess " & _
                "where USERID = '" & Page.User.Identity.Name & "'  "
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                cmd = New SqlCommand(SQL, conn)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("CostingAccess")) Then
                        lblCosting.Text = ""
                    Else
                        If dr.Item("CostingAccess") = "1" Then
                            lblCosting.Text = "Costing Access Granted"
                        Else
                            lblCosting.Text = ""
                        End If
                    End If
                    If IsDBNull(dr.Item("PHIAccess")) Then
                        lblPHI.Text = ""
                    Else
                        If dr.Item("PHIAccess") = "1" Then
                            lblPHI.Text = "PHI Access Granted"
                        Else
                            lblPHI.Text = ""
                        End If
                    End If
                    If IsDBNull(dr.Item("FinancialAccess")) Then
                        lblFinancial.Text = ""
                    Else
                        If dr.Item("FinancialAccess") = "1" Then
                            lblFinancial.Text = "Financial Access Granted"
                        Else
                            lblFinancial.Text = ""
                        End If
                    End If
                    If IsDBNull(dr.Item("BO_FinancialAccess")) Then
                        lblBO_Financial.Text = ""
                    Else
                        If dr.Item("BO_FinancialAccess") = "1" Then
                            lblBO_Financial.Text = "BO_Financial Access Granted"
                        Else
                            lblBO_Financial.Text = ""
                        End If
                    End If
                End While
                dr.Read()
            End Using
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub rblDataType_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles rblDataType.SelectedIndexChanged
        Try
            FREDReportType(rblDataType.SelectedValue)
            LoadForcedFilter()
            FillForcedColumnddl()

            If rblDataType.SelectedIndex = 0 Then
                chbWhereExists.Visible = False
            Else
                chbWhereExists.Visible = True
            End If
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDReportType(ByRef FredType As Integer)
        'Try
        '    Dim ds As DataSet
        '    Dim da As New SqlDataAdapter
        '    ddlFREDTables.Visible = True

        '    If FredType = 0 Then
        '        SQL = "select distinct FREDType, Table_Alias, TABLE_ID from WebFD.FRED.vw_AvailableData where FREDType = 0  order by 1 desc, 2  "
        '    Else
        '        SQL = "select distinct FREDType, Table_Alias, TABLE_ID from WebFD.FRED.vw_AvailableData where FREDType <> 0  order by 1 desc, 2   "
        '    End If

        '    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
        '        If conn.State = ConnectionState.Closed Then
        '            conn.Open()
        '        End If
        '        ds = New DataSet
        '        cmd = New SqlCommand(SQL, conn)
        '        da.SelectCommand = cmd
        '        da.SelectCommand.CommandTimeout = 86400
        '        da.Fill(ds, "FRED")

        '        ddlFREDTables.DataSource = ds
        '        ddlFREDTables.DataMember = "FRED"
        '        ddlFREDTables.DataTextField = "Table_Alias"
        '        ddlFREDTables.DataValueField = "TABLE_ID"
        '        ddlFREDTables.DataBind()
        '    End Using
        '    If FredType = 0 Then
        '        'SetFREDSelectAccordion(0)
        '        ddlFREDTables.Visible = False
        '        'Else : SetFREDSelectAccordion(ddlFREDTables.SelectedValue)
        '    End If
        'Catch ex As Exception

        'End Try

        Try
            If FredType = 0 Then
                acrFREDSelectTrans.Visible = False
                ddlFREDTables.Visible = False
                acrFREDSelect.SelectedIndex = 0
            Else
                acrFREDSelectTrans.Visible = True
                ddlFREDTables.Visible = True
                acrFREDSelectTrans.SelectedIndex = 0
                acrFREDSelect.SelectedIndex = -1
            End If
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub
    Private Sub SetFREDSelectAccordion(ByRef FREDSelectAccordion As Integer)
        Try
            Dim cntFRED As Integer = 0
            Dim ds As New DataSet
            Dim ds2 As DataSet
            Dim ds3 As DataSet

            Dim da As New SqlDataAdapter
            Dim da2 As New SqlDataAdapter
            Dim da3 As New SqlDataAdapter
            Dim dReader As SqlDataReader
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""

            lblFREDSelectTrans.Text = ""
            lblFREDSelect1.Text = ""
            lblFREDSelect2.Text = " "
            lblFREDSelect3.Text = ""
            lblFREDSelect4.Text = ""

            cblFREDSelectTrans.DataSource = ds
            cblFREDSelect1.DataSource = ds
            cblFREDSelect2.DataSource = ds
            cblFREDSelect3.DataSource = ds
            cblFREDSelect4.DataSource = ds

            lblFREDTableTrans.Text = ""
            lblFREDKeyTrans.Text = ""
            lblFREDTable1.Text = ""
            lblFREDKey1.Text = ""
            lblFREDTable2.Text = ""
            lblFREDKey2.Text = ""
            lblFREDTable3.Text = ""
            lblFREDKey3.Text = ""
            lblFREDTable4.Text = ""
            lblFREDKey4.Text = ""

            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If

            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If

            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If

            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            SQL = "select distinct FREDType, Table_Alias, TABLE_ID, " & _
                " (TABLE_CATALOG + '.' +  TABLE_SCHEMA + '.' + TABLE_NAME) as TableID, " & _
                " COLUMN_NAME " & _
                " from WebFD.FRED.vw_AvailableData " & _
                " where   (FREDTYPE = 0  or TABLE_ID = " & FREDSelectAccordion.ToString & ")" & _
                " and Costing in (" & Costing & ") " & _
                " and PHI in (" & PHI & ") " & _
                " and Financial in (" & Financial & ") " & _
                " and BO_Financial in (" & BO_Financial & ") " & _
                " and FREDConnect = 1 " & _
                " order by 1 desc, 2 "
            '--" where (Table_ID =  " & FREDSelectAccordion & " or FREDTYPE = 0) " & _
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                If ds.Tables(0).Rows.Count <> 0 Then
                    Dim lbTitle As Label
                    Dim TblID As String
                    Dim ColList As String
                    Dim cblContent As CheckBoxList
                    Dim dr As DataRow
                    For Each dr In ds.Tables(0).Rows
                        lbTitle = New Label()
                        cblContent = New CheckBoxList()
                        TblID = ""
                        ColList = ""
                        ds2 = New DataSet

                        lbTitle.Text = ">>" & dr("Table_Alias").ToString()
                        TblID = dr("TABLE_ID").ToString()


                        If FREDSelectAccordion = 0 And cntFRED = 0 Then
                            cntFRED = cntFRED + 1
                        ElseIf cntFRED = 0 Then
                            clText1.Text = dr("Table_Alias").ToString()
                            lblFREDSelectTrans.Text = lbTitle.Text
                            lblFREDTableTrans.Text = dr("TableID").ToString()
                            lblFREDKeyTrans.Text = dr("COLUMN_NAME").ToString()
                            lblFredTableTransID.Text = TblID

                        End If


                        Select Case cntFRED
                            Case 1
                                clText2.Text = dr("Table_Alias").ToString
                                lblFREDSelect1.Text = lbTitle.Text
                                lblFREDTable1.Text = dr("TableID").ToString()
                                lblFREDKey1.Text = dr("COLUMN_NAME").ToString()
                                lblFredTable1ID.Text = TblID
                            Case 2
                                If lblFREDSelect1.Text <> lbTitle.Text Then
                                    clText3.Text = dr("Table_Alias").ToString
                                    lblFREDSelect2.Text = lbTitle.Text
                                    lblFREDTable2.Text = dr("TableID").ToString()
                                    lblFREDKey2.Text = dr("COLUMN_NAME").ToString()
                                    lblFredTable2ID.Text = TblID
                                End If
                            Case 3
                                If lblFREDSelect1.Text <> lbTitle.Text And lblFREDSelect2.Text <> lbTitle.Text Then
                                    clText4.Text = dr("Table_Alias").ToString
                                    lblFREDSelect3.Text = lbTitle.Text
                                    lblFREDTable3.Text = dr("TableID").ToString()
                                    lblFREDKey3.Text = dr("COLUMN_NAME").ToString()
                                    lblFredTable3ID.Text = TblID
                                End If
                            Case 4
                                If lblFREDSelect1.Text <> lbTitle.Text And lblFREDSelect2.Text <> lbTitle.Text _
                                             And lblFREDSelect3.Text <> lbTitle.Text Then
                                    clText5.Text = dr("Table_Alias").ToString
                                    lblFREDSelect4.Text = lbTitle.Text
                                    lblFREDTable4.Text = dr("TableID").ToString()
                                    lblFREDKey4.Text = dr("COLUMN_NAME").ToString()
                                    lblFredTable4ID.Text = TblID
                                End If
                        End Select

                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        SQL = "select  Column_Alias ,  'ID:' + convert(varchar(max),COLUMN_ID ) + ' Desc: ' + isnull(ColumnDesc,'---') as cValue " & _
                            " from WebFD.FRED.vw_AvailableData  where Table_ID =  " & TblID & " and FREDConnect <> 1 and Costing in (" & Costing & _
                            ") and PHI in (" & PHI & ") and Financial in (" & Financial & ") and BO_Financial in (" & BO_Financial & ")  order by sDefault desc, 1  "

                        cmd2 = New SqlCommand(SQL, conn)
                        da2.SelectCommand = cmd2
                        da2.SelectCommand.CommandTimeout = 86400
                        da2.Fill(ds2, "FRED")

                        If FREDSelectAccordion = 0 And cntFRED = 0 Then
                            cntFRED = cntFRED + 1
                        ElseIf cntFRED = 0 Then
                            cblFREDSelectTrans.DataSource = ds2
                            cblFREDSelectTrans.DataMember = "FRED"
                            cblFREDSelectTrans.DataTextField = "Column_Alias"
                            cblFREDSelectTrans.DataValueField = "cValue"
                            cblFREDSelectTrans.DataBind()

                            If cblFREDSelectTrans IsNot Nothing Then
                                For Each li As ListItem In cblFREDSelectTrans.Items
                                    li.Attributes("title") = li.Value
                                Next
                            End If

                        End If

                        Select Case cntFRED
                            Case 1
                                cblFREDSelect1.DataSource = ds2
                                cblFREDSelect1.DataMember = "FRED"
                                cblFREDSelect1.DataTextField = "Column_Alias"
                                cblFREDSelect1.DataValueField = "cValue"
                                cblFREDSelect1.DataBind()

                                If cblFREDSelect1 IsNot Nothing Then
                                    For Each li As ListItem In cblFREDSelect1.Items
                                        li.Attributes("title") = li.Value
                                    Next
                                End If
                            Case 2
                                cblFREDSelect2.DataSource = ds2
                                cblFREDSelect2.DataMember = "FRED"
                                cblFREDSelect2.DataTextField = "Column_Alias"
                                cblFREDSelect2.DataValueField = "cValue"
                                cblFREDSelect2.DataBind()

                                If cblFREDSelect2 IsNot Nothing Then
                                    For Each li As ListItem In cblFREDSelect2.Items
                                        li.Attributes("title") = li.Value
                                    Next
                                End If
                            Case 3
                                cblFREDSelect3.DataSource = ds2
                                cblFREDSelect3.DataMember = "FRED"
                                cblFREDSelect3.DataTextField = "Column_Alias"
                                cblFREDSelect3.DataValueField = "cValue"
                                cblFREDSelect3.DataBind()

                                If cblFREDSelect3 IsNot Nothing Then
                                    For Each li As ListItem In cblFREDSelect3.Items
                                        li.Attributes("title") = li.Value
                                    Next
                                End If
                            Case 4
                                cblFREDSelect4.DataSource = ds2
                                cblFREDSelect4.DataMember = "FRED"
                                cblFREDSelect4.DataTextField = "Column_Alias"
                                cblFREDSelect4.DataValueField = "cValue"
                                cblFREDSelect4.DataBind()

                                If cblFREDSelect4 IsNot Nothing Then
                                    For Each li As ListItem In cblFREDSelect4.Items
                                        li.Attributes("title") = li.Value
                                    Next
                                End If
                        End Select

                        SQL = "DECLARE @List varchar(max)   " & _
                              "SET @List = ''    " & _
                              "SELECT @List = @List +  CHAR(36) + Cast([Column_Alias] As varchar(max)) +  CHAR(36) + ','  " & _
                              "FROM  [WebFD].[FRED].[vw_AvailableData]  " & _
                              "where TABLE_ID = " & TblID & " and sDefault = 1   " & _
                              "if LEN(@List) > 1 " & _
                              "Begin " & _
                              "SET @List = SUBSTRING(@List, 1, Len(@List) - 1)   " & _
                              "end " & _
                              "SELECT @List As 'List'  "

                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        cmd2 = New SqlCommand(SQL, conn)
                        dReader = cmd2.ExecuteReader
                        While dReader.Read
                            If IsDBNull(dReader.Item("List")) Then
                                ColList = ""
                            Else
                                ColList = dReader.Item("List")
                            End If
                        End While
                        dReader.Close()

                        If FREDSelectAccordion = 0 And cntFRED = 0 Then
                            cntFRED = cntFRED + 1
                        ElseIf cntFRED = 0 Then
                            For j As Integer = 0 To cblFREDSelectTrans.Items.Count - 1
                                If ColList.Contains("$" & cblFREDSelectTrans.Items(j).ToString & "$") Then
                                    cblFREDSelectTrans.Items(j).Selected = True
                                End If
                            Next

                        End If

                        Select Case cntFRED
                            Case 1
                                For j As Integer = 0 To cblFREDSelect1.Items.Count - 1
                                    If ColList.Contains("$" & cblFREDSelect1.Items(j).ToString & "$") Then
                                        cblFREDSelect1.Items(j).Selected = True
                                    End If
                                Next
                            Case 2
                                For j As Integer = 0 To cblFREDSelect2.Items.Count - 1
                                    If ColList.Contains("$" & cblFREDSelect2.Items(j).ToString & "$") Then
                                        cblFREDSelect2.Items(j).Selected = True
                                    End If
                                Next
                            Case 3
                                For j As Integer = 0 To cblFREDSelect3.Items.Count - 1
                                    If ColList.Contains("$" & cblFREDSelect3.Items(j).ToString & "$") Then
                                        cblFREDSelect3.Items(j).Selected = True
                                    End If
                                Next
                            Case Else
                                For j As Integer = 0 To cblFREDSelect4.Items.Count - 1
                                    If ColList.Contains("$" & cblFREDSelect4.Items(j).ToString & "$") Then
                                        cblFREDSelect4.Items(j).Selected = True
                                    End If
                                Next
                        End Select
                        cntFRED += 1
                    Next
                End If

                If FREDSelectAccordion = 0 Then
                    acrFREDSelectTrans.Visible = False
                Else
                    acrFREDSelectTrans.Visible = True
                End If

                If lblFREDSelect2.Text = " " Then
                    apFREDSelect2.Visible = False
                Else
                    apFREDSelect2.Visible = True
                End If

                If lblFREDSelect3.Text = "" Then
                    apFREDSelect3.Visible = False
                Else
                    apFREDSelect3.Visible = True
                End If

                If lblFREDSelect4.Text = "" Then
                    apFREDSelect4.Visible = False
                Else
                    apFREDSelect4.Visible = True
                End If

                'If ds.Tables(0).Rows.Count <> 0 Then
                '    Dim lbTitle As Label
                '    Dim TblID As String
                '    Dim ColList As String
                '    Dim cblContent As CheckBoxList
                '    Dim pn As AjaxControlToolkit.AccordionPane
                '    Dim i As Integer = 0  ' This is just to use for assigning pane an id
                '    Dim dr As DataRow
                '    For Each dr In ds.Tables(0).Rows
                '        lbTitle = New Label()
                '        cblContent = New CheckBoxList()
                '        TblID = ""
                '        ColList = ""
                '        ds2 = New DataSet

                '        lbTitle.Text = dr("Table_Alias").ToString()
                '        TblID = dr("TABLE_ID").ToString()

                '        pn = New AjaxControlToolkit.AccordionPane()
                '        pn.ID = i
                '        pn.HeaderContainer.Controls.Add(lbTitle)

                '        If conn.State = ConnectionState.Closed Then
                '            conn.Open()
                '        End If
                '        SQL = "select  Column_Alias ,  'ID:' + convert(varchar(max),COLUMN_ID ) + ' Desc: ' + isnull(ColumnDesc,'---') as cValue " & _
                '                     " from WebFD.FRED.vw_AvailableData  where Table_ID =  " & TblID & "  order by 1  "
                '        cmd2 = New SqlCommand(SQL, conn)
                '        da2.SelectCommand = cmd2
                '        da2.SelectCommand.CommandTimeout = 86400
                '        da2.Fill(ds2, "FRED")

                '        cblContent.DataSource = ds2
                '        cblContent.DataMember = "FRED"
                '        cblContent.DataTextField = "Column_Alias"
                '        cblContent.DataValueField = "cValue"
                '        cblContent.DataBind()

                '        If cblContent IsNot Nothing Then
                '            For Each li As ListItem In cblContent.Items
                '                li.Attributes("title") = li.Value
                '            Next
                '        End If

                '        pn.ContentContainer.Controls.Add(cblContent)
                '        acrFREDSelect.Panes.Add(pn)

                '        SQL = "DECLARE @List varchar(max)   " & _
                '              "SET @List = ''    " & _
                '              "SELECT @List = @List +  CHAR(36) + Cast([Column_Alias] As varchar(max)) +  CHAR(36) + ','  " & _
                '              "FROM  [WebFD].[FRED].[vw_AvailableData]  " & _
                '              "where TABLE_ID = " & TblID & " and sDefault = 1   " & _
                '              "if LEN(@List) > 1 " & _
                '              "Begin " & _
                '              "SET @List = SUBSTRING(@List, 1, Len(@List) - 1)   " & _
                '              "end " & _
                '              "SELECT @List As 'List'  "

                '        If conn.State = ConnectionState.Closed Then
                '            conn.Open()
                '        End If
                '        cmd2 = New SqlCommand(SQL, conn)
                '        dReader = cmd2.ExecuteReader
                '        While dReader.Read
                '            If IsDBNull(dReader.Item("List")) Then
                '                ColList = ""
                '            Else

                '                ColList = dReader.Item("List")
                '            End If
                '        End While
                '        dReader.Close()

                '        For j As Integer = 0 To cblContent.Items.Count - 1
                '            If ColList.Contains("$" & cblContent.Items(j).ToString & "$") Then
                '                cblContent.Items(j).Selected = True
                '            End If
                '        Next
                '        i = i + 1
                '    Next
                'End If

            End Using


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDTables_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDTables.SelectedIndexChanged
        Try
            SetFREDSelectAccordion(ddlFREDTables.SelectedValue)
            LoadForcedFilter()
            FillForcedColumnddl()
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


    End Sub
    Private Sub LoadFREDFreeFilters()
        Try
            'Dim ds As New DataSet
            Dim da As New SqlDataAdapter
            Dim da2 As New SqlDataAdapter

            ' where FREDType = 1
            SQL = "select Table_Alias, Table_ID, FREDType from ( " & _
                "select 'N/A' as Table_Alias, 0 as Table_ID, 0 as FREDType, 1 as num " & _
                "union " & _
                " select distinct Table_Alias, Table_ID  ,FREDType, 0 as num  from WebFD.FRED.vw_AvailableData   " & _
                "where FREDType is not null ) a " & _
                "order by num desc, Table_Alias asc  "

            Dim ForcedFilter As String
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            If rblDataType.SelectedIndex = 1 Then
                ForcedFilter = "select Table_Alias, Table_ID, FREDType from ( " & _
                    "select 'N/A' as Table_Alias, 0 as Table_ID, 0 as FREDType, 1 as num " & _
                    "union " & _
                    " select distinct Table_Alias, Table_ID  ,FREDType, 0 as num  from WebFD.FRED.vw_AvailableData   " & _
                    "where Table_ID = " & ddlFREDTables.SelectedValue & " ) a " & _
                    "order by num desc, Table_Alias asc  "
            Else
                ForcedFilter = "select distinct Table_Alias, Table_ID, FREDType from ( " & _
                    " select Table_Alias, Table_ID  ,FREDType, 0 as num  from WebFD.FRED.vw_AvailableData   " & _
                    " where FREDType = 0 " & _
                    " and Costing in (" & Costing & ") " & _
                    " and PHI in (" & PHI & ") " & _
                    " and Financial in (" & Financial & ") " & _
                    " and BO_Financial in (" & BO_Financial & ")  ) a " & _
                    "order by Table_Alias asc  "
            End If



            FilterSet = New DataSet
            FilterSet2 = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                cmd2 = New SqlCommand(ForcedFilter, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(FilterSet, "FRED")
                da2.SelectCommand = cmd2
                da2.SelectCommand.CommandTimeout = 86400
                da2.Fill(FilterSet2, "ForcedFRED")

                rblFREDFilter1.DataSource = FilterSet2
                rblFREDFilter1.DataMember = "ForcedFRED"
                rblFREDFilter1.DataTextField = "Table_Alias"
                rblFREDFilter1.DataValueField = "Table_ID"
                rblFREDFilter1.DataBind()

                rblFREDFilter2.DataSource = FilterSet
                rblFREDFilter2.DataMember = "FRED"
                rblFREDFilter2.DataTextField = "Table_Alias"
                rblFREDFilter2.DataValueField = "Table_ID"
                rblFREDFilter2.DataBind()

                rblFREDFilter3.DataSource = FilterSet
                rblFREDFilter3.DataMember = "FRED"
                rblFREDFilter3.DataTextField = "Table_Alias"
                rblFREDFilter3.DataValueField = "Table_ID"
                rblFREDFilter3.DataBind()

                rblFREDFilter4.DataSource = FilterSet
                rblFREDFilter4.DataMember = "FRED"
                rblFREDFilter4.DataTextField = "Table_Alias"
                rblFREDFilter4.DataValueField = "Table_ID"
                rblFREDFilter4.DataBind()

                rblFREDFilter5.DataSource = FilterSet
                rblFREDFilter5.DataMember = "FRED"
                rblFREDFilter5.DataTextField = "Table_Alias"
                rblFREDFilter5.DataValueField = "Table_ID"
                rblFREDFilter5.DataBind()
            End Using


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub LoadForcedFilter()
        Try
            'Dim ds As New DataSet

            Dim da2 As New SqlDataAdapter

            ' where FREDType = 1

            Dim ForcedFilter As String
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            If rblDataType.SelectedIndex = 1 Then
                ForcedFilter = "select Table_Alias, Table_ID, FREDType from ( " & _
                    " select distinct Table_Alias, Table_ID  ,FREDType from WebFD.FRED.vw_AvailableData   " & _
                    "where Table_ID = " & ddlFREDTables.SelectedValue & " ) a " & _
                    " union " & _
                    "select distinct Table_Alias, Table_ID, FREDType from ( " & _
                    " select Table_Alias, Table_ID  ,FREDType from WebFD.FRED.vw_AvailableData   " & _
                    " where FREDType in (0) " & _
                    " and Costing in (" & Costing & ") " & _
                    " and PHI in (" & PHI & ") " & _
                    " and Financial in (" & Financial & ") " & _
                    " and BO_Financial in (" & BO_Financial & ")) a " & _
                    "order by FREDType desc, Table_Alias asc  "

            Else
                ForcedFilter = "select distinct Table_Alias, Table_ID, FREDType from ( " & _
                    " select Table_Alias, Table_ID  ,FREDType from WebFD.FRED.vw_AvailableData   " & _
                    " where FREDType in (0) " & _
                    " and Costing in (" & Costing & ") " & _
                    " and PHI in (" & PHI & ") " & _
                    " and Financial in (" & Financial & ") " & _
                    " and BO_Financial in (" & BO_Financial & ") ) a " & _
                    "order by Table_Alias asc  "
            End If



            FilterSet2 = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd2 = New SqlCommand(ForcedFilter, conn)
                da2.SelectCommand = cmd2
                da2.SelectCommand.CommandTimeout = 86400
                da2.Fill(FilterSet2, "ForcedFRED")

                rblFREDFilter1.DataSource = FilterSet2
                rblFREDFilter1.DataMember = "ForcedFRED"
                rblFREDFilter1.DataTextField = "Table_Alias"
                rblFREDFilter1.DataValueField = "Table_ID"
                rblFREDFilter1.DataBind()

            End Using
            rblFREDFilter1.SelectedIndex = 0
        Catch generatedExceptionName As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), generatedExceptionName.ToString())
        End Try

    End Sub

    Protected Function ReadByteStreamFromFileAndOutput(ByRef Buffer As Byte(), filepath As String) As Boolean
        Dim strFileName As String = filepath
        Dim Stream As FileStream
        Try
            If File.Exists(strFileName) Then
                Stream = File.Open(strFileName, FileMode.Open, FileAccess.Read, FileShare.None)
                Buffer = New Byte(Stream.Length - 1) {}
                Stream.Seek(0, SeekOrigin.Begin)
                Stream.Read(Buffer, 0, Buffer.Length)
                Stream.Flush()
                Stream.Close()
                'File.Delete(strFileName)
            End If
        Catch generatedExceptionName As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), generatedExceptionName.ToString())
            Return False
        End Try
        Return True
    End Function

    Protected Function GetDataForCSV() As DataTable
        Try
            Dim ds As DataSet
            Dim da As SqlDataAdapter

            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                ds = New DataSet

                da = New SqlDataAdapter(SQL3, conn)
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds)
            End Using

            Return ds.Tables(0)
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Function


    Protected Sub btnExportToExcel_Click(sender As Object, e As EventArgs) Handles btnExportToExcel.Click




        ' Try
        Dim ds As DataSet
        Dim da As SqlDataAdapter
        Dim FileName As String = "FRED_" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp
        'Replace(Replace(Replace(Date.Now.ToString, "/", "_"), " ", ""), ":", "_")

        SQL3 = "select  * from WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp

        If Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") = "" Then
            Exit Sub
        End If



        If rblExportType.SelectedValue = 0 Then
            Dim dtcsv As DataTable = GetDataForCSV()

            Response.Clear()
            Response.ContentType = "text/csv"
            Response.AddHeader("content-disposition", "attachment;filename=" & FileName & ".csv")

            Dim sb As New StringBuilder()
            For i As Integer = 0 To dtcsv.Columns.Count - 1
                sb.Append(Replace(dtcsv.Columns(i).ColumnName, "CarriageReturn", " ") + ",")
            Next
            sb.Append(Environment.NewLine)

            For j As Integer = 0 To dtcsv.Rows.Count - 1
                For k As Integer = 0 To dtcsv.Columns.Count - 1
                    sb.Append(dtcsv.Rows(j)(k).ToString() + ",")
                Next
                sb.Append(Environment.NewLine)
            Next

            Response.Write(sb.ToString())
            'Response.Flush()
            'Response.Close()
            Response.End()

        ElseIf rblExportType.SelectedValue = 1 Then
            'If chbExcel2007.Checked = True Then
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                ds = New DataSet

                da = New SqlDataAdapter(SQL3, conn)
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds)
            End Using

            Dim filepath As String = "C:\Users\" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "\Downloads\" & FileName & ".xlsx"

            If File.Exists(filepath) Then
                File.Delete(filepath)
            End If

            'CreateExcelFile.CreateExcelDocument(ds, "C:\TEMP\FREDDUMP\" & FileName & ".xlsx")
            CreateExcelFile.CreateExcelDocument(ds, "C:\Users\" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "\Downloads\" & FileName & ".xlsx")

            Dim buffer As Byte() = Nothing
            'Dim filepath As String = "C:\TEMP\FREDDUMP\" & FileName & ".xlsx"

            FileName = FileName & ".xlsx"
            If Not ReadByteStreamFromFileAndOutput(buffer, filepath) Then
                Return
            End If
            Response.ClearContent()
            Response.ClearHeaders()
            Response.ContentType = "application/octet-stream"
            Response.AddHeader("Content-disposition", "attachment; filename=" & FileName)
            Response.BinaryWrite(buffer)



            'Dim s As String
            'For ta As Integer = 0 To Response.Headers.Count - 1
            '    If IsDBNull(Response.Headers(ta)) Then
            '    Else
            '        s = Response.Headers(ta).ToString
            '    End If

            'Next

            Response.Flush()
            Response.Close()
            Exit Sub

        Else
            Dim dt As New DataTable
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                ds = New DataSet

                da = New SqlDataAdapter(SQL3, conn)
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(dt)
                dt.TableName = "DEMO"
            End Using

            'SAVE THIS CODE UNTIL THIS PART IS COMPLETE, THIS IS A BACK UP OF THE WORKING EXPORT
            Dim attachment As String = "attachment; filename=" & FileName & ".xls"
            Response.ClearContent()
            Response.AddHeader("content-disposition", attachment)
            Response.ContentType = "application/vnd.ms-excel"

            Dim tab As String = ""
            'For Each dc As DataColumn In dt.Columns
            '    Response.Write(tab + Replace(dc.ColumnName, "CarriageReturn", " "))
            '    tab = vbTab
            'Next
            Response.Write(vbLf)

            Dim i As Integer
            For Each dr As DataRow In dt.Rows
                tab = ""
                For i = 0 To dt.Columns.Count - 1
                    Response.Write(tab & dr(i).ToString())
                    tab = vbTab
                Next
                Response.Write(vbLf)
            Next
            'Response.Flush()
            'Response.Close()
            Response.End()
        End If




        'Dim attachment As String
        'Dim tab As String = ""


        'If chbExcel2007.Checked = True Then
        '    attachment = "attachment; filename=" & FileName & ".xlsx"
        '    Response.ClearContent()
        '    Response.AddHeader("content-disposition", attachment)
        '    Response.ContentType = "application/vnd.openxmlformats"

        '    'Dim ms As MemoryStream = New MemoryStream()

        '    For Each dc As DataColumn In dt.Columns
        '        Response.Write(tab + dc.ColumnName)
        '        tab = vbTab
        '    Next
        '    Response.Write(vbLf)

        '    Dim i As Integer
        '    For Each dr As DataRow In dt.Rows
        '        tab = ""
        '        For i = 0 To dt.Columns.Count - 1
        '            Response.Write(tab & dr(i).ToString())
        '            tab = vbTab
        '        Next
        '        Response.Write(vbLf)
        '    Next
        '    Response.End()

        'Else
        'attachment = "attachment; filename=" & FileName & ".xls"
        'Response.ClearContent()
        'Response.AddHeader("content-disposition", attachment)
        'Response.ContentType = "application/vnd.ms-excel"

        'For Each dc As DataColumn In dt.Columns
        '    Response.Write(tab + dc.ColumnName)
        '    tab = vbTab
        'Next
        'Response.Write(vbLf)

        'Dim i As Integer
        'For Each dr As DataRow In dt.Rows
        '    tab = ""
        '    For i = 0 To dt.Columns.Count - 1
        '        Response.Write(tab & dr(i).ToString())
        '        tab = vbTab
        '    Next
        '    Response.Write(vbLf)
        'Next
        'Response.End()
        'End If








        'THIS WOULD BE USED IF THE EXPORT WAS COMING DIRECTLY FROM THE GRIDVIEW 
        'Dim sw As New StringWriter()
        'Dim hw As New System.Web.UI.HtmlTextWriter(sw)
        'Dim frm As HtmlForm = New HtmlForm()
        ''Dim FileName As String = "FSILookUpFile.xls"

        'If gvFREDData.Rows.Count <> 0 Then

        '    'original code  
        '    Page.Response.AddHeader("content-disposition", "attachment;filename=FSILookUpFile.xls")
        '    Page.Response.ContentType = "application/vnd.ms-excel"
        '    '  Page.Response.ContentType = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" 
        '    Page.Response.Charset = ""
        '    Page.EnableViewState = False
        '    frm.Attributes("runat") = "server"
        '    Controls.Add(frm)
        '    frm.Controls.Add(gvFREDData)
        '    frm.RenderControl(hw)
        '    Response.Write(sw.ToString())
        '    'This line works instead of the Response.end () if needed
        '    ' HttpContext.Current.ApplicationInstance.CompleteRequest()
        '    Response.End()
        'Else
        '    btnExportToExcel.Visible = False

        'End If


        '  Catch ex As Exception
        'LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        '  End Try
    End Sub
    Protected Sub btnRunReport_Click(sender As Object, e As EventArgs) Handles btnRunReport.Click
        Try
            gvFREDData.PageIndex = 1
            ApplyPalette()
            BindFred()
            CheckFavorite()
            If favorite Then
                Dim favsql As String
                favsql = "Update [WebFD].[FRED].[FredFavorites] set LastView = Convert(date, GetDate()) where ID = " & doctor(0)

                Try

                    Using conn As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If

                        cmd = New System.Data.SqlClient.SqlCommand(favsql, conn)
                        cmd.ExecuteNonQuery()

                    End Using

                Catch ex As Exception
                    LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                End Try

            End If

            Exit Sub

            Dim ds As DataSet
            Dim da As SqlDataAdapter
            Dim cntResults As Integer

            BuildFRED()
            If SQL = "" Or SQL2 = "" Then
                Exit Sub
            End If

            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                ds = New DataSet

                da = New SqlDataAdapter(SQL, conn)
                da.SelectCommand.CommandTimeout = 86400

                da.Fill(ds, "DEMO")
                gvFREDData.DataSource = ds
                gvFREDData.DataMember = "DEMO"
                gvFREDData.DataBind()
            End Using

            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                cmd = New SqlCommand(SQL2, conn)
                cmd.CommandTimeout = 86400
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cntResults = cmd.ExecuteScalar
                If cntResults > 1048576 Then
                    lblResults.Text = "Count: " & cntResults.ToString & "  EXCEL LIMIT EXCEEDED "
                    tblCount.Visible = True
                    btnExportToExcel.Enabled = False
                    explantionlabelexample.Text = "There are too many results to export to Excel -- Please narrow your search."
                    ModalPopupExtenderexample.Show()
                Else : lblResults.Text = "Count: " & cntResults.ToString
                    lblFredSelectCount1.Text = ""
                    lblFredSelectCount2.Text = ""
                    lblFredSelectCount3.Text = ""
                    lblFredSelectCount4.Text = ""
                    lblFredSelectCountTrans.Text = ""
                    tblCount.Visible = True
                    btnExportToExcel.Enabled = True
                End If
            End Using


        Catch ex As Exception
            lblResults.Text = "Count: 0 - Bad data type in Filter(s)."
            tblCount.Visible = True
            btnExportToExcel.Enabled = False

        Finally

        End Try


    End Sub
    Sub BindFred()
        Try
            Dim ds As DataSet
            Dim da As SqlDataAdapter
            Dim cntResults As Integer

            BuildFRED()
            If SQL = "" Or SQL2 = "" Then
                Exit Sub
            End If

            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                cmd = New SqlCommand(SQL2, conn)
                cmd.CommandTimeout = 86400
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cntResults = cmd.ExecuteScalar
                If cntResults > 1048576 Then
                    lblResults.Text = "Count: " & cntResults.ToString & "  EXCEL LIMIT EXCEEDED "
                    tblCount.Visible = True
                    btnExportToExcel.Enabled = False
                    explantionlabelexample.Text = "There are too many results to export to Excel -- Please narrow your search."
                    ModalPopupExtenderexample.Show()
                Else : lblResults.Text = "Count: " & cntResults.ToString
                    tblCount.Visible = True
                    btnExportToExcel.Enabled = True
                End If
            End Using

            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                ds = New DataSet

                da = New SqlDataAdapter(SQL, conn)
                da.SelectCommand.CommandTimeout = 86400

                da.Fill(ds, "DEMO")
                gvFREDData.DataSource = ds
                gvFREDData.DataMember = "DEMO"
                gvFREDData.DataBind()

                'FREDData = New SqlDataSource
                'FREDData.ConnectionString = ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString
                'FREDData.SelectCommand = SQL

                'gvFREDData.DataSource = FREDData
                'gvFREDData.DataBind()


            End Using

            If gvFREDData.Visible = False Then
                ApplyPalette()
                gvFREDData.Visible = True
                Colorlegend.Visible = True
            End If

            For hc As Integer = 0 To gvFREDData.HeaderRow.Cells.Count - 1
                gvFREDData.HeaderRow.Cells(hc).Text = Replace(gvFREDData.HeaderRow.Cells(hc).Text, "CarriageReturn", "<br />")
            Next

        Catch ex As Exception
            lblResults.Text = lblResults.Text & vbCrLf & " OUT OF MEMORY CANNOT DISPLAY RESULTS "
            tblCount.Visible = True
            gvFREDData.Visible = False
            Colorlegend.Visible = False

        End Try
    End Sub
    Sub BuildFRED()
        Try
            Dim temp As String = ""
            Dim SQLSelect As String = ""
            Dim SQLTable As String = ""
            Dim tempFRED As String = ""
            Dim FREDFilter1 As String = ""
            Dim FREDFilter2 As String = ""
            Dim FREDFilter3 As String = ""
            Dim FREDFilter4 As String = ""
            Dim FREDFilter5 As String = ""
            Dim SQLDataType As String = ""
            Dim FREDConnect As String = ""
            Dim FREDTemp As String = ""
            Dim FREDTranschk As Integer = 0
            Dim FRED1chk As Integer = 0
            Dim FRED2chk As Integer = 0
            Dim FRED3chk As Integer = 0
            Dim FRED4chk As Integer = 0
            Dim rememberdatatype As String = ""
            Dim Whereclause As String = "Where"
            Dim exists1 As String = ""
            Dim exists2 As String = ""
            Dim exists3 As String = ""
            Dim exists4 As String = ""
            Dim exists5 As String = ""
            Dim notNumbers As List(Of String) = New List(Of String)
            notNumbers.Add("≠")
            notNumbers.Add("not like")
            notNumbers.Add("does not contain")
            notNumbers.Add("not between")
            notNumbers.Add("date not between")

            Dim ERRORMESSAGE As String = "ERRORMESSAGE GOES HERE"
            FREDTemp = "If Object_ID('WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & "') is not null " & _
                " begin " & _
                   "Drop table WebFD.FredTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & _
                " end; " & _
                " Create table WebFD.FredTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & " ( " & _
                ""
            If ddlFREDTables.SelectedValue > 0 Then
                If cblFREDSelectTrans.Visible = True Then
                    For i As Integer = 0 To cblFREDSelectTrans.Items.Count - 1
                        If cblFREDSelectTrans.Items(i).Selected = True Then
                            SQLSelect = SQLSelect & Mid(cblFREDSelectTrans.Items(i).Value, 4, InStr(cblFREDSelectTrans.Items(i).Value, "Desc:") - 5) & ","
                            FREDTranschk += 1
                        End If
                    Next
                End If
            End If

            If cblFREDSelect1.Visible = True Then
                For i As Integer = 0 To cblFREDSelect1.Items.Count - 1
                    If cblFREDSelect1.Items(i).Selected = True Then
                        SQLSelect = SQLSelect & Mid(cblFREDSelect1.Items(i).Value, 4, InStr(cblFREDSelect1.Items(i).Value, "Desc:") - 5) & ","
                        FRED1chk += 1
                    End If
                Next
            End If
            If cblFREDSelect2.Visible = True Then
                For i As Integer = 0 To cblFREDSelect2.Items.Count - 1
                    If cblFREDSelect2.Items(i).Selected = True Then
                        SQLSelect = SQLSelect & Mid(cblFREDSelect2.Items(i).Value, 4, InStr(cblFREDSelect2.Items(i).Value, "Desc:") - 5) & ","
                        FRED2chk += 1
                    End If
                Next
            End If
            If cblFREDSelect3.Visible = True Then
                For i As Integer = 0 To cblFREDSelect3.Items.Count - 1
                    If cblFREDSelect3.Items(i).Selected = True Then
                        SQLSelect = SQLSelect & Mid(cblFREDSelect3.Items(i).Value, 4, InStr(cblFREDSelect3.Items(i).Value, "Desc:") - 5) & ","
                        FRED3chk += 1
                    End If
                Next
            End If
            If cblFREDSelect4.Visible = True Then
                For i As Integer = 0 To cblFREDSelect4.Items.Count - 1
                    If cblFREDSelect4.Items(i).Selected = True Then
                        SQLSelect = SQLSelect & Mid(cblFREDSelect4.Items(i).Value, 4, InStr(cblFREDSelect4.Items(i).Value, "Desc:") - 5) & ","
                        FRED4chk += 1
                    End If
                Next
            End If
            If SQLSelect <> "" Then
                SQLSelect = Mid(SQLSelect, 1, Len(SQLSelect) - 1)
            Else
                lblResults.Text = "Count: 0 - NO COLUMNS SELECTED TO THE LEFT. "
                tblCount.Visible = True
                btnExportToExcel.Enabled = False
                Exit Sub
            End If



            SQL = "declare @SQLTables as varchar(max) " & _
            "declare  @SQLSelect as  varchar(max) " & _
            "set @SQLSelect = ''  SELECT  @SQLSelect  = @SQLSelect +  " & _
            "('['+Table_Alias+']'  + '.[' + COLUMN_NAME+']' + ' as '+ '[' + Table_Alias +'CarriageReturn'+ COLUMN_NAME + ']') + ',' " & _
            "FROM (select top 100000 * from [WebFD].[FRED].[vw_AvailableData] order by Table_Alias, Column_Alias) a " & _
            "where COLUMN_ID in (" & SQLSelect & ") " & _
            "if len(@SQLSelect)  > 1  " & _
            "begin  " & _
            "set @SQLSelect = SUBSTRING(@SQLSelect, 1, Len(@SQLSelect) - 1) " & _
            "end  " & _
            "select @SQLSelect as 'SQLSelect'   "

            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(SQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("SQLSelect")) Then
                        SQLSelect = ""
                    Else : SQLSelect = dr.Item("SQLSelect")
                    End If
                End While
                dr.Close()
            End Using

            If SQLSelect = "" Then
                lblResults.Text = "Count: 0 " & ERRORMESSAGE
                tblCount.Visible = True
                btnExportToExcel.Enabled = False
                Exit Sub
            End If
            'Dim chk As String = "0"
            'If rblDataType.Items(1).Selected = True Then
            '    For i As Integer = 0 To cblFREDSelect1.Items.Count - 1
            '        If cblFREDSelect1.Items(i).Selected = True Then
            '            chk = "1"
            '        End If
            '    Next
            'End If

            SQLTable = "  from DWH.dbo.dimPatientAccount a with (nolock)  "
            If lblFREDTableTrans.Text <> "" And FREDTranschk > 0 Then
                SQLTable = SQLTable & " left join " & lblFREDTableTrans.Text & " as [" & Replace(lblFREDSelectTrans.Text, ">>", "") & "] with (nolock) on a.PatientAccountFacility = [" & Replace(lblFREDSelectTrans.Text, ">>", "") & "]." & lblFREDKeyTrans.Text
            End If
            If lblFREDTable1.Text <> "" And FRED1chk > 0 Then
                SQLTable = SQLTable & " left join " & lblFREDTable1.Text & " as [" & Replace(lblFREDSelect1.Text, ">>", "") & "] with (nolock) on a.PatientAccountFacility = [" & Replace(lblFREDSelect1.Text, ">>", "") & "]." & lblFREDKey1.Text
            End If
            If lblFREDTable2.Text <> "" And FRED2chk > 0 Then
                SQLTable = SQLTable & " left join " & lblFREDTable2.Text & " as [" & Replace(lblFREDSelect2.Text, ">>", "") & "] with (nolock) on a.PatientAccountFacility = [" & Replace(lblFREDSelect2.Text, ">>", "") & "]." & lblFREDKey2.Text
            End If
            If lblFREDTable3.Text <> "" And FRED3chk > 0 Then
                SQLTable = SQLTable & " left join " & lblFREDTable3.Text & " as [" & Replace(lblFREDSelect3.Text, ">>", "") & "] with (nolock) on a.PatientAccountFacility = [" & Replace(lblFREDSelect3.Text, ">>", "") & "]." & lblFREDKey3.Text
            End If
            If lblFREDTable4.Text <> "" And FRED4chk > 0 Then
                SQLTable = SQLTable & " left join " & lblFREDTable4.Text & " as [" & Replace(lblFREDSelect4.Text, ">>", "") & "] with (nolock) on a.PatientAccountFacility = [" & Replace(lblFREDSelect4.Text, ">>", "") & "]." & lblFREDKey4.Text
            End If

            'If rblFREDFilter1.SelectedIndex <> 0 Then
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                'If rblFREDFilter1.SelectedIndex <> 0 Then
                SQL = "select " & _
             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
             ",COLUMN_NAME as FREDConnect,   " & _
             "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter1.SelectedValue.ToString & _
             "  and Column_Alias = '" & ddlFREDFilter1.SelectedValue & "' ) as dataType " & _
             "from WebFD.FRED.vw_AvailableData " & _
             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("dataType")) Then
                        SQLDataType = "'"
                    Else
                        SQLDataType = dr.Item("dataType")
                        If InStr(SQLDataType, "date") > 0 Or InStr(SQLDataType, "time") > 0 Or InStr(SQLDataType, "char") > 0 Or InStr(SQLDataType, "text") > 0 Then
                            rememberdatatype = SQLDataType
                            SQLDataType = "'"
                        Else
                            rememberdatatype = SQLDataType
                            SQLDataType = ""
                        End If
                    End If
                    'get the full table name of the first filtered option
                    If IsDBNull(dr.Item("FREDTable")) Then
                        FREDFilter1 = ""
                    Else
                        FREDFilter1 = dr.Item("FREDTable")
                    End If
                    If IsDBNull(dr.Item("FREDConnect")) Then
                        FREDConnect = ""
                    Else
                        FREDConnect = dr.Item("FREDConnect")
                    End If
                End While
                dr.Close()
                'End If



                Select Case ddlFREDFilterOption1.SelectedValue
                    Case "≠"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " <> " & SQLDataType & Replace(txtFREDFilter1.Text, " '", "''") & SQLDataType & " "
                        If txtFREDFilter1.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If InStr(rememberdatatype, "char") > 0 Then
                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                            If IsDate(txtFREDFilter1.Text) = 0 Then
                                baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                            If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (txtFREDFilter1.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        Else
                            If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        End If
                    Case "like"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"
                        If txtFREDFilter1.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                    Case "contains" 'AKA in
                        tempFRED = ""
                        If txtFREDFilter1.Text.Contains(",") Then
                            temp = txtFREDFilter1.Text
                            txtFREDFilter1.Text = Replace(txtFREDFilter1.Text, "'", "''")
                            Do While txtFREDFilter1.Text.Contains(",")
                                If InStr(txtFREDFilter1.Text, ",") > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1)) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1), ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1)) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1), ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        ElseIf (Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1) Mod 1) <> 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1), ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1)) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1), ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1) & "',"
                                    txtFREDFilter1.Text = Mid(txtFREDFilter1.Text, InStr(txtFREDFilter1.Text, ",") + 1, Len(txtFREDFilter1.Text))
                                Else
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter1.Text) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter1.Text Mod 1) <> 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter1.Text & "'"
                                    txtFREDFilter1.Text = ""
                                End If
                            Loop
                            If Len(txtFREDFilter1.Text) > 0 Then
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter1.Text) = 0 Then
                                        txtFREDFilter1.Text = temp
                                        baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                        txtFREDFilter1.Text = temp
                                        baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter1.Text Mod 1) <> 0 Then
                                        txtFREDFilter1.Text = temp
                                        baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                        txtFREDFilter1.Text = temp
                                        baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = tempFRED & "'" & txtFREDFilter1.Text & "'"
                            End If
                            If tempFRED.EndsWith(",") Then
                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                            End If
                            txtFREDFilter1.Text = temp
                        Else
                            If txtFREDFilter1.Text = "" Then
                                blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter1.Text) = 0 Then
                                    baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                    baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter1.Text Mod 1) <> 0 Then
                                    baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                    baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                            tempFRED = "'" & txtFREDFilter1.Text & "'"
                        End If
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " in (" & tempFRED & ") "
                        temp = ""
                    Case "not like"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"
                        If txtFREDFilter1.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                    Case "Does not contain" 'AKA not in 
                        tempFRED = ""
                        If txtFREDFilter1.Text.Contains(",") Then
                            temp = txtFREDFilter1.Text
                            txtFREDFilter1.Text = Replace(txtFREDFilter1.Text, "'", "''")
                            Do While txtFREDFilter1.Text.Contains(",")
                                If InStr(txtFREDFilter1.Text, ",") > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1)) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1), ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1)) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1), ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        ElseIf (Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1) Mod 1) <> 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1), ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1)) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1), ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1) & "',"
                                    txtFREDFilter1.Text = Mid(txtFREDFilter1.Text, InStr(txtFREDFilter1.Text, ",") + 1, Len(txtFREDFilter1.Text))
                                Else
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter1.Text) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter1.Text Mod 1) <> 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                            txtFREDFilter1.Text = temp
                                            baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter1.Text & "'"
                                    txtFREDFilter1.Text = ""
                                End If
                            Loop
                            If Len(txtFREDFilter1.Text) > 0 Then
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter1.Text) = 0 Then
                                        txtFREDFilter1.Text = temp
                                        baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                        txtFREDFilter1.Text = temp
                                        baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter1.Text Mod 1) <> 0 Then
                                        txtFREDFilter1.Text = temp
                                        baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                        txtFREDFilter1.Text = temp
                                        baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = tempFRED & "'" & txtFREDFilter1.Text & "'"
                            End If
                            If tempFRED.EndsWith(",") Then
                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                            End If
                            txtFREDFilter1.Text = temp
                        Else
                            If txtFREDFilter1.Text = "" Then
                                blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter1.Text) = 0 Then
                                    baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                    baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter1.Text Mod 1) <> 0 Then
                                    baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                    baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                            tempFRED = "'" & txtFREDFilter1.Text & "'"
                        End If
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not in (" & tempFRED & ") "
                        temp = ""
                    Case "between"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between " & SQLDataType & Replace(numFREDFilter1Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter1End.Text, "'", "''") & SQLDataType & "  "
                        If numFREDFilter1Start.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If numFREDFilter1End.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If InStr(rememberdatatype, "char") > 0 Then
                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                            If IsDate(numFREDFilter1Start.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1Start.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsDate(numFREDFilter1End.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1End.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                            If IsNumeric(numFREDFilter1Start.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1Start.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsNumeric(numFREDFilter1End.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1End.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (numFREDFilter1Start.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1Start.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (numFREDFilter1End.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1End.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        Else
                            If IsNumeric(numFREDFilter1Start.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1Start.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsNumeric(numFREDFilter1End.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1End.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        End If

                    Case "not between"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter1Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter1End.Text, "'", "''") & SQLDataType & "  "
                        If numFREDFilter1Start.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If numFREDFilter1End.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If InStr(rememberdatatype, "char") > 0 Then
                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                            If IsDate(numFREDFilter1Start.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1Start.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsDate(numFREDFilter1End.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1End.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                            If IsNumeric(numFREDFilter1Start.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1Start.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsNumeric(numFREDFilter1End.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1End.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (numFREDFilter1Start.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1Start.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (numFREDFilter1End.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1End.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        Else
                            If IsNumeric(numFREDFilter1Start.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1Start.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsNumeric(numFREDFilter1End.Text) = 0 Then
                                baddata(1, rememberdatatype, numFREDFilter1End.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        End If
                    Case "DATE between"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between " & SQLDataType & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & SQLDataType & "  "
                        If dtpFREDFilter1StartDate.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If dtpFREDFilter1EndDate.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If InStr(rememberdatatype, "char") > 0 Then
                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                            If IsDate(dtpFREDFilter1StartDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1StartDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsDate(dtpFREDFilter1EndDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1EndDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                            If IsNumeric(dtpFREDFilter1StartDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1StartDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsNumeric(dtpFREDFilter1EndDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1EndDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (dtpFREDFilter1StartDate.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1StartDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (dtpFREDFilter1EndDate.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1EndDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        Else
                            If IsNumeric(dtpFREDFilter1StartDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1StartDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsNumeric(dtpFREDFilter1EndDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1EndDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        End If
                    Case "DATE not between"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & SQLDataType & "  "
                        If dtpFREDFilter1StartDate.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If dtpFREDFilter1EndDate.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If InStr(rememberdatatype, "char") > 0 Then
                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                            If IsDate(dtpFREDFilter1StartDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1StartDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsDate(dtpFREDFilter1EndDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1EndDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                            If IsNumeric(dtpFREDFilter1StartDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1StartDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsNumeric(dtpFREDFilter1EndDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1EndDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (dtpFREDFilter1StartDate.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1StartDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (dtpFREDFilter1EndDate.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1EndDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        Else
                            If IsNumeric(dtpFREDFilter1StartDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1StartDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf IsNumeric(dtpFREDFilter1EndDate.Text) = 0 Then
                                baddata(1, rememberdatatype, dtpFREDFilter1EndDate.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        End If
                    Case "NULL"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NULL "
                    Case "NOT NULL"
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NOT NULL "
                    Case Else  '=,  <, <=, >, >=
                        tempFRED = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " " & ddlFREDFilterOption1.Text & " " & SQLDataType & Replace(txtFREDFilter1.Text, "'", "''") & SQLDataType & " "
                        If txtFREDFilter1.Text = "" Then
                            blankpopup(1, SQLDataType, ddlFREDFilter1.SelectedValue)
                            Exit Sub
                        End If
                        If InStr(rememberdatatype, "char") > 0 Then
                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                            If IsDate(txtFREDFilter1.Text) = 0 Then
                                baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                            If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            ElseIf (txtFREDFilter1.Text Mod 1) <> 0 Then
                                baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        Else
                            If IsNumeric(txtFREDFilter1.Text) = 0 Then
                                baddata(1, rememberdatatype, txtFREDFilter1.Text, ddlFREDFilter1.SelectedValue)
                                Exit Sub
                            End If
                        End If
                End Select

                Dim EncTrans As DataRow
                EncTrans = FilterSet2.Tables(0).Rows(rblFREDFilter1.SelectedIndex)
                If CInt(EncTrans("FREDType").ToString) = 0 Then
                    'Encounter Table

                    If FREDFilter1 = lblFREDTable1.Text And FRED1chk > 0 Then
                        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                    ElseIf FREDFilter1 = lblFREDTable2.Text And FRED2chk > 0 Then
                        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                    ElseIf FREDFilter1 = lblFREDTable3.Text And FRED3chk > 0 Then
                        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                    ElseIf FREDFilter1 = lblFREDTable4.Text And FRED4chk > 0 Then
                        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                    Else
                        SQLTable = SQLTable & " inner join " & FREDFilter1 & " as FF1 with (nolock) on a.PatientAccountFacility = FF1." & FREDConnect & " "
                        Whereclause = Whereclause & " " & tempFRED & " and "
                    End If
                    'Select Case FREDFilter1
                    '    Case lblFREDTable1.Text
                    '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                    '    Case lblFREDTable2.Text
                    '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                    '    Case lblFREDTable3.Text
                    '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                    '    Case lblFREDTable4.Text
                    '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                    '    Case Else
                    '        SQLTable = SQLTable & " inner join " & FREDFilter1 & " as FF1 on a.PatientAccountFacility = FF1." & FREDConnect & " "
                    '        Whereclause = Whereclause & " " & tempFRED & " and "
                    'End Select
                Else
                    'Transaction Table
                    If FREDFilter1 = lblFREDTableTrans.Text And FREDTranschk > 0 And chbWhereExists.Checked = True Then
                        Whereclause = Whereclause & " " & Replace(tempFRED, "FF1", "[" & Replace(lblFREDSelectTrans.Text, ">>", "") & "]") & " and "
                    Else
                        Select Case ddlFREDFilterOption1.SelectedValue
                            Case "≠"
                                exists1 = " not exists (Select * from " & FREDFilter1 & " FF1 with (nolock) where a.PatientAccountFacility = FF1." & FREDConnect & " and " & _
                                    Replace(tempFRED, " <> ", " = ") & ") and "
                            Case "not like"
                                exists1 = " not exists (Select * from " & FREDFilter1 & " FF1 with (nolock) where a.PatientAccountFacility = FF1." & FREDConnect & " and " & _
                                    Replace(tempFRED, " not like '%", " like '%") & ") and "
                            Case "does not contain"
                                exists1 = " not exists (Select * from " & FREDFilter1 & " FF1 with (nolock) where a.PatientAccountFacility = FF1." & FREDConnect & " and " & _
                                    Replace(tempFRED, " not in (", " in (") & ") and "
                            Case "not between"
                                exists1 = " not exists (Select * from " & FREDFilter1 & " FF1 with (nolock) where a.PatientAccountFacility = FF1." & FREDConnect & " and " & _
                                    Replace(tempFRED, " not between ", " between ") & ") and "
                            Case "DATE not between"
                                exists1 = " not exists (Select * from " & FREDFilter1 & " FF1 with (nolock) where a.PatientAccountFacility = FF1." & FREDConnect & " and " & _
                                    Replace(tempFRED, " not between ", " between ") & ") and "
                            Case Else
                                exists1 = " exists (Select * from " & FREDFilter1 & " FF1 with (nolock) where a.PatientAccountFacility = FF1." & FREDConnect & " and " & tempFRED & ") and "
                        End Select
                    End If
                End If

                ' SQLTable = SQLTable & _
                '" inner join " & FREDFilter1 & " as FF1 on a.PatientAccountFacility = FF1." & FREDConnect & " and " & tempFRED & " "
            End Using
            'End If

            If rblFREDFilter2.SelectedIndex <> 0 Then
                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    If rblFREDFilter2.SelectedIndex <> 0 Then
                        SQL = "select " & _
                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                     ",COLUMN_NAME as FREDConnect,   " & _
                     "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter2.SelectedValue.ToString & _
                     "  and Column_Alias = '" & ddlFREDFilter2.SelectedValue & "' ) as dataType " & _
                     "from WebFD.FRED.vw_AvailableData " & _
                     "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        cmd = New SqlCommand(SQL, conn)
                        dr = cmd.ExecuteReader
                        While dr.Read
                            If IsDBNull(dr.Item("dataType")) Then
                                SQLDataType = "'"
                            Else
                                SQLDataType = dr.Item("dataType")
                                If InStr(SQLDataType, "date") > 0 Or InStr(SQLDataType, "time") > 0 Or InStr(SQLDataType, "char") > 0 Or InStr(SQLDataType, "text") > 0 Then
                                    rememberdatatype = SQLDataType
                                    SQLDataType = "'"
                                Else
                                    rememberdatatype = SQLDataType
                                    SQLDataType = ""
                                End If
                            End If
                            'get the full table name of the first filtered option
                            If IsDBNull(dr.Item("FREDTable")) Then
                                FREDFilter2 = ""
                            Else
                                FREDFilter2 = dr.Item("FREDTable")
                            End If
                            If IsDBNull(dr.Item("FREDConnect")) Then
                                FREDConnect = ""
                            Else
                                FREDConnect = dr.Item("FREDConnect")
                            End If
                        End While
                        dr.Close()
                    End If

                    Select Case ddlFREDFilterOption2.SelectedValue
                        Case "≠"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " <> " & SQLDataType & Replace(txtFREDFilter2.Text, " '", "''") & SQLDataType & " "
                            If txtFREDFilter2.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter2.Text) = 0 Then
                                    baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                    baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter2.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                    baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "like"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"
                            If txtFREDFilter2.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                        Case "contains" 'AKA in 
                            tempFRED = ""
                            If txtFREDFilter2.Text.Contains(",") Then
                                temp = txtFREDFilter2.Text
                                txtFREDFilter2.Text = Replace(txtFREDFilter2.Text, "'", "''")
                                Do While txtFREDFilter2.Text.Contains(",")
                                    If InStr(txtFREDFilter2.Text, ",") > 0 Then
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1), ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1), ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            ElseIf (Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1) Mod 1) <> 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1), ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1), ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1) & "',"
                                        txtFREDFilter2.Text = Mid(txtFREDFilter2.Text, InStr(txtFREDFilter2.Text, ",") + 1, Len(txtFREDFilter2.Text))
                                    Else
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(txtFREDFilter2.Text) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            ElseIf (txtFREDFilter2.Text Mod 1) <> 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & txtFREDFilter2.Text & "'"
                                        txtFREDFilter2.Text = ""
                                    End If
                                Loop
                                If Len(txtFREDFilter2.Text) > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter2.Text) = 0 Then
                                            txtFREDFilter2.Text = temp
                                            baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                            txtFREDFilter2.Text = temp
                                            baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter2.Text Mod 1) <> 0 Then
                                            txtFREDFilter2.Text = temp
                                            baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                            txtFREDFilter2.Text = temp
                                            baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter2.Text & "'"
                                End If
                                If tempFRED.EndsWith(",") Then
                                    tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                                End If
                                txtFREDFilter2.Text = temp
                            Else
                                If txtFREDFilter2.Text = "" Then
                                    blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter2.Text) = 0 Then
                                        baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                        baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter2.Text Mod 1) <> 0 Then
                                        baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                        baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = "'" & txtFREDFilter2.Text & "'"
                            End If
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " in (" & tempFRED & ") "
                            temp = ""
                        Case "not like"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"
                            If txtFREDFilter2.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                        Case "does not contain" ' AKA not in 
                            tempFRED = ""
                            If txtFREDFilter2.Text.Contains(",") Then
                                temp = txtFREDFilter2.Text
                                txtFREDFilter2.Text = Replace(txtFREDFilter2.Text, "'", "''")
                                Do While txtFREDFilter2.Text.Contains(",")
                                    If InStr(txtFREDFilter2.Text, ",") > 0 Then
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1), ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1), ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            ElseIf (Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1) Mod 1) <> 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1), ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1), ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1) & "',"
                                        txtFREDFilter2.Text = Mid(txtFREDFilter2.Text, InStr(txtFREDFilter2.Text, ",") + 1, Len(txtFREDFilter2.Text))
                                    Else
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(txtFREDFilter2.Text) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            ElseIf (txtFREDFilter2.Text Mod 1) <> 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                                txtFREDFilter2.Text = temp
                                                baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & txtFREDFilter2.Text & "'"
                                        txtFREDFilter2.Text = ""
                                    End If
                                Loop
                                If Len(txtFREDFilter2.Text) > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter2.Text) = 0 Then
                                            txtFREDFilter2.Text = temp
                                            baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                            txtFREDFilter2.Text = temp
                                            baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter2.Text Mod 1) <> 0 Then
                                            txtFREDFilter2.Text = temp
                                            baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                            txtFREDFilter2.Text = temp
                                            baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter2.Text & "'"
                                End If
                                If tempFRED.EndsWith(",") Then
                                    tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                                End If
                                txtFREDFilter2.Text = temp
                            Else
                                If txtFREDFilter2.Text = "" Then
                                    blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter2.Text) = 0 Then
                                        baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                        baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter2.Text Mod 1) <> 0 Then
                                        baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                        baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = "'" & txtFREDFilter2.Text & "'"
                            End If
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not in (" & tempFRED & ") "
                            temp = ""
                        Case "between"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between " & SQLDataType & Replace(numFREDFilter2Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter2End.Text, "'", "''") & SQLDataType & "  "
                            If numFREDFilter2Start.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If numFREDFilter2End.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(numFREDFilter2Start.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2Start.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(numFREDFilter2End.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2End.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(numFREDFilter2Start.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2Start.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter2End.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2End.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter2Start.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2Start.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter2End.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2End.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(numFREDFilter2Start.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2Start.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter2End.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2End.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            End If

                        Case "not between"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter2Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter2End.Text, "'", "''") & SQLDataType & "  "
                            If numFREDFilter2Start.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If numFREDFilter2End.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(numFREDFilter2Start.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2Start.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(numFREDFilter2End.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2End.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(numFREDFilter2Start.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2Start.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter2End.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2End.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter2Start.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2Start.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter2End.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2End.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(numFREDFilter2Start.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2Start.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter2End.Text) = 0 Then
                                    baddata(2, rememberdatatype, numFREDFilter2End.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "DATE between"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between " & SQLDataType & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & SQLDataType & "  "
                            If dtpFREDFilter2StartDate.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If dtpFREDFilter2EndDate.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(dtpFREDFilter2StartDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2StartDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(dtpFREDFilter2EndDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2EndDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(dtpFREDFilter2StartDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2StartDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter2EndDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2EndDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter2StartDate.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2StartDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter2EndDate.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2EndDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(dtpFREDFilter2StartDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2StartDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter2EndDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2EndDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "DATE not between"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & SQLDataType & "  "
                            If dtpFREDFilter2StartDate.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If dtpFREDFilter2EndDate.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(dtpFREDFilter2StartDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2StartDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(dtpFREDFilter2EndDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2EndDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(dtpFREDFilter2StartDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2StartDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter2EndDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2EndDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter2StartDate.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2StartDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter2EndDate.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2EndDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(dtpFREDFilter2StartDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2StartDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter2EndDate.Text) = 0 Then
                                    baddata(2, rememberdatatype, dtpFREDFilter2EndDate.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "Null"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NULL "
                        Case "Not Null"
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NOT NULL "
                        Case Else  '=,  <, <=, >, >=
                            tempFRED = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " " & ddlFREDFilterOption2.Text & " " & SQLDataType & Replace(txtFREDFilter2.Text, "'", "''") & SQLDataType & " "
                            If txtFREDFilter2.Text = "" Then
                                blankpopup(2, SQLDataType, ddlFREDFilter2.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter2.Text) = 0 Then
                                    baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                    baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter2.Text Mod 1) <> 0 Then
                                    baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter2.Text) = 0 Then
                                    baddata(2, rememberdatatype, txtFREDFilter2.Text, ddlFREDFilter2.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                    End Select

                    Dim EncTrans As DataRow
                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter2.SelectedIndex)
                    If CInt(EncTrans("FREDType").ToString) = 0 Then
                        'Encounter Table
                        'Select Case FREDFilter2
                        '    Case lblFREDTable1.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable2.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable3.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable4.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                        '    Case FREDFilter1
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "FF1") & " and "
                        '    Case Else
                        '        SQLTable = SQLTable & " inner join " & FREDFilter2 & " as FF2 on a.PatientAccountFacility = FF2." & FREDConnect & " "
                        '        Whereclause = Whereclause & " " & tempFRED & " and "
                        'End Select

                        If FREDFilter2 = lblFREDTable1.Text And FRED1chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter2 = lblFREDTable2.Text And FRED2chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter2 = lblFREDTable3.Text And FRED3chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter2 = lblFREDTable4.Text And FRED4chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter1 = FREDFilter2 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "FF1") & " and "
                        Else
                            SQLTable = SQLTable & " inner join " & FREDFilter2 & " as FF2 with (nolock) on a.PatientAccountFacility = FF2." & FREDConnect & " "
                            Whereclause = Whereclause & " " & tempFRED & " and "
                        End If

                    Else
                        'Transaction Table
                        If FREDFilter2 = lblFREDTableTrans.Text And FREDTranschk > 0 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "[" & Replace(lblFREDSelectTrans.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter2 = FREDFilter1 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF2", "FF1") & " and "
                        ElseIf FREDFilter2 = FREDFilter1 And notNumbers.Contains(ddlFREDFilterOption1.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption2.SelectedValue) Then
                            Select Case ddlFREDFilterOption2.SelectedIndex
                                Case 1
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF2", "FF1"), " <> ", " = ") & ") and "
                                Case 8
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF2", "FF1"), " not like '%", " like '%") & ") and "
                                Case 9
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF2", "FF1"), " not in (", " in (") & ") and "
                                Case 11
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF2", "FF1"), " not between ", " between ") & ") and "
                                Case 13
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF2", "FF1"), " not between ", " between ") & ") and "
                                Case Else
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(tempFRED, "FF2", "FF1") & ") and "
                            End Select

                        Else
                            Select Case ddlFREDFilterOption2.SelectedValue
                                Case "≠"
                                    exists2 = " not exists (Select * from " & FREDFilter2 & " FF2 with (nolock) where a.PatientAccountFacility = FF2." & FREDConnect & " and " & _
                                        Replace(tempFRED, " <> ", " = ") & ") and "
                                Case "not like"
                                    exists2 = " not exists (Select * from " & FREDFilter2 & " FF2 with (nolock) where a.PatientAccountFacility = FF2." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists2 = " not exists (Select * from " & FREDFilter2 & " FF2 with (nolock) where a.PatientAccountFacility = FF2." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not in (", " in (") & ") and "
                                Case "not between"
                                    exists2 = " not exists (Select * from " & FREDFilter2 & " FF2 with (nolock) where a.PatientAccountFacility = FF2." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not between ", " between ") & ") and "
                                Case "DATE not between"
                                    exists2 = " not exists (Select * from " & FREDFilter2 & " FF2 with (nolock) where a.PatientAccountFacility = FF2." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not between ", " between ") & ") and "
                                Case Else
                                    exists2 = " exists (Select * from " & FREDFilter2 & " FF2 with (nolock) where a.PatientAccountFacility = FF2." & FREDConnect & " and " & tempFRED & ") and "
                            End Select
                        End If
                    End If

                    ' SQLTable = SQLTable & _
                    '" inner join " & FREDFilter2 & " as FF2 on a.PatientAccountFacility = FF2." & FREDConnect & " and " & tempFRED & " "
                End Using
            End If
            If rblFREDFilter3.SelectedIndex <> 0 Then
                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    If rblFREDFilter3.SelectedIndex <> 0 Then
                        SQL = "select " & _
                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                     ",COLUMN_NAME as FREDConnect,   " & _
                     "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter3.SelectedValue.ToString & _
                     "  and Column_Alias = '" & ddlFREDFilter3.SelectedValue & "' ) as dataType " & _
                     "from WebFD.FRED.vw_AvailableData " & _
                     "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        cmd = New SqlCommand(SQL, conn)
                        dr = cmd.ExecuteReader
                        While dr.Read
                            If IsDBNull(dr.Item("dataType")) Then
                                SQLDataType = "'"
                            Else
                                SQLDataType = dr.Item("dataType")
                                If InStr(SQLDataType, "date") > 0 Or InStr(SQLDataType, "time") > 0 Or InStr(SQLDataType, "char") > 0 Or InStr(SQLDataType, "text") > 0 Then
                                    rememberdatatype = SQLDataType
                                    SQLDataType = "'"
                                Else
                                    rememberdatatype = SQLDataType
                                    SQLDataType = ""
                                End If
                            End If
                            'get the full table name of the first filtered option
                            If IsDBNull(dr.Item("FREDTable")) Then
                                FREDFilter3 = ""
                            Else
                                FREDFilter3 = dr.Item("FREDTable")
                            End If
                            If IsDBNull(dr.Item("FREDConnect")) Then
                                FREDConnect = ""
                            Else
                                FREDConnect = dr.Item("FREDConnect")
                            End If
                        End While
                        dr.Close()
                    End If

                    Select Case ddlFREDFilterOption3.SelectedValue
                        Case "≠" '<> 
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " <> " & SQLDataType & Replace(txtFREDFilter3.Text, " '", "''") & SQLDataType & " "
                            If txtFREDFilter3.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter3.Text) = 0 Then
                                    baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                    baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter3.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                    baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "like"
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"
                            If txtFREDFilter3.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                        Case "contains" 'AKA in 
                            tempFRED = ""
                            If txtFREDFilter3.Text.Contains(",") Then
                                temp = txtFREDFilter3.Text
                                txtFREDFilter3.Text = Replace(txtFREDFilter3.Text, "'", "''")
                                Do While txtFREDFilter3.Text.Contains(",")
                                    If InStr(txtFREDFilter3.Text, ",") > 0 Then
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1), ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1), ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            ElseIf (Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1) Mod 1) <> 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1), ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1), ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1) & "',"
                                        txtFREDFilter3.Text = Mid(txtFREDFilter3.Text, InStr(txtFREDFilter3.Text, ",") + 1, Len(txtFREDFilter3.Text))
                                    Else
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(txtFREDFilter3.Text) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            ElseIf (txtFREDFilter3.Text Mod 1) <> 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & txtFREDFilter3.Text & "'"
                                        txtFREDFilter3.Text = ""
                                    End If
                                Loop
                                If Len(txtFREDFilter3.Text) > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter3.Text) = 0 Then
                                            txtFREDFilter3.Text = temp
                                            baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                            txtFREDFilter3.Text = temp
                                            baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter3.Text Mod 1) <> 0 Then
                                            txtFREDFilter3.Text = temp
                                            baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                            txtFREDFilter3.Text = temp
                                            baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter3.Text & "'"
                                End If
                                If tempFRED.EndsWith(",") Then
                                    tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                                End If
                                txtFREDFilter3.Text = temp
                            Else
                                If txtFREDFilter3.Text = "" Then
                                    blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter3.Text) = 0 Then
                                        baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                        baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter3.Text Mod 1) <> 0 Then
                                        baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                        baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = "'" & txtFREDFilter3.Text & "'"
                            End If
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " in (" & tempFRED & ") "
                            temp = ""
                        Case "not like"
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"
                            If txtFREDFilter3.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                        Case "does not contain" 'AKA not in 
                            tempFRED = ""
                            If txtFREDFilter3.Text.Contains(",") Then
                                temp = txtFREDFilter3.Text
                                txtFREDFilter3.Text = Replace(txtFREDFilter3.Text, "'", "''")
                                Do While txtFREDFilter3.Text.Contains(",")
                                    If InStr(txtFREDFilter3.Text, ",") > 0 Then
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1), ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1), ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            ElseIf (Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1) Mod 1) <> 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1), ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1), ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1) & "',"
                                        txtFREDFilter3.Text = Mid(txtFREDFilter3.Text, InStr(txtFREDFilter3.Text, ",") + 1, Len(txtFREDFilter3.Text))
                                    Else
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(txtFREDFilter3.Text) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            ElseIf (txtFREDFilter3.Text Mod 1) <> 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                                txtFREDFilter3.Text = temp
                                                baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & txtFREDFilter3.Text & "'"
                                        txtFREDFilter3.Text = ""
                                    End If
                                Loop
                                If Len(txtFREDFilter3.Text) > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter3.Text) = 0 Then
                                            txtFREDFilter3.Text = temp
                                            baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                            txtFREDFilter3.Text = temp
                                            baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter3.Text Mod 1) <> 0 Then
                                            txtFREDFilter3.Text = temp
                                            baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                            txtFREDFilter3.Text = temp
                                            baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter3.Text & "'"
                                End If
                                If tempFRED.EndsWith(",") Then
                                    tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                                End If
                                txtFREDFilter3.Text = temp
                            Else
                                If txtFREDFilter3.Text = "" Then
                                    blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter3.Text) = 0 Then
                                        baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                        baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter3.Text Mod 1) <> 0 Then
                                        baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                        baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = "'" & txtFREDFilter3.Text & "'"
                            End If
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not in (" & tempFRED & ") "
                            temp = ""
                        Case "between"
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between " & SQLDataType & Replace(numFREDFilter3Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter3End.Text, "'", "''") & SQLDataType & "  "
                            If numFREDFilter3Start.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If numFREDFilter3End.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(numFREDFilter3Start.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3Start.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(numFREDFilter3End.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3End.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(numFREDFilter3Start.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3Start.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter3End.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3End.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter3Start.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3Start.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter3End.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3End.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(numFREDFilter3Start.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3Start.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter3End.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3End.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            End If

                        Case "not between"
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter3Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter3End.Text, "'", "''") & SQLDataType & "  "
                            If numFREDFilter3Start.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If numFREDFilter3End.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(numFREDFilter3Start.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3Start.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(numFREDFilter3End.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3End.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(numFREDFilter3Start.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3Start.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter3End.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3End.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter3Start.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3Start.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter3End.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3End.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(numFREDFilter3Start.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3Start.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter3End.Text) = 0 Then
                                    baddata(3, rememberdatatype, numFREDFilter3End.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "DATE between"
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between " & SQLDataType & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & SQLDataType & "  "
                            If dtpFREDFilter3StartDate.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If dtpFREDFilter3EndDate.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(dtpFREDFilter3StartDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3StartDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(dtpFREDFilter3EndDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3EndDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(dtpFREDFilter3StartDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3StartDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter3EndDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3EndDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter3StartDate.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3StartDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter3EndDate.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3EndDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(dtpFREDFilter3StartDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3StartDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter3EndDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3EndDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "DATE not between"
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & SQLDataType & "  "
                            If dtpFREDFilter3StartDate.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If dtpFREDFilter3EndDate.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(dtpFREDFilter3StartDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3StartDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(dtpFREDFilter3EndDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3EndDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(dtpFREDFilter3StartDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3StartDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter3EndDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3EndDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter3StartDate.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3StartDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter3EndDate.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3EndDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(dtpFREDFilter3StartDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3StartDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter3EndDate.Text) = 0 Then
                                    baddata(3, rememberdatatype, dtpFREDFilter3EndDate.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "Null"
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NULL "
                        Case "Not Null"
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NOT NULL "
                        Case Else  '=,  <, <=, >, >=
                            tempFRED = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " " & ddlFREDFilterOption3.Text & " " & SQLDataType & Replace(txtFREDFilter3.Text, "'", "''") & SQLDataType & " "
                            If txtFREDFilter3.Text = "" Then
                                blankpopup(3, SQLDataType, ddlFREDFilter3.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter3.Text) = 0 Then
                                    baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                    baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter3.Text Mod 1) <> 0 Then
                                    baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter3.Text) = 0 Then
                                    baddata(3, rememberdatatype, txtFREDFilter3.Text, ddlFREDFilter3.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                    End Select

                    Dim EncTrans As DataRow
                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter3.SelectedIndex)
                    If CInt(EncTrans("FREDType").ToString) = 0 Then
                        'Encounter Table
                        'Select Case FREDFilter3
                        '    Case lblFREDTable1.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable2.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable3.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable4.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                        '    Case FREDFilter1
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "FF1") & " and "
                        '    Case FREDFilter2
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "FF2") & " and "
                        '    Case Else
                        '        SQLTable = SQLTable & " inner join " & FREDFilter3 & " as FF3 on a.PatientAccountFacility = FF3." & FREDConnect & " "
                        '        Whereclause = Whereclause & " " & tempFRED & " and "
                        'End Select

                        If FREDFilter3 = lblFREDTable1.Text And FRED1chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter3 = lblFREDTable2.Text And FRED2chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter3 = lblFREDTable3.Text And FRED3chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter3 = lblFREDTable4.Text And FRED4chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter3 = FREDFilter1 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "FF1") & " and "
                        ElseIf FREDFilter3 = FREDFilter2 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "FF2") & " and "
                        Else
                            SQLTable = SQLTable & " inner join " & FREDFilter3 & " as FF3 with (nolock) on a.PatientAccountFacility = FF3." & FREDConnect & " "
                            Whereclause = Whereclause & " " & tempFRED & " and "
                        End If

                    Else
                        'Transaction Table
                        If FREDFilter3 = lblFREDTableTrans.Text And FREDTranschk > 0 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "[" & Replace(lblFREDSelectTrans.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter3 = FREDFilter1 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "FF1") & " and "
                        ElseIf FREDFilter3 = FREDFilter1 And notNumbers.Contains(ddlFREDFilterOption1.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption3.SelectedValue) Then
                            Select Case ddlFREDFilterOption3.SelectedValue
                                Case "≠"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF1"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF1"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF1"), " not in (", " in (") & ") and "
                                Case "date not between"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF1"), " not between ", " between ") & ") and "
                                Case "not between"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF1"), " not between ", " between ") & ") and "
                                Case Else
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(tempFRED, "FF3", "FF1") & ") and "
                            End Select
                        ElseIf FREDFilter3 = FREDFilter2 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF3", "FF2") & " and "
                        ElseIf FREDFilter3 = FREDFilter2 And notNumbers.Contains(ddlFREDFilterOption2.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption3.SelectedValue) Then
                            Select Case ddlFREDFilterOption3.SelectedValue
                                Case "≠"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF2"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF2"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF2"), " not in (", " in (") & ") and "
                                Case "not between"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF2"), " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF3", "FF2"), " not between ", " between ") & ") and "
                                Case Else
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(tempFRED, "FF3", "FF2") & ") and "
                            End Select
                        Else
                            Select Case ddlFREDFilterOption3.SelectedValue
                                Case "≠"
                                    exists3 = " not exists (Select * from " & FREDFilter3 & " FF3 with (nolock) where a.PatientAccountFacility = FF3." & FREDConnect & " and " & _
                                        Replace(tempFRED, " <> ", " = ") & ") and "
                                Case "not like"
                                    exists3 = " not exists (Select * from " & FREDFilter3 & " FF3 with (nolock) where a.PatientAccountFacility = FF3." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists3 = " not exists (Select * from " & FREDFilter3 & " FF3 with (nolock) where a.PatientAccountFacility = FF3." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not in (", " in (") & ") and "
                                Case "not between"
                                    exists3 = " not exists (Select * from " & FREDFilter3 & " FF3 with (nolock) where a.PatientAccountFacility = FF3." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists3 = " not exists (Select * from " & FREDFilter3 & " FF3 with (nolock) where a.PatientAccountFacility = FF3." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not between ", " between ") & ") and "
                                Case Else
                                    exists3 = " exists (Select * from " & FREDFilter3 & " FF3 with (nolock) where a.PatientAccountFacility = FF3." & FREDConnect & " and " & tempFRED & ") and "
                            End Select
                        End If
                    End If

                    ' SQLTable = SQLTable & _
                    '" inner join " & FREDFilter3 & " as FF3 on a.PatientAccountFacility = FF3." & FREDConnect & " and " & tempFRED & " "
                End Using
            End If
            If rblFREDFilter4.SelectedIndex <> 0 Then
                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    If rblFREDFilter4.SelectedIndex <> 0 Then
                        SQL = "select " & _
                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                     ",COLUMN_NAME as FREDConnect,   " & _
                     "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter4.SelectedValue.ToString & _
                     "  and Column_Alias = '" & ddlFREDFilter4.SelectedValue & "' ) as dataType " & _
                     "from WebFD.FRED.vw_AvailableData " & _
                     "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        cmd = New SqlCommand(SQL, conn)
                        dr = cmd.ExecuteReader
                        While dr.Read
                            If IsDBNull(dr.Item("dataType")) Then
                                SQLDataType = "'"
                            Else
                                SQLDataType = dr.Item("dataType")
                                If InStr(SQLDataType, "date") > 0 Or InStr(SQLDataType, "time") > 0 Or InStr(SQLDataType, "char") > 0 Or InStr(SQLDataType, "text") > 0 Then
                                    rememberdatatype = SQLDataType
                                    SQLDataType = "'"
                                Else
                                    rememberdatatype = SQLDataType
                                    SQLDataType = ""
                                End If
                            End If
                            'get the full table name of the first filtered option
                            If IsDBNull(dr.Item("FREDTable")) Then
                                FREDFilter4 = ""
                            Else
                                FREDFilter4 = dr.Item("FREDTable")
                            End If
                            If IsDBNull(dr.Item("FREDConnect")) Then
                                FREDConnect = ""
                            Else
                                FREDConnect = dr.Item("FREDConnect")
                            End If
                        End While
                        dr.Close()
                    End If

                    Select Case ddlFREDFilterOption4.SelectedValue
                        Case "≠" '<> 
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " <> " & SQLDataType & Replace(txtFREDFilter4.Text, " '", "''") & SQLDataType & " "
                            If txtFREDFilter4.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter4.Text) = 0 Then
                                    baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                    baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter4.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                    baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "like"
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"
                            If txtFREDFilter4.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                        Case "contains" 'AKA in 
                            tempFRED = ""
                            If txtFREDFilter4.Text.Contains(",") Then
                                temp = txtFREDFilter4.Text
                                txtFREDFilter4.Text = Replace(txtFREDFilter4.Text, "'", "''")
                                Do While txtFREDFilter4.Text.Contains(",")
                                    If InStr(txtFREDFilter4.Text, ",") > 0 Then
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1), ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1), ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            ElseIf (Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1) Mod 1) <> 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1), ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1), ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1) & "',"
                                        txtFREDFilter4.Text = Mid(txtFREDFilter4.Text, InStr(txtFREDFilter4.Text, ",") + 1, Len(txtFREDFilter4.Text))
                                    Else
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(txtFREDFilter4.Text) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            ElseIf (txtFREDFilter4.Text Mod 1) <> 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & txtFREDFilter4.Text & "'"
                                        txtFREDFilter4.Text = ""
                                    End If
                                Loop
                                If Len(txtFREDFilter4.Text) > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter4.Text) = 0 Then
                                            txtFREDFilter4.Text = temp
                                            baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                            txtFREDFilter4.Text = temp
                                            baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter4.Text Mod 1) <> 0 Then
                                            txtFREDFilter4.Text = temp
                                            baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                            txtFREDFilter4.Text = temp
                                            baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter4.Text & "'"
                                End If
                                If tempFRED.EndsWith(",") Then
                                    tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                                End If
                                txtFREDFilter4.Text = temp
                            Else
                                If txtFREDFilter4.Text = "" Then
                                    blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter4.Text) = 0 Then
                                        baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                        baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter4.Text Mod 1) <> 0 Then
                                        baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                        baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = "'" & txtFREDFilter4.Text & "'"
                            End If
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " in (" & tempFRED & ") "
                            temp = ""
                        Case "not like"
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"
                            If txtFREDFilter4.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                        Case "does not contain" 'AKA not in 
                            tempFRED = ""
                            If txtFREDFilter4.Text.Contains(",") Then
                                temp = txtFREDFilter4.Text
                                txtFREDFilter4.Text = Replace(txtFREDFilter4.Text, "'", "''")
                                Do While txtFREDFilter4.Text.Contains(",")
                                    If InStr(txtFREDFilter4.Text, ",") > 0 Then
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1), ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1), ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            ElseIf (Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1) Mod 1) <> 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1), ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1), ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1) & "',"
                                        txtFREDFilter4.Text = Mid(txtFREDFilter4.Text, InStr(txtFREDFilter4.Text, ",") + 1, Len(txtFREDFilter4.Text))
                                    Else
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(txtFREDFilter4.Text) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            ElseIf (txtFREDFilter4.Text Mod 1) <> 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                                txtFREDFilter4.Text = temp
                                                baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & txtFREDFilter4.Text & "'"
                                        txtFREDFilter4.Text = ""
                                    End If
                                Loop
                                If Len(txtFREDFilter4.Text) > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter4.Text) = 0 Then
                                            txtFREDFilter4.Text = temp
                                            baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                            txtFREDFilter4.Text = temp
                                            baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter4.Text Mod 1) <> 0 Then
                                            txtFREDFilter4.Text = temp
                                            baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                            txtFREDFilter4.Text = temp
                                            baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter4.Text & "'"
                                End If
                                If tempFRED.EndsWith(",") Then
                                    tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                                End If
                                txtFREDFilter4.Text = temp
                            Else
                                If txtFREDFilter4.Text = "" Then
                                    blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter4.Text) = 0 Then
                                        baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                        baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter4.Text Mod 1) <> 0 Then
                                        baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                        baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = "'" & txtFREDFilter4.Text & "'"
                            End If
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not in (" & tempFRED & ") "
                            temp = ""
                        Case "between"
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between " & SQLDataType & Replace(numFREDFilter4Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter4End.Text, "'", "''") & SQLDataType & "  "
                            If numFREDFilter4Start.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If numFREDFilter4End.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(numFREDFilter4Start.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4Start.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(numFREDFilter4End.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4End.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(numFREDFilter4Start.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4Start.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter4End.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4End.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter4Start.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4Start.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter4End.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4End.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(numFREDFilter4Start.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4Start.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter4End.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4End.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            End If

                        Case "not between"
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter4Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter4End.Text, "'", "''") & SQLDataType & "  "
                            If numFREDFilter4Start.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If numFREDFilter4End.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(numFREDFilter4Start.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4Start.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(numFREDFilter4End.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4End.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(numFREDFilter4Start.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4Start.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter4End.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4End.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter4Start.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4Start.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter4End.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4End.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(numFREDFilter4Start.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4Start.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter4End.Text) = 0 Then
                                    baddata(4, rememberdatatype, numFREDFilter4End.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "DATE between"
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between " & SQLDataType & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & SQLDataType & "  "
                            If dtpFREDFilter4StartDate.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If dtpFREDFilter4EndDate.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(dtpFREDFilter4StartDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4StartDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(dtpFREDFilter4EndDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4EndDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(dtpFREDFilter4StartDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4StartDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter4EndDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4EndDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter4StartDate.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4StartDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter4EndDate.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4EndDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(dtpFREDFilter4StartDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4StartDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter4EndDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4EndDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "DATE not between"
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & SQLDataType & "  "
                            If dtpFREDFilter4StartDate.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If dtpFREDFilter4EndDate.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(dtpFREDFilter4StartDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4StartDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(dtpFREDFilter4EndDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4EndDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(dtpFREDFilter4StartDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4StartDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter4EndDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4EndDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter4StartDate.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4StartDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter4EndDate.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4EndDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(dtpFREDFilter4StartDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4StartDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter4EndDate.Text) = 0 Then
                                    baddata(4, rememberdatatype, dtpFREDFilter4EndDate.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "Null"
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NULL "
                        Case "Not Null"
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NOT NULL "
                        Case Else  '=,  <, <=, >, >=
                            tempFRED = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " " & ddlFREDFilterOption4.Text & " " & SQLDataType & Replace(txtFREDFilter4.Text, "'", "''") & SQLDataType & " "
                            If txtFREDFilter4.Text = "" Then
                                blankpopup(4, SQLDataType, ddlFREDFilter4.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter4.Text) = 0 Then
                                    baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                    baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter4.Text Mod 1) <> 0 Then
                                    baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter4.Text) = 0 Then
                                    baddata(4, rememberdatatype, txtFREDFilter4.Text, ddlFREDFilter4.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                    End Select

                    Dim EncTrans As DataRow
                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter4.SelectedIndex)
                    If CInt(EncTrans("FREDType").ToString) = 0 Then
                        'Encounter Table
                        'Select Case FREDFilter4
                        '    Case lblFREDTable1.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable2.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable3.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable4.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                        '    Case FREDFilter1
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF1") & " and "
                        '    Case FREDFilter2
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF2") & " and "
                        '    Case FREDFilter3
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF3") & " and "
                        '    Case Else
                        '        SQLTable = SQLTable & " inner join " & FREDFilter4 & " as FF4 on a.PatientAccountFacility = FF4." & FREDConnect & " "
                        '        Whereclause = Whereclause & " " & tempFRED & " and "
                        'End Select

                        If FREDFilter4 = lblFREDTable1.Text And FRED1chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter4 = lblFREDTable2.Text And FRED2chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter4 = lblFREDTable3.Text And FRED3chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter4 = lblFREDTable4.Text And FRED4chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter4 = FREDFilter1 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF1") & " and "
                        ElseIf FREDFilter4 = FREDFilter2 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF2") & " and "
                        ElseIf FREDFilter4 = FREDFilter3 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF3") & " and "
                        Else
                            SQLTable = SQLTable & " inner join " & FREDFilter4 & " as FF4 with (nolock) on a.PatientAccountFacility = FF4." & FREDConnect & " "
                            Whereclause = Whereclause & " " & tempFRED & " and "
                        End If

                    Else
                        'Transaction Table
                        If FREDFilter4 = lblFREDTableTrans.Text And FREDTranschk > 0 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "[" & Replace(lblFREDSelectTrans.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter4 = FREDFilter1 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF1") & " and "
                        ElseIf FREDFilter4 = FREDFilter1 And notNumbers.Contains(ddlFREDFilterOption1.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption4.SelectedValue) Then
                            Select Case ddlFREDFilterOption4.SelectedValue
                                Case "≠"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF1"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF1"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF1"), " not in (", " in (") & ") and "
                                Case "not between"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF1"), " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF1"), " not between ", " between ") & ") and "
                                Case Else
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(tempFRED, "FF4", "FF1") & ") and "
                            End Select
                        ElseIf FREDFilter4 = FREDFilter2 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF2") & " and "
                        ElseIf FREDFilter4 = FREDFilter2 And notNumbers.Contains(ddlFREDFilterOption2.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption4.SelectedValue) Then
                            Select Case ddlFREDFilterOption4.SelectedValue
                                Case "≠"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF2"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF2"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF2"), " not in (", " in (") & ") and "
                                Case "not between"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF2"), " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF2"), " not between ", " between ") & ") and "
                                Case Else
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(tempFRED, "FF4", "FF2") & ") and "
                            End Select
                        ElseIf FREDFilter4 = FREDFilter3 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF4", "FF3") & " and "
                        ElseIf FREDFilter4 = FREDFilter3 And notNumbers.Contains(ddlFREDFilterOption3.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption4.SelectedValue) Then
                            Select Case ddlFREDFilterOption4.SelectedValue
                                Case "≠"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF3"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF3"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF3"), " not in (", " in (") & ") and "
                                Case "not between"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF3"), " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF4", "FF3"), " not between ", " between ") & ") and "
                                Case Else
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(tempFRED, "FF4", "FF3") & ") and "
                            End Select
                        Else
                            Select Case ddlFREDFilterOption4.SelectedValue
                                Case "≠"
                                    exists4 = " not exists (Select * from " & FREDFilter4 & " FF4 with (nolock) where a.PatientAccountFacility = FF4." & FREDConnect & " and " & _
                                        Replace(tempFRED, " <> ", " = ") & ") and "
                                Case "not like"
                                    exists4 = " not exists (Select * from " & FREDFilter4 & " FF4 with (nolock) where a.PatientAccountFacility = FF4." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists4 = " not exists (Select * from " & FREDFilter4 & " FF4 with (nolock) where a.PatientAccountFacility = FF4." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not in (", " in (") & ") and "
                                Case "not between"
                                    exists4 = " not exists (Select * from " & FREDFilter4 & " FF4 with (nolock) where a.PatientAccountFacility = FF4." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not between ", " between ") & ") and "
                                Case "DATE not between"
                                    exists4 = " not exists (Select * from " & FREDFilter4 & " FF4 with (nolock) where a.PatientAccountFacility = FF4." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not between ", " between ") & ") and "
                                Case Else
                                    exists4 = " exists (Select * from " & FREDFilter4 & " FF4 with (nolock) where a.PatientAccountFacility = FF4." & FREDConnect & " and " & tempFRED & ") and "
                            End Select
                        End If
                    End If

                    '  SQLTable = SQLTable & _
                    ' " inner join " & FREDFilter4 & " as FF4 on a.PatientAccountFacility = FF4." & FREDConnect & " and " & tempFRED & " "
                End Using
            End If
            If rblFREDFilter5.SelectedIndex <> 0 Then
                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If
                    If rblFREDFilter5.SelectedIndex <> 0 Then
                        SQL = "select " & _
                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                     ",COLUMN_NAME as FREDConnect,   " & _
                     "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter5.SelectedValue.ToString & _
                     "  and Column_Alias = '" & ddlFREDFilter5.SelectedValue & "' ) as dataType " & _
                     "from WebFD.FRED.vw_AvailableData " & _
                     "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

                        If conn.State = ConnectionState.Closed Then
                            conn.Open()
                        End If
                        cmd = New SqlCommand(SQL, conn)
                        dr = cmd.ExecuteReader
                        While dr.Read
                            If IsDBNull(dr.Item("dataType")) Then
                                SQLDataType = "'"
                            Else
                                SQLDataType = dr.Item("dataType")
                                If InStr(SQLDataType, "date") > 0 Or InStr(SQLDataType, "time") > 0 Or InStr(SQLDataType, "char") > 0 Or InStr(SQLDataType, "text") > 0 Then
                                    rememberdatatype = SQLDataType
                                    SQLDataType = "'"
                                Else
                                    rememberdatatype = SQLDataType
                                    SQLDataType = ""
                                End If
                            End If
                            'get the full table name of the first filtered option
                            If IsDBNull(dr.Item("FREDTable")) Then
                                FREDFilter5 = ""
                            Else
                                FREDFilter5 = dr.Item("FREDTable")
                            End If
                            If IsDBNull(dr.Item("FREDConnect")) Then
                                FREDConnect = ""
                            Else
                                FREDConnect = dr.Item("FREDConnect")
                            End If
                        End While
                        dr.Close()
                    End If

                    Select Case ddlFREDFilterOption5.SelectedValue
                        Case "≠" '<> 
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " <> " & SQLDataType & Replace(txtFREDFilter5.Text, " '", "''") & SQLDataType & " "
                            If txtFREDFilter5.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter5.Text) = 0 Then
                                    baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                    baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter5.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                    baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "like"
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"
                            If txtFREDFilter5.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                        Case "contains" 'AKA in 
                            tempFRED = ""
                            If txtFREDFilter5.Text.Contains(",") Then
                                temp = txtFREDFilter5.Text
                                txtFREDFilter5.Text = Replace(txtFREDFilter5.Text, "'", "''")
                                Do While txtFREDFilter5.Text.Contains(",")
                                    If InStr(txtFREDFilter5.Text, ",") > 0 Then
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1), ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1), ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            ElseIf (Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1) Mod 1) <> 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1), ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1), ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1) & "',"
                                        txtFREDFilter5.Text = Mid(txtFREDFilter5.Text, InStr(txtFREDFilter5.Text, ",") + 1, Len(txtFREDFilter5.Text))
                                    Else
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(txtFREDFilter5.Text) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            ElseIf (txtFREDFilter5.Text Mod 1) <> 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & txtFREDFilter5.Text & "'"
                                        txtFREDFilter5.Text = ""
                                    End If
                                Loop
                                If Len(txtFREDFilter5.Text) > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter5.Text) = 0 Then
                                            txtFREDFilter5.Text = temp
                                            baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                            txtFREDFilter5.Text = temp
                                            baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter5.Text Mod 1) <> 0 Then
                                            txtFREDFilter5.Text = temp
                                            baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                            txtFREDFilter5.Text = temp
                                            baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter5.Text & "'"
                                End If
                                If tempFRED.EndsWith(",") Then
                                    tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                                End If
                                txtFREDFilter5.Text = temp
                            Else
                                If txtFREDFilter5.Text = "" Then
                                    blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter5.Text) = 0 Then
                                        baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                        baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter5.Text Mod 1) <> 0 Then
                                        baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                        baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = "'" & txtFREDFilter5.Text & "'"
                            End If
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " in (" & tempFRED & ") "
                            temp = ""
                        Case "not like"
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"
                            If txtFREDFilter5.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                        Case "does not contain" 'AKA not in 
                            tempFRED = ""
                            If txtFREDFilter5.Text.Contains(",") Then
                                temp = txtFREDFilter5.Text
                                txtFREDFilter5.Text = Replace(txtFREDFilter5.Text, "'", "''")
                                Do While txtFREDFilter5.Text.Contains(",")
                                    If InStr(txtFREDFilter5.Text, ",") > 0 Then
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1), ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1), ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            ElseIf (Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1) Mod 1) <> 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1), ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1)) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1), ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1) & "',"
                                        txtFREDFilter5.Text = Mid(txtFREDFilter5.Text, InStr(txtFREDFilter5.Text, ",") + 1, Len(txtFREDFilter5.Text))
                                    Else
                                        If InStr(rememberdatatype, "char") > 0 Then
                                        ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                            If IsDate(txtFREDFilter5.Text) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        ElseIf InStr(rememberdatatype, "int") > 0 Then
                                            If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            ElseIf (txtFREDFilter5.Text Mod 1) <> 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        Else
                                            If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                                txtFREDFilter5.Text = temp
                                                baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                                Exit Sub
                                            End If
                                        End If
                                        tempFRED = tempFRED & "'" & txtFREDFilter5.Text & "'"
                                        txtFREDFilter5.Text = ""
                                    End If
                                Loop
                                If Len(txtFREDFilter5.Text) > 0 Then
                                    If InStr(rememberdatatype, "char") > 0 Then
                                    ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                        If IsDate(txtFREDFilter5.Text) = 0 Then
                                            txtFREDFilter5.Text = temp
                                            baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                            Exit Sub
                                        End If
                                    ElseIf InStr(rememberdatatype, "int") > 0 Then
                                        If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                            txtFREDFilter5.Text = temp
                                            baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                            Exit Sub
                                        ElseIf (txtFREDFilter5.Text Mod 1) <> 0 Then
                                            txtFREDFilter5.Text = temp
                                            baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                            Exit Sub
                                        End If
                                    Else
                                        If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                            txtFREDFilter5.Text = temp
                                            baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                            Exit Sub
                                        End If
                                    End If
                                    tempFRED = tempFRED & "'" & txtFREDFilter5.Text & "'"
                                End If
                                If tempFRED.EndsWith(",") Then
                                    tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
                                End If
                                txtFREDFilter5.Text = temp
                            Else
                                If txtFREDFilter5.Text = "" Then
                                    blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                                If InStr(rememberdatatype, "char") > 0 Then
                                ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                    If IsDate(txtFREDFilter5.Text) = 0 Then
                                        baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                        Exit Sub
                                    End If
                                ElseIf InStr(rememberdatatype, "int") > 0 Then
                                    If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                        baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                        Exit Sub
                                    ElseIf (txtFREDFilter5.Text Mod 1) <> 0 Then
                                        baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                        Exit Sub
                                    End If
                                Else
                                    If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                        baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                        Exit Sub
                                    End If
                                End If
                                tempFRED = "'" & txtFREDFilter5.Text & "'"
                            End If
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not in (" & tempFRED & ") "
                            temp = ""
                        Case "between"
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between " & SQLDataType & Replace(numFREDFilter5Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter5End.Text, "'", "''") & SQLDataType & "  "
                            If numFREDFilter5Start.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If numFREDFilter5End.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(numFREDFilter5Start.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5Start.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(numFREDFilter5End.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5End.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(numFREDFilter5Start.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5Start.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter5End.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5End.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter5Start.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5Start.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter5End.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5End.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(numFREDFilter5Start.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5Start.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter5End.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5End.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            End If

                        Case "not between"
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter5Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter5End.Text, "'", "''") & SQLDataType & "  "
                            If numFREDFilter5Start.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If numFREDFilter5End.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(numFREDFilter5Start.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5Start.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(numFREDFilter5End.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5End.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(numFREDFilter5Start.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5Start.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter5End.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5End.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter5Start.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5Start.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (numFREDFilter5End.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5End.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(numFREDFilter5Start.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5Start.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(numFREDFilter5End.Text) = 0 Then
                                    baddata(5, rememberdatatype, numFREDFilter5End.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "DATE between"
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between " & SQLDataType & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & SQLDataType & "  "
                            If dtpFREDFilter5StartDate.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If dtpFREDFilter5EndDate.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(dtpFREDFilter5StartDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5StartDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(dtpFREDFilter5EndDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5EndDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(dtpFREDFilter5StartDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5StartDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter5EndDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5EndDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter5StartDate.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5StartDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter5EndDate.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5EndDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(dtpFREDFilter5StartDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5StartDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter5EndDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5EndDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "DATE not between"
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & SQLDataType & "  "
                            If dtpFREDFilter5StartDate.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If dtpFREDFilter5EndDate.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(dtpFREDFilter5StartDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5StartDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsDate(dtpFREDFilter5EndDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5EndDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(dtpFREDFilter5StartDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5StartDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter5EndDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5EndDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter5StartDate.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5StartDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (dtpFREDFilter5EndDate.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5EndDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(dtpFREDFilter5StartDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5StartDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf IsNumeric(dtpFREDFilter5EndDate.Text) = 0 Then
                                    baddata(5, rememberdatatype, dtpFREDFilter5EndDate.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                        Case "Null"
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NULL "
                        Case "Not Null"
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NOT NULL "
                        Case Else  '=,  <, <=, >, >=
                            tempFRED = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " " & ddlFREDFilterOption5.Text & " " & SQLDataType & Replace(txtFREDFilter5.Text, "'", "''") & SQLDataType & " "
                            If txtFREDFilter5.Text = "" Then
                                blankpopup(5, SQLDataType, ddlFREDFilter5.SelectedValue)
                                Exit Sub
                            End If
                            If InStr(rememberdatatype, "char") > 0 Then
                            ElseIf InStr(rememberdatatype, "date") > 0 Or InStr(SQLDataType, "time") > 0 Then
                                If IsDate(txtFREDFilter5.Text) = 0 Then
                                    baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            ElseIf InStr(rememberdatatype, "int") > 0 Then
                                If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                    baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                ElseIf (txtFREDFilter5.Text Mod 1) <> 0 Then
                                    baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            Else
                                If IsNumeric(txtFREDFilter5.Text) = 0 Then
                                    baddata(5, rememberdatatype, txtFREDFilter5.Text, ddlFREDFilter5.SelectedValue)
                                    Exit Sub
                                End If
                            End If
                    End Select

                    Dim EncTrans As DataRow
                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter5.SelectedIndex)
                    If CInt(EncTrans("FREDType").ToString) = 0 Then
                        'Encounter Table
                        'Select Case FREDFilter5
                        '    Case lblFREDTable1.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable2.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable3.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                        '    Case lblFREDTable4.Text
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                        '    Case FREDFilter1
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF1") & " and "
                        '    Case FREDFilter2
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF2") & " and "
                        '    Case FREDFilter3
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF3") & " and "
                        '    Case FREDFilter4
                        '        Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF4") & " and "
                        '    Case Else
                        '        SQLTable = SQLTable & " inner join " & FREDFilter5 & " as FF5 on a.PatientAccountFacility = FF5." & FREDConnect & " "
                        '        Whereclause = Whereclause & " " & tempFRED & " and "
                        'End Select


                        If FREDFilter5 = lblFREDTable1.Text And FRED1chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelect1.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter5 = lblFREDTable2.Text And FRED2chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelect2.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter5 = lblFREDTable3.Text And FRED3chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelect3.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter5 = lblFREDTable4.Text And FRED4chk > 0 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelect4.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter5 = FREDFilter1 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF1") & " and "
                        ElseIf FREDFilter5 = FREDFilter2 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF2") & " and "
                        ElseIf FREDFilter5 = FREDFilter3 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF3") & " and "
                        ElseIf FREDFilter5 = FREDFilter4 Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF4") & " and "
                        Else
                            SQLTable = SQLTable & " inner join " & FREDFilter5 & " as FF5 with (nolock) on a.PatientAccountFacility = FF5." & FREDConnect & " "
                            Whereclause = Whereclause & " " & tempFRED & " and "
                        End If

                    Else
                        'Transaction Table
                        If FREDFilter5 = lblFREDTableTrans.Text And FREDTranschk > 0 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "[" & Replace(lblFREDSelectTrans.Text, ">>", "") & "]") & " and "
                        ElseIf FREDFilter5 = FREDFilter1 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF1") & " and "
                        ElseIf FREDFilter5 = FREDFilter1 And notNumbers.Contains(ddlFREDFilterOption1.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption5.SelectedValue) Then
                            Select Case ddlFREDFilterOption5.SelectedValue
                                Case "≠"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF1"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF1"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF1"), " not in (", " in (") & ") and "
                                Case "not between"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF1"), " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF1"), " not between ", " between ") & ") and "
                                Case Else
                                    exists1 = Left(exists1, Len(exists1) - 6) & " and " & Replace(tempFRED, "FF5", "FF1") & ") and "
                            End Select
                        ElseIf FREDFilter5 = FREDFilter2 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF2") & " and "
                        ElseIf FREDFilter5 = FREDFilter2 And notNumbers.Contains(ddlFREDFilterOption2.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption5.SelectedValue) Then
                            Select Case ddlFREDFilterOption5.SelectedValue
                                Case "≠"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF2"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF2"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF2"), " not in (", " in (") & ") and "
                                Case "not between"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF2"), " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF2"), " not between ", " between ") & ") and "
                                Case Else
                                    exists2 = Left(exists2, Len(exists2) - 6) & " and " & Replace(tempFRED, "FF5", "FF2") & ") and "
                            End Select
                        ElseIf FREDFilter5 = FREDFilter3 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF3") & " and "
                        ElseIf FREDFilter5 = FREDFilter3 And notNumbers.Contains(ddlFREDFilterOption3.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption5.SelectedValue) Then
                            Select Case ddlFREDFilterOption5.SelectedValue
                                Case "≠"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF3"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF3"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF3"), " not in (", " in (") & ") and "
                                Case "not between"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF3"), " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF3"), " not between ", " between ") & ") and "
                                Case Else
                                    exists3 = Left(exists3, Len(exists3) - 6) & " and " & Replace(tempFRED, "FF5", "FF3") & ") and "
                            End Select
                        ElseIf FREDFilter5 = FREDFilter4 And chbWhereExists.Checked = True Then
                            Whereclause = Whereclause & " " & Replace(tempFRED, "FF5", "FF4") & " and "
                        ElseIf FREDFilter5 = FREDFilter4 And notNumbers.Contains(ddlFREDFilterOption4.SelectedValue) = notNumbers.Contains(ddlFREDFilterOption5.SelectedValue) Then
                            Select Case ddlFREDFilterOption5.SelectedValue
                                Case "≠"
                                    exists4 = Left(exists4, Len(exists4) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF4"), " <> ", " = ") & ") and "
                                Case "not like"
                                    exists4 = Left(exists4, Len(exists4) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF4"), " not like '%", " like '%") & ") and "
                                Case "does not contain"
                                    exists4 = Left(exists4, Len(exists4) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF4"), " not in (", " in (") & ") and "
                                Case "not between"
                                    exists4 = Left(exists4, Len(exists4) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF4"), " not between ", " between ") & ") and "
                                Case "date not between"
                                    exists4 = Left(exists4, Len(exists4) - 6) & " and " & Replace(Replace(tempFRED, "FF5", "FF4"), " not between ", " between ") & ") and "
                                Case Else
                                    exists4 = Left(exists4, Len(exists4) - 6) & " and " & Replace(tempFRED, "FF5", "FF4") & ") and "
                            End Select
                        Else
                            Select Case ddlFREDFilterOption5.SelectedValue
                                Case "≠"
                                    exists5 = " not exists (Select * from " & FREDFilter5 & " FF5 with (nolock) where a.PatientAccountFacility = FF5." & FREDConnect & " and " & _
                                        Replace(tempFRED, " <> ", " = ") & ") and "
                                Case "not like"
                                    exists5 = " not exists (Select * from " & FREDFilter5 & " FF5 with (nolock) where a.PatientAccountFacility = FF5." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not like '%", " like '%") & ") and "
                                Case "not in"
                                    exists5 = " not exists (Select * from " & FREDFilter5 & " FF5 with (nolock) where a.PatientAccountFacility = FF5." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not in (", " in (") & ") and "
                                Case "not between"
                                    exists5 = " not exists (Select * from " & FREDFilter5 & " FF5 with (nolock) where a.PatientAccountFacility = FF5." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not between ", " between ") & ") and "
                                Case "DATE not between"
                                    exists5 = " not exists (Select * from " & FREDFilter5 & " FF5 with (nolock) where a.PatientAccountFacility = FF5." & FREDConnect & " and " & _
                                        Replace(tempFRED, " not between ", " between ") & ") and "
                                Case Else
                                    exists5 = " exists (Select * from " & FREDFilter5 & " FF5 with (nolock) where a.PatientAccountFacility = FF5." & FREDConnect & " and " & tempFRED & ") and "
                            End Select
                        End If
                    End If

                    ' SQLTable = SQLTable & _
                    ' " inner join " & FREDFilter5 & " as FF5 on a.PatientAccountFacility = FF5." & FREDConnect & " and " & tempFRED & " "
                End Using
            End If

            SQLTable = SQLTable & " " & Whereclause & exists1 & exists2 & exists3 & exists4 & exists5
            SQLTable = Left(SQLTable, Len(SQLTable) - 5)

            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                timestamp = Replace(Replace(Replace(Today.ToShortDateString & "_" & TimeOfDay.ToShortTimeString, "/", "_"), ":", "_"), " ", "")

                FREDTemp = "If Object_ID('WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & "') is not null " & _
              " begin " & _
                 "Drop table WebFD.FredTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & _
              " end; "



                FREDTemp = FREDTemp & _
                 "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = ' SET NOCOUNT ON select a.PatientAccountNumber, a.Facility, " & SQLSelect & _
                    " into WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & _
                        Replace(SQLTable, "'", "'+CHAR(39)+'") & " '	 EXECUTE	SP_EXECUTESQL @FinalQuery   "

                Dim storequery As String
                storequery = "Insert into [WebFD].[FRED].[RecentQueries] ([USERID] ,[SQL],[DateRun]) Values ('" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & _
                    "',  ' SET NOCOUNT ON select a.PatientAccountNumber, a.Facility, " & SQLSelect & " into WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & _
                        Replace(SQLTable, "'", "'+CHAR(39)+'") & " ', getdate()) ;" & _
                        " WITH [Too Many] AS " & _
                        "( SELECT " & _
                        "   RN = ROW_NUMBER() OVER (partition by USERID ORDER BY DateRun DESC)," & _
                        "                [USERID], [SQL], [DateRun] " & _
                        "                FROM WebFD.FRED.RecentQueries )" & _
                        " DELETE FROM [Too Many] WHERE RN > 10"

                cmdquery = New SqlCommand(storequery, conn)
                cmdquery.ExecuteNonQuery()
                cmd = New SqlCommand(FREDTemp, conn)
                cmd.CommandTimeout = 86400
                cmd.ExecuteNonQuery()
            End Using

            SQL = "select top 25 * from WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp
            SQL2 = "Select count(*) from WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & " with (nolock)"
            SQL3 = "select  * from WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp & " with (nolock)"

            lblSQLStatement.Text = SQL3.ToString

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            '  lblResults.Text = "Count: 0 "
        End Try
    End Sub


#Region "Back up of Build FRED code"

    'Sub BuildFRED()
    '    Try
    '        Dim temp As String = ""
    '        Dim SQLSelect As String = ""
    '        Dim SQLTable As String = ""
    '        Dim tempFRED As String = ""
    '        Dim FREDFilter1 As String = ""
    '        Dim FREDFilter2 As String = ""
    '        Dim FREDFilter3 As String = ""
    '        Dim FREDFilter4 As String = ""
    '        Dim FREDFilter5 As String = ""
    '        Dim SQLWhere As String = ""
    '        Dim SQLFRED As String = ""
    '        Dim SQLDataType As String = ""
    '        Dim FREDConnect As String = ""
    '        Dim FREDTemp As String = ""
    '        Dim FREDchk As String = ""


    '        Dim ERRORMESSAGE As String = "ERRORMESSAGE GOES HERE"
    '        FREDTemp = "If Object_ID('WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "') is not null " & _
    '            " begin " & _
    '               "Drop table WebFD.FredTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & _
    '            " end; " & _
    '            " Create table WebFD.FredTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & " ( " & _
    '            ""

    '        For i As Integer = 0 To cblFREDSelect1.Items.Count - 1
    '            If cblFREDSelect1.Items(i).Selected = True Then
    '                SQLSelect = SQLSelect & Mid(cblFREDSelect1.Items(i).Value, 4, InStr(cblFREDSelect1.Items(i).Value, "Desc:") - 5) & ","
    '            End If
    '        Next
    '        For i As Integer = 0 To cblFREDSelect2.Items.Count - 1
    '            If cblFREDSelect2.Items(i).Selected = True Then
    '                SQLSelect = SQLSelect & Mid(cblFREDSelect2.Items(i).Value, 4, InStr(cblFREDSelect2.Items(i).Value, "Desc:") - 5) & ","
    '            End If
    '        Next
    '        For i As Integer = 0 To cblFREDSelect3.Items.Count - 1
    '            If cblFREDSelect3.Items(i).Selected = True Then
    '                SQLSelect = SQLSelect & Mid(cblFREDSelect3.Items(i).Value, 4, InStr(cblFREDSelect3.Items(i).Value, "Desc:") - 5) & ","
    '            End If
    '        Next
    '        If SQLSelect <> "" Then
    '            SQLSelect = Mid(SQLSelect, 1, Len(SQLSelect) - 1)
    '        Else
    '            lblResults.Text = "Count: 0 - NO COLUMNS SELECTED TO THE LEFT. "
    '            Exit Sub
    '        End If

    '        SQL = "declare @SQLTables as varchar(max) " & _
    '      "declare  @SQLSelect as  varchar(max) " & _
    '      "set @SQLSelect = ''  SELECT  @SQLSelect  = @SQLSelect +  " & _
    '      "(TABLE_CATALOG + '.' + TABLE_SCHEMA + '.' + TABLE_NAME + '.[' + COLUMN_NAME+']' + ' as ' + TABLE_NAME + '_' +COLUMN_NAME   ) + ',' " & _
    '      "FROM [WebFD].[FRED].[vw_AvailableData] " & _
    '      "where COLUMN_ID in (" & SQLSelect & ") " & _
    '      "if len(@SQLSelect)  > 1  " & _
    '      "begin  " & _
    '      "set @SQLSelect = SUBSTRING(@SQLSelect, 1, Len(@SQLSelect) - 1) " & _
    '      "end  " & _
    '      "select @SQLSelect as 'SQLSelect'   "

    '        Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '            If conn.State = ConnectionState.Closed Then
    '                conn.Open()
    '            End If

    '            cmd = New SqlCommand(SQL, conn)
    '            cmd.CommandTimeout = 86400

    '            dr = cmd.ExecuteReader
    '            While dr.Read
    '                If IsDBNull(dr.Item("SQLSelect")) Then
    '                    SQLSelect = ""
    '                Else : SQLSelect = dr.Item("SQLSelect")
    '                End If
    '            End While
    '            dr.Close()
    '        End Using

    '        If SQLSelect = "" Then
    '            lblResults.Text = "Count: 0 " & ERRORMESSAGE
    '            Exit Sub
    '        End If
    '        Dim chk As String = "0"
    '        If rblDataType.Items(1).Selected = True Then
    '            For i As Integer = 0 To cblFREDSelect1.Items.Count - 1
    '                If cblFREDSelect1.Items(i).Selected = True Then
    '                    chk = "1"
    '                End If
    '            Next
    '        End If
    '        If lblFREDTable1.Text <> "" And lblFREDTable2.Text <> "" Then
    '            SQLTable = " From " & lblFREDTable1.Text & _
    '           " left join " & lblFREDTable2.Text & " on " & lblFREDTable1.Text & "." & lblFREDKey1.Text & " = " & lblFREDTable2.Text & "." & lblFREDKey2.Text
    '        End If
    '        If lblFREDTable3.Text <> "" Then
    '            SQLTable = SQLTable & "  left join " & lblFREDTable3.Text & " on " & lblFREDTable1.Text & "." & lblFREDKey1.Text & " = " & lblFREDTable3.Text & "." & lblFREDKey3.Text
    '        End If

    '        Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '            If conn.State = ConnectionState.Closed Then
    '                conn.Open()
    '            End If

    '            If rblFREDFilter1.SelectedIndex <> 0 Then
    '                SQL = "select " & _
    '                "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                ",COLUMN_NAME as FREDConnect,   " & _
    '                "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter1.SelectedValue.ToString & _
    '                "  and Column_Alias = '" & ddlFREDFilter1.SelectedValue & "' ) as dataType " & _
    '                "from WebFD.FRED.vw_AvailableData " & _
    '                "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                cmd = New SqlCommand(SQL, conn)
    '                dr = cmd.ExecuteReader
    '                While dr.Read
    '                    If IsDBNull(dr.Item("dataType")) Then
    '                        SQLDataType = "'"
    '                    Else
    '                        SQLDataType = dr.Item("dataType")
    '                        If SQLDataType = "char" Or SQLDataType = "nvarchar" Or SQLDataType = "varchar" Then
    '                            SQLDataType = "'"
    '                        Else
    '                            SQLDataType = ""
    '                        End If
    '                    End If
    '                    'get the full table name of the first filtered option
    '                    If IsDBNull(dr.Item("FREDTable")) Then
    '                        FREDFilter1 = ""
    '                    Else
    '                        FREDFilter1 = dr.Item("FREDTable")
    '                    End If
    '                    If IsDBNull(dr.Item("FREDConnect")) Then
    '                        FREDConnect = ""
    '                    Else
    '                        FREDConnect = dr.Item("FREDConnect")
    '                    End If
    '                End While
    '                dr.Close()
    '                If lblFREDTable1.Text = FREDFilter1 Or lblFREDTable2.Text = FREDFilter1 Or lblFREDTable3.Text = FREDFilter1 Then
    '                    FREDchk = "Base"
    '                Else
    '                    FREDchk = "NO"
    '                End If

    '                Select Case ddlFREDFilterOption1.SelectedIndex
    '                    Case 1 '<> 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " <> " & SQLDataType & Replace(txtFREDFilter1.Text, " '", "''") & SQLDataType & " "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " = " & SQLDataType & Replace(txtFREDFilter1.Text, " '", "''") & SQLDataType & " "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 6 'like 
    '                        tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " like " & SQLDataType & "%" & Replace(txtFREDFilter1.Text, "'", "''") & "%" & SQLDataType & ""
    '                    Case 7 'contains AKA in 
    '                        If txtFREDFilter1.Text.Contains(",") Then
    '                            temp = txtFREDFilter1.Text
    '                            txtFREDFilter1.Text = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While txtFREDFilter1.Text.Contains(",")
    '                                If InStr(txtFREDFilter1.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1) & "',"
    '                                    txtFREDFilter1.Text = Mid(txtFREDFilter1.Text, InStr(txtFREDFilter1.Text, ",") + 1, Len(txtFREDFilter1.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter1.Text & "'"
    '                                    txtFREDFilter1.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter1.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter1.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter1.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter1.Text & "'"
    '                        End If
    '                        tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " in (" & tempFRED & ") "
    '                        temp = ""
    '                    Case 8 'not like 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " not like " & SQLDataType & "%" & Replace(txtFREDFilter1.Text, "'", "''") & "%" & SQLDataType & ""
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & "  like " & SQLDataType & "%" & Replace(txtFREDFilter1.Text, "'", "''") & "%" & SQLDataType & ""
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 9 'not contains AKA not in 
    '                        If txtFREDFilter1.Text.Contains(",") Then
    '                            temp = txtFREDFilter1.Text
    '                            txtFREDFilter1.Text = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While txtFREDFilter1.Text.Contains(",")
    '                                If InStr(txtFREDFilter1.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter1.Text, 1, InStr(txtFREDFilter1.Text, ",") - 1) & "',"
    '                                    txtFREDFilter1.Text = Mid(txtFREDFilter1.Text, InStr(txtFREDFilter1.Text, ",") + 1, Len(txtFREDFilter1.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter1.Text & "'"
    '                                    txtFREDFilter1.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter1.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter1.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter1.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter1.Text & "'"
    '                        End If

    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " not in (" & tempFRED & ") "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & "  in (" & tempFRED & ") "
    '                            FREDchk = "Flip"
    '                        End If
    '                        temp = ""
    '                    Case 10 'between 
    '                        tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " between " & SQLDataType & Replace(numFREDFilter1Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter1End.Text, "'", "''") & SQLDataType & "  "
    '                    Case 11 'not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter1Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter1End.Text, "'", "''") & SQLDataType & "  "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " between  " & SQLDataType & Replace(numFREDFilter1Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter1End.Text, "'", "''") & SQLDataType & "  "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 12 'Date between 
    '                        tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " between " & SQLDataType & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & SQLDataType & "  "
    '                    Case 13 'Date not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & SQLDataType & "  "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & "  between " & SQLDataType & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & SQLDataType & "  "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 14 'Null 
    '                        tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " is NULL "
    '                    Case 15 'Not Null 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " is NOT NULL "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " is NULL "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case Else  '=,  <, <=, >, >=
    '                        tempFRED = "[" & ddlFREDFilter1.SelectedValue & "]" & " " & ddlFREDFilterOption1.Text & " " & SQLDataType & Replace(txtFREDFilter1.Text, "'", "''") & SQLDataType & " "
    '                End Select

    '                If lblFREDTable1.Text = FREDFilter1 Or lblFREDTable2.Text = FREDFilter1 Or lblFREDTable3.Text = FREDFilter1 Then
    '                    'if Table is used in the select statement then add to the where clause 
    '                    FREDFilter1 = FREDFilter1 & "." & tempFRED
    '                Else
    '                    If FREDConnect <> "" Then
    '                        If FREDchk = "Flip" Then
    '                            FREDFilter1 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter1 & _
    '                            " where " & FREDFilter1 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                            " and " & FREDFilter1 & "." & tempFRED
    '                        End If
    '                        FREDFilter1 = " exists (select distinct " & FREDConnect & " from " & FREDFilter1 & _
    '                        " where " & FREDFilter1 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                        " and " & FREDFilter1 & "." & tempFRED
    '                    End If
    '                End If
    '            End If
    '            tempFRED = ""
    '            FREDConnect = ""
    '            SQLDataType = ""
    '            FREDchk = ""

    '            If rblFREDFilter2.SelectedIndex <> 0 Then
    '                SQL = "select " & _
    '                "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                ",COLUMN_NAME as FREDConnect,   " & _
    '                "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter2.SelectedValue.ToString & _
    '                "  and Column_Alias = '" & ddlFREDFilter2.SelectedValue & "' ) as dataType " & _
    '                "from WebFD.FRED.vw_AvailableData " & _
    '                "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                cmd = New SqlCommand(SQL, conn)
    '                dr = cmd.ExecuteReader
    '                While dr.Read
    '                    If IsDBNull(dr.Item("dataType")) Then
    '                        SQLDataType = "'"
    '                    Else
    '                        SQLDataType = dr.Item("dataType")
    '                        If SQLDataType = "char" Or SQLDataType = "nvarchar" Or SQLDataType = "varchar" Then
    '                            SQLDataType = "'"
    '                        Else
    '                            SQLDataType = ""
    '                        End If
    '                    End If
    '                    'get the full table name of the first filtered option
    '                    If IsDBNull(dr.Item("FREDTable")) Then
    '                        FREDFilter2 = ""
    '                    Else
    '                        FREDFilter2 = dr.Item("FREDTable")
    '                    End If
    '                    If IsDBNull(dr.Item("FREDConnect")) Then
    '                        FREDConnect = ""
    '                    Else
    '                        FREDConnect = dr.Item("FREDConnect")
    '                    End If
    '                End While
    '                dr.Close()
    '                If lblFREDTable1.Text = FREDFilter2 Or lblFREDTable2.Text = FREDFilter2 Or lblFREDTable3.Text = FREDFilter2 Then
    '                    FREDchk = "Base"
    '                Else
    '                    FREDchk = "NO"
    '                End If

    '                Select Case ddlFREDFilterOption2.SelectedIndex
    '                    Case 1 '<> 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " <> " & SQLDataType & Replace(txtFREDFilter2.Text, " '", "''") & SQLDataType & " "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " = " & SQLDataType & Replace(txtFREDFilter2.Text, " '", "''") & SQLDataType & " "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 6 'like 
    '                        tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " like " & SQLDataType & "%" & Replace(txtFREDFilter2.Text, "'", "''") & "%" & SQLDataType & ""
    '                    Case 7 'contains AKA in 
    '                        If txtFREDFilter2.Text.Contains(",") Then
    '                            temp = txtFREDFilter2.Text
    '                            txtFREDFilter2.Text = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While txtFREDFilter2.Text.Contains(",")
    '                                If InStr(txtFREDFilter2.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1) & "',"
    '                                    txtFREDFilter2.Text = Mid(txtFREDFilter2.Text, InStr(txtFREDFilter2.Text, ",") + 1, Len(txtFREDFilter2.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter2.Text & "'"
    '                                    txtFREDFilter2.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter2.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter2.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter2.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter2.Text & "'"
    '                        End If
    '                        tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " in (" & tempFRED & ") "
    '                        temp = ""
    '                    Case 8 'not like 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " not like " & SQLDataType & "%" & Replace(txtFREDFilter2.Text, "'", "''") & "%" & SQLDataType & ""
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & "  like " & SQLDataType & "%" & Replace(txtFREDFilter2.Text, "'", "''") & "%" & SQLDataType & ""
    '                            FREDchk = "Flip"
    '                        End If

    '                    Case 9 'not contains AKA not in 
    '                        If txtFREDFilter2.Text.Contains(",") Then
    '                            temp = txtFREDFilter2.Text
    '                            txtFREDFilter2.Text = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While txtFREDFilter2.Text.Contains(",")
    '                                If InStr(txtFREDFilter2.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter2.Text, 1, InStr(txtFREDFilter2.Text, ",") - 1) & "',"
    '                                    txtFREDFilter2.Text = Mid(txtFREDFilter2.Text, InStr(txtFREDFilter2.Text, ",") + 1, Len(txtFREDFilter2.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter2.Text & "'"
    '                                    txtFREDFilter2.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter2.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter2.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter2.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter2.Text & "'"
    '                        End If
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " not in (" & tempFRED & ") "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & "  in (" & tempFRED & ") "
    '                            FREDchk = "Flip"
    '                        End If
    '                        temp = ""
    '                    Case 10 'between 
    '                        tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " between " & SQLDataType & Replace(numFREDFilter2Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter2End.Text, "'", "''") & SQLDataType & "  "
    '                    Case 11 'not between
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter2Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter2End.Text, "'", "''") & SQLDataType & "  "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter2Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter2End.Text, "'", "''") & SQLDataType & "  "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 12 'Date between 
    '                        tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " between " & SQLDataType & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & SQLDataType & "  "
    '                    Case 13 'Date not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & SQLDataType & "  "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & SQLDataType & "  "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 14 'Null 
    '                        tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " is NULL "
    '                    Case 15 'Not Null 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " is NOT NULL "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " is NULL "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case Else  '=,  <, <=, >, >=
    '                        tempFRED = "[" & ddlFREDFilter2.SelectedValue & "]" & " " & ddlFREDFilterOption2.Text & " " & SQLDataType & Replace(txtFREDFilter2.Text, "'", "''") & SQLDataType & " "
    '                End Select

    '                If lblFREDTable1.Text = FREDFilter2 Or lblFREDTable2.Text = FREDFilter2 Or lblFREDTable3.Text = FREDFilter2 Then
    '                    'if Table is used in the select statement then add to the where clause 
    '                    FREDFilter2 = FREDFilter2 & "." & tempFRED
    '                Else
    '                    'if an exists statement includes filter option add to that statment
    '                    If FREDFilter1.Contains(FREDFilter2) Then
    '                        If FREDchk = "Flip" And FREDFilter1.StartsWith(" exists (") Then
    '                            FREDFilter2 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter2 & _
    '                             " where " & FREDFilter2 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                             " and " & FREDFilter2 & "." & tempFRED
    '                        Else
    '                            FREDFilter1 = FREDFilter1 & " and " & FREDFilter2 & "." & tempFRED
    '                            FREDFilter2 = ""
    '                        End If
    '                    Else
    '                        'if table is not used in the select statment or existing statemnt then start an exists statement 
    '                        If FREDConnect <> "" Then
    '                            If FREDchk = "Flip" Then
    '                                FREDFilter2 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter2 & _
    '                                " where " & FREDFilter2 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                " and " & FREDFilter2 & "." & tempFRED
    '                            Else
    '                                FREDFilter2 = " exists (select distinct " & FREDConnect & " from " & FREDFilter2 & _
    '                                  " where " & FREDFilter2 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                  " and " & FREDFilter2 & "." & tempFRED
    '                            End If
    '                        End If
    '                    End If
    '                End If

    '            End If
    '            tempFRED = ""
    '            FREDConnect = ""
    '            SQLDataType = ""
    '            FREDchk = ""

    '            If rblFREDFilter3.SelectedIndex <> 0 Then
    '                SQL = "select " & _
    '              "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '              ",COLUMN_NAME as FREDConnect,   " & _
    '              "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter3.SelectedValue.ToString & _
    '              "  and Column_Alias = '" & ddlFREDFilter3.SelectedValue & "' ) as dataType " & _
    '              "from WebFD.FRED.vw_AvailableData " & _
    '              "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                cmd = New SqlCommand(SQL, conn)
    '                dr = cmd.ExecuteReader
    '                While dr.Read
    '                    If IsDBNull(dr.Item("dataType")) Then
    '                        SQLDataType = "'"
    '                    Else
    '                        SQLDataType = dr.Item("dataType")
    '                        If SQLDataType = "char" Or SQLDataType = "nvarchar" Or SQLDataType = "varchar" Then
    '                            SQLDataType = "'"
    '                        Else
    '                            SQLDataType = ""
    '                        End If
    '                    End If
    '                    'get the full table name of the first filtered option
    '                    If IsDBNull(dr.Item("FREDTable")) Then
    '                        FREDFilter3 = ""
    '                    Else
    '                        FREDFilter3 = dr.Item("FREDTable")
    '                    End If
    '                    If IsDBNull(dr.Item("FREDConnect")) Then
    '                        FREDConnect = ""
    '                    Else
    '                        FREDConnect = dr.Item("FREDConnect")
    '                    End If
    '                End While
    '                dr.Close()
    '                If lblFREDTable1.Text = FREDFilter3 Or lblFREDTable2.Text = FREDFilter3 Or lblFREDTable3.Text = FREDFilter3 Then
    '                    FREDchk = "Base"
    '                Else
    '                    FREDchk = "NO"
    '                End If

    '                Select Case ddlFREDFilterOption3.SelectedIndex
    '                    Case 1 '<> 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " <> " & SQLDataType & Replace(txtFREDFilter3.Text, " '", "''") & SQLDataType & " "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " = " & SQLDataType & Replace(txtFREDFilter3.Text, " '", "''") & SQLDataType & " "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 6 'like 
    '                        tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " like " & SQLDataType & "%" & Replace(txtFREDFilter3.Text, "'", "''") & "%" & SQLDataType & ""
    '                    Case 7 'contains AKA in 
    '                        If txtFREDFilter3.Text.Contains(",") Then
    '                            temp = txtFREDFilter3.Text
    '                            txtFREDFilter3.Text = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While txtFREDFilter3.Text.Contains(",")
    '                                If InStr(txtFREDFilter3.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1) & "',"
    '                                    txtFREDFilter3.Text = Mid(txtFREDFilter3.Text, InStr(txtFREDFilter3.Text, ",") + 1, Len(txtFREDFilter3.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter3.Text & "'"
    '                                    txtFREDFilter3.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter3.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter3.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter3.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter3.Text & "'"
    '                        End If
    '                        tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " in (" & tempFRED & ") "
    '                        temp = ""
    '                    Case 8 'not like 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " not like " & SQLDataType & "%" & Replace(txtFREDFilter3.Text, "'", "''") & "%" & SQLDataType & ""
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " like " & SQLDataType & "%" & Replace(txtFREDFilter3.Text, "'", "''") & "%" & SQLDataType & ""
    '                            FREDchk = "Flip"
    '                        End If

    '                    Case 9 'not contains AKA not in 
    '                        If txtFREDFilter3.Text.Contains(",") Then
    '                            temp = txtFREDFilter3.Text
    '                            txtFREDFilter3.Text = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While txtFREDFilter3.Text.Contains(",")
    '                                If InStr(txtFREDFilter3.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter3.Text, 1, InStr(txtFREDFilter3.Text, ",") - 1) & "',"
    '                                    txtFREDFilter3.Text = Mid(txtFREDFilter3.Text, InStr(txtFREDFilter3.Text, ",") + 1, Len(txtFREDFilter3.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter3.Text & "'"
    '                                    txtFREDFilter3.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter3.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter3.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter3.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter3.Text & "'"
    '                        End If
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " not in (" & tempFRED & ") "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " in (" & tempFRED & ") "
    '                            FREDchk = "Flip"
    '                        End If
    '                        temp = ""
    '                    Case 10 'between 
    '                        tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " between " & SQLDataType & Replace(numFREDFilter3Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter3End.Text, "'", "''") & SQLDataType & "  "
    '                    Case 11 'not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " not between  " & SQLDataType & Replace(numFREDFilter3Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter3End.Text, "'", "''") & SQLDataType & "  "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " between  " & SQLDataType & Replace(numFREDFilter3Start.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(numFREDFilter3End.Text, "'", "''") & SQLDataType & "  "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 12 'Date between 
    '                        tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " between " & SQLDataType & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & SQLDataType & "  "
    '                    Case 13 'Date not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " not between " & SQLDataType & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & SQLDataType & "  "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & "  between " & SQLDataType & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & SQLDataType & " and " & SQLDataType & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & SQLDataType & "  "
    '                            FREDchk = "Flip"
    '                        End If

    '                    Case 14 'Null 
    '                        tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " is NULL "
    '                    Case 15 'Not Null 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " is NOT NULL "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " is  NULL "
    '                            FREDchk = "Flip"
    '                        End If

    '                    Case Else  '=,  <, <=, >, >=
    '                        tempFRED = "[" & ddlFREDFilter3.SelectedValue & "]" & " " & ddlFREDFilterOption3.Text & " " & SQLDataType & Replace(txtFREDFilter3.Text, "'", "''") & SQLDataType & " "
    '                End Select

    '                If lblFREDTable1.Text = FREDFilter3 Or lblFREDTable2.Text = FREDFilter3 Or lblFREDTable3.Text = FREDFilter3 Then
    '                    'if Table is used in the select statement then add to the where clause 
    '                    FREDFilter3 = FREDFilter3 & "." & tempFRED
    '                Else
    '                    If FREDFilter1.Contains(FREDFilter3) Or FREDFilter2.Contains(FREDFilter3) Then
    '                        'if an exists statement includes filter option add to that statment
    '                        If FREDFilter1.Contains(FREDFilter3) Then
    '                            If FREDchk = "Flip" And FREDFilter1.StartsWith(" exists (") Then
    '                                FREDFilter3 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter3 & _
    '                                 " where " & FREDFilter3 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                 " and " & FREDFilter3 & "." & tempFRED
    '                            Else
    '                                FREDFilter1 = FREDFilter1 & " and " & FREDFilter3 & "." & tempFRED
    '                            End If
    '                        End If
    '                        If FREDFilter2.Contains(FREDFilter3) Then
    '                            If FREDchk = "Flip" And FREDFilter2.StartsWith(" exists (") Then
    '                                FREDFilter3 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter3 & _
    '                                " where " & FREDFilter3 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                " and " & FREDFilter3 & "." & tempFRED
    '                            Else
    '                                FREDFilter2 = FREDFilter2 & " and " & FREDFilter3 & "." & tempFRED
    '                            End If
    '                        End If
    '                        FREDFilter3 = ""
    '                    Else
    '                        'if table is not used in the select statment or existing statemnt then start an exists statement 
    '                        If FREDConnect <> "" Then
    '                            If FREDchk = "Flip" Then
    '                                FREDFilter3 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter3 & _
    '                                 " where " & FREDFilter3 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                 " and " & FREDFilter3 & "." & tempFRED
    '                            Else
    '                                FREDFilter3 = " exists (select distinct " & FREDConnect & " from " & FREDFilter3 & _
    '                                 " where " & FREDFilter3 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                 " and " & FREDFilter3 & "." & tempFRED
    '                            End If
    '                        End If
    '                    End If
    '                End If
    '            End If
    '            tempFRED = ""
    '            FREDConnect = ""
    '            SQLDataType = ""
    '            FREDchk = ""

    '            If rblFREDFilter4.SelectedIndex <> 0 Then
    '                SQL = "select " & _
    '                "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                ",COLUMN_NAME as FREDConnect,   " & _
    '                "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter4.SelectedValue.ToString & _
    '                "  and Column_Alias = '" & ddlFREDFilter4.SelectedValue & "' ) as dataType " & _
    '                "from WebFD.FRED.vw_AvailableData " & _
    '                "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                cmd = New SqlCommand(SQL, conn)
    '                dr = cmd.ExecuteReader
    '                While dr.Read
    '                    If IsDBNull(dr.Item("dataType")) Then
    '                        SQLDataType = "'"
    '                    Else
    '                        SQLDataType = dr.Item("dataType")
    '                        If SQLDataType = "char" Or SQLDataType = "nvarchar" Or SQLDataType = "varchar" Then
    '                            SQLDataType = "'"
    '                        Else
    '                            SQLDataType = ""
    '                        End If
    '                    End If
    '                    'get the full table name of the first filtered option
    '                    If IsDBNull(dr.Item("FREDTable")) Then
    '                        FREDFilter4 = ""
    '                    Else
    '                        FREDFilter4 = dr.Item("FREDTable")
    '                    End If
    '                    If IsDBNull(dr.Item("FREDConnect")) Then
    '                        FREDConnect = ""
    '                    Else
    '                        FREDConnect = dr.Item("FREDConnect")
    '                    End If
    '                End While
    '                dr.Close()
    '                If lblFREDTable1.Text = FREDFilter4 Or lblFREDTable2.Text = FREDFilter4 Or lblFREDTable3.Text = FREDFilter4 Then
    '                    FREDchk = "Base"
    '                Else
    '                    FREDchk = "NO"
    '                End If

    '                Select Case ddlFREDFilterOption4.SelectedIndex
    '                    Case 1 '<> 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter4.Text, "'", "''") & "' "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " = '" & Replace(txtFREDFilter4.Text, "'", "''") & "' "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 6 'like 
    '                        tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%' "
    '                    Case 7 'contains AKA in 
    '                        If txtFREDFilter4.Text.Contains(",") Then
    '                            temp = txtFREDFilter4.Text
    '                            txtFREDFilter4.Text = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While txtFREDFilter4.Text.Contains(",")
    '                                If InStr(txtFREDFilter4.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1) & "',"
    '                                    txtFREDFilter4.Text = Mid(txtFREDFilter4.Text, InStr(txtFREDFilter4.Text, ",") + 1, Len(txtFREDFilter4.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter4.Text & "'"
    '                                    txtFREDFilter4.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter4.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter4.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter4.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter4.Text & "'"
    '                        End If
    '                        tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " in (" & tempFRED & ") "
    '                        temp = ""
    '                    Case 8 'not like 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%' "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%' "
    '                            FREDchk = "Flip"
    '                        End If

    '                    Case 9 'not contains AKA not in 
    '                        If txtFREDFilter4.Text.Contains(",") Then
    '                            temp = txtFREDFilter4.Text
    '                            txtFREDFilter4.Text = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While txtFREDFilter4.Text.Contains(",")
    '                                If InStr(txtFREDFilter4.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter4.Text, 1, InStr(txtFREDFilter4.Text, ",") - 1) & "',"
    '                                    txtFREDFilter4.Text = Mid(txtFREDFilter4.Text, InStr(txtFREDFilter4.Text, ",") + 1, Len(txtFREDFilter4.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter4.Text & "'"
    '                                    txtFREDFilter4.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter4.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter4.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter4.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter4.Text & "'"
    '                        End If
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " not in (" & tempFRED & ") "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & "  in (" & tempFRED & ") "
    '                            FREDchk = "Flip"
    '                        End If
    '                        temp = ""
    '                    Case 10 'between 
    '                        tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "' "
    '                    Case 11 'not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " not between '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "' "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "' "
    '                            FREDchk = "Flip"
    '                        End If

    '                    Case 12 'Date between 
    '                        tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "' "
    '                    Case 13 'Date not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "' "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "' "
    '                            FREDchk = "Flip"
    '                        End If

    '                    Case 14 'Null 
    '                        tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " is NULL "
    '                    Case 15 'Not Null 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " is NOT NULL  "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " is NULL  "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case Else  '=,  <, <=, >, >=
    '                        tempFRED = "[" & ddlFREDFilter4.SelectedValue & "]" & " " & ddlFREDFilterOption4.Text & " '" & Replace(txtFREDFilter4.Text, "'", "''") & "' "
    '                End Select

    '                If lblFREDTable1.Text = FREDFilter4 Or lblFREDTable2.Text = FREDFilter4 Or lblFREDTable3.Text = FREDFilter4 Then
    '                    'if Table is used in the select statement then add to the where clause 
    '                    FREDFilter4 = FREDFilter4 & "." & tempFRED
    '                Else
    '                    If FREDFilter1.Contains(FREDFilter4) = True Or FREDFilter2.Contains(FREDFilter4) = True Or FREDFilter3.Contains(FREDFilter4) = True Then
    '                        'if an exists statement includes filter option add to that statment
    '                        If FREDFilter1.Contains(FREDFilter4) Then
    '                            If FREDchk = "Flip" And FREDFilter1.StartsWith(" exists (") Then
    '                                FREDFilter4 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter4 & _
    '                                " where " & FREDFilter4 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                " and " & FREDFilter4 & "." & tempFRED
    '                            Else
    '                                FREDFilter1 = FREDFilter1 & " and " & FREDFilter4 & "." & tempFRED
    '                            End If
    '                        End If
    '                        If FREDFilter2.Contains(FREDFilter4) Then
    '                            If FREDchk = "Flip" And FREDFilter2.StartsWith(" exists (") Then
    '                                FREDFilter4 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter4 & _
    '                               " where " & FREDFilter4 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                               " and " & FREDFilter4 & "." & tempFRED
    '                            Else
    '                                FREDFilter2 = FREDFilter2 & " and " & FREDFilter4 & "." & tempFRED
    '                            End If
    '                        End If
    '                        If FREDFilter3.Contains(FREDFilter4) Then
    '                            If FREDchk = "Flip" And FREDFilter3.StartsWith(" exists (") Then
    '                                FREDFilter4 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter4 & _
    '                               " where " & FREDFilter4 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                               " and " & FREDFilter4 & "." & tempFRED
    '                            Else
    '                                FREDFilter3 = FREDFilter3 & " and " & FREDFilter4 & "." & tempFRED
    '                            End If
    '                        End If
    '                        FREDFilter4 = ""
    '                    Else
    '                        'if table is not used in the select statment or existing statemnt then start an exists statement 
    '                        If FREDConnect <> "" Then
    '                            If FREDchk = "Flip" Then
    '                                FREDFilter4 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter4 & _
    '                               " where " & FREDFilter4 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                               " and " & FREDFilter4 & "." & tempFRED
    '                            Else
    '                                FREDFilter4 = " exists (select distinct " & FREDConnect & " from " & FREDFilter4 & _
    '                                    " where " & FREDFilter4 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                    " and " & FREDFilter4 & "." & tempFRED
    '                            End If
    '                        End If
    '                    End If
    '                End If

    '            End If
    '            tempFRED = ""
    '            FREDConnect = ""
    '            SQLDataType = ""
    '            FREDchk = ""

    '            If rblFREDFilter5.SelectedIndex <> 0 Then
    '                SQL = "select " & _
    '               "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '               ",COLUMN_NAME as FREDConnect,   " & _
    '               "(select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter5.SelectedValue.ToString & _
    '               "  and Column_Alias = '" & ddlFREDFilter5.SelectedValue & "' ) as dataType " & _
    '               "from WebFD.FRED.vw_AvailableData " & _
    '               "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                If conn.State = ConnectionState.Closed Then
    '                    conn.Open()
    '                End If
    '                cmd = New SqlCommand(SQL, conn)
    '                dr = cmd.ExecuteReader
    '                While dr.Read
    '                    If IsDBNull(dr.Item("dataType")) Then
    '                        SQLDataType = "'"
    '                    Else
    '                        SQLDataType = dr.Item("dataType")
    '                        If SQLDataType = "char" Or SQLDataType = "nvarchar" Or SQLDataType = "varchar" Then
    '                            SQLDataType = "'"
    '                        Else
    '                            SQLDataType = ""
    '                        End If
    '                    End If
    '                    'get the full table name of the first filtered option
    '                    If IsDBNull(dr.Item("FREDTable")) Then
    '                        FREDFilter5 = ""
    '                    Else
    '                        FREDFilter5 = dr.Item("FREDTable")
    '                    End If
    '                    If IsDBNull(dr.Item("FREDConnect")) Then
    '                        FREDConnect = ""
    '                    Else
    '                        FREDConnect = dr.Item("FREDConnect")
    '                    End If
    '                End While
    '                dr.Close()
    '                If lblFREDTable1.Text = FREDFilter5 Or lblFREDTable2.Text = FREDFilter5 Or lblFREDTable3.Text = FREDFilter5 Then
    '                    FREDchk = "Base"
    '                Else
    '                    FREDchk = "NO"
    '                End If

    '                Select Case ddlFREDFilterOption5.SelectedIndex
    '                    Case 1 '<> 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter5.Text, "'", "''") & "' "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " = '" & Replace(txtFREDFilter5.Text, "'", "''") & "' "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 6 'like 
    '                        tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%' "
    '                    Case 7 'contains AKA in 
    '                        If txtFREDFilter5.Text.Contains(",") Then
    '                            temp = txtFREDFilter5.Text
    '                            txtFREDFilter5.Text = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While txtFREDFilter5.Text.Contains(",")
    '                                If InStr(txtFREDFilter5.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1) & "',"
    '                                    txtFREDFilter5.Text = Mid(txtFREDFilter5.Text, InStr(txtFREDFilter5.Text, ",") + 1, Len(txtFREDFilter5.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter5.Text & "'"
    '                                    txtFREDFilter5.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter5.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter5.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter5.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter5.Text & "'"
    '                        End If
    '                        tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " in (" & tempFRED & ") "
    '                        temp = ""
    '                    Case 8 'not like 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%' "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%' "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 9 'not contains AKA not in 
    '                        If txtFREDFilter5.Text.Contains(",") Then
    '                            temp = txtFREDFilter5.Text
    '                            txtFREDFilter5.Text = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While txtFREDFilter5.Text.Contains(",")
    '                                If InStr(txtFREDFilter5.Text, ",") > 0 Then
    '                                    tempFRED = tempFRED & "'" & Mid(txtFREDFilter5.Text, 1, InStr(txtFREDFilter5.Text, ",") - 1) & "',"
    '                                    txtFREDFilter5.Text = Mid(txtFREDFilter5.Text, InStr(txtFREDFilter5.Text, ",") + 1, Len(txtFREDFilter5.Text))
    '                                Else
    '                                    tempFRED = tempFRED & "'" & txtFREDFilter5.Text & "'"
    '                                    txtFREDFilter5.Text = ""
    '                                End If
    '                            Loop
    '                            If Len(txtFREDFilter5.Text) > 0 Then
    '                                tempFRED = tempFRED & "'" & txtFREDFilter5.Text & "'"
    '                            End If
    '                            If tempFRED.EndsWith(",") Then
    '                                tempFRED = Mid(tempFRED, 1, Len(tempFRED) - 1)
    '                            End If
    '                            txtFREDFilter5.Text = temp
    '                        Else
    '                            tempFRED = "'" & txtFREDFilter5.Text & "'"
    '                        End If
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " not in (" & tempFRED & ") "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " in (" & tempFRED & ") "
    '                            FREDchk = "Flip"
    '                        End If

    '                        temp = ""
    '                    Case 10 'between 
    '                        tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "' "
    '                    Case 11 'not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " not between '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "' "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "' "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case 12 'Date between 
    '                        tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "' "
    '                    Case 13 'Date not between 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & " and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "' "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & " and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "' "
    '                            FREDchk = "Flip"
    '                        End If

    '                    Case 14 'Null 
    '                        tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " is NULL "
    '                    Case 15 'Not Null 
    '                        If FREDchk = "Base" Then
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " is NOT NULL  "
    '                        Else
    '                            tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " is NULL  "
    '                            FREDchk = "Flip"
    '                        End If
    '                    Case Else  '=, <, <=, >, >=
    '                        tempFRED = "[" & ddlFREDFilter5.SelectedValue & "]" & " " & ddlFREDFilterOption5.Text & " '" & Replace(txtFREDFilter5.Text, "'", "''") & "' "
    '                End Select

    '                If lblFREDTable1.Text = FREDFilter5 Or lblFREDTable2.Text = FREDFilter5 Or lblFREDTable3.Text = FREDFilter5 Then
    '                    'if Table is used in the select statement then add to the where clause 
    '                    FREDFilter5 = FREDFilter5 & "." & tempFRED
    '                Else
    '                    If FREDFilter1.Contains(FREDFilter5) = True Or FREDFilter2.Contains(FREDFilter5) = True Or FREDFilter3.Contains(FREDFilter5) = True _
    '                          Or FREDFilter4.Contains(FREDFilter5) = True Then
    '                        'if an exists statement includes filter option add to that statment
    '                        If FREDFilter1.Contains(FREDFilter5) Then
    '                            If FREDchk = "Flip" And FREDFilter1.StartsWith(" exists (") Then
    '                                FREDFilter5 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter5 & _
    '                               " where " & FREDFilter5 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                               " and " & FREDFilter5 & "." & tempFRED
    '                            Else
    '                                FREDFilter1 = FREDFilter1 & " and " & FREDFilter5 & "." & tempFRED
    '                            End If
    '                        End If
    '                        If FREDFilter2.Contains(FREDFilter5) Then
    '                            If FREDchk = "Flip" And FREDFilter2.StartsWith(" exists (") Then
    '                                FREDFilter5 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter5 & _
    '                               " where " & FREDFilter5 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                               " and " & FREDFilter5 & "." & tempFRED
    '                            Else
    '                                FREDFilter2 = FREDFilter2 & " and " & FREDFilter5 & "." & tempFRED
    '                            End If
    '                        End If
    '                        If FREDFilter3.Contains(FREDFilter5) Then
    '                            If FREDchk = "Flip" And FREDFilter3.StartsWith(" exists (") Then
    '                                FREDFilter5 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter5 & _
    '                               " where " & FREDFilter5 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                               " and " & FREDFilter5 & "." & tempFRED
    '                            Else
    '                                FREDFilter3 = FREDFilter3 & " and " & FREDFilter5 & "." & tempFRED
    '                            End If
    '                        End If
    '                        If FREDFilter4.Contains(FREDFilter5) Then
    '                            If FREDchk = "Flip" And FREDFilter4.StartsWith(" exists (") Then
    '                                FREDFilter5 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter5 & _
    '                                 " where " & FREDFilter5 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                 " and " & FREDFilter5 & "." & tempFRED
    '                            Else
    '                                FREDFilter4 = FREDFilter4 & " and " & FREDFilter5 & "." & tempFRED
    '                            End If
    '                        End If
    '                        FREDFilter5 = ""
    '                    Else
    '                        'if table is not used in the select statment or existing statemnt then start an exists statement 
    '                        If FREDConnect <> "" Then
    '                            If FREDchk = "Flip" Then
    '                                FREDFilter5 = " not exists (select distinct " & FREDConnect & " from " & FREDFilter5 & _
    '                                 " where " & FREDFilter5 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                 " and " & FREDFilter5 & "." & tempFRED
    '                            Else
    '                                FREDFilter5 = " exists (select distinct " & FREDConnect & " from " & FREDFilter5 & _
    '                                " where " & FREDFilter5 & "." & FREDConnect & " = " & lblFREDTable1.Text & "." & lblFREDKey1.Text & _
    '                                " and " & FREDFilter5 & "." & tempFRED
    '                            End If
    '                        End If
    '                    End If
    '                End If

    '            End If
    '        End Using

    '        SQLWhere = " where 1 = 1 "

    '        If FREDFilter1 <> "" Then
    '            SQLWhere = SQLWhere & " and " & FREDFilter1
    '            If FREDFilter1.Contains("exists (") Then
    '                SQLWhere = SQLWhere & ") "
    '            End If
    '        End If
    '        If FREDFilter2 <> "" Then
    '            SQLWhere = SQLWhere & " and " & FREDFilter2
    '            If FREDFilter2.Contains("exists (") Then
    '                SQLWhere = SQLWhere & ") "
    '            End If
    '        End If
    '        If FREDFilter3 <> "" Then
    '            SQLWhere = SQLWhere & " and " & FREDFilter3
    '            If FREDFilter3.Contains("exists (") Then
    '                SQLWhere = SQLWhere & ") "
    '            End If
    '        End If
    '        If FREDFilter4 <> "" Then
    '            SQLWhere = SQLWhere & " and " & FREDFilter4
    '            If FREDFilter4.Contains("exists (") Then
    '                SQLWhere = SQLWhere & ") "
    '            End If
    '        End If
    '        If FREDFilter5 <> "" Then
    '            SQLWhere = SQLWhere & " and " & FREDFilter5
    '            If FREDFilter5.Contains("exists (") Then
    '                SQLWhere = SQLWhere & ") "
    '            End If
    '        End If

    '        SQLFRED = SQLSelect & SQLTable & SQLWhere

    '        'SQL = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = ' SET NOCOUNT ON select " & Replace(SQLFRED, "'", "'+CHAR(39)+'") & "' 	 EXECUTE	SP_EXECUTESQL @FinalQuery   "
    '        'SQL2 = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = 'SET NOCOUNT ON select count(*)  " & Replace(SQLTable, "'", "'+CHAR(39)+'") & _
    '        '    Replace(SQLWhere, "'", "'+char(39)+'") & "' 	 EXECUTE	SP_EXECUTESQL @FinalQuery   "
    '        'SQL3 = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = 'SET NOCOUNT ON select " & Replace(SQLFRED, "'", "'+CHAR(39)+'") & "' 	 EXECUTE	SP_EXECUTESQL @FinalQuery   "


    '        'SQL = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = ' select top 25 " & Replace(SQLFRED, "'", "'+CHAR(39)+'") & "' 	 EXECUTE (@FinalQuery)  "
    '        'SQL2 = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = ' select count(*)  " & Replace(SQLTable, "'", "'+CHAR(39)+'") & _
    '        '    Replace(SQLWhere, "'", "'+char(39)+'") & "' 	 EXECUTE  (@FinalQuery)   "
    '        'SQL3 = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = ' select " & Replace(SQLFRED, "'", "'+CHAR(39)+'") & "' 	 EXECUTE (@FinalQuery)   "

    '        'FREDTemp = Replace(Replace(Replace(FREDTemp, "[varchar]", "[varchar](max)"), "[nvarchar]", "[nvarchar](max)"), "[char]", "[char](max)")
    '        Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '            If conn.State = ConnectionState.Closed Then
    '                conn.Open()
    '            End If
    '            FREDTemp = "If Object_ID('WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "') is not null " & _
    '          " begin " & _
    '             "Drop table WebFD.FredTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & _
    '          " end; "

    '            FREDTemp = FREDTemp & _
    '             "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = ' SET NOCOUNT ON select " & SQLSelect & _
    '                " into WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & _
    '                   SQLTable & Replace(SQLWhere, "'", "'+CHAR(39)+'") & " '	 EXECUTE	SP_EXECUTESQL @FinalQuery   "
    '            cmd = New SqlCommand(FREDTemp, conn)
    '            cmd.CommandTimeout = 86400
    '            cmd.ExecuteNonQuery()
    '        End Using


    '        SQL = "select top 25 * from WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "")
    '        SQL2 = "Select count(*) from WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "")
    '        SQL3 = "select  * from WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "")

    '        'SQL = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = ' SET NOCOUNT ON select into FREDTemp. " & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & _
    '        '            Replace(SQLFRED, "'", "'+CHAR(39)+'") & "' 	 EXECUTE	SP_EXECUTESQL @FinalQuery   "
    '        'SQL2 = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = 'SET NOCOUNT ON select count(*)  " & Replace(SQLTable, "'", "'+CHAR(39)+'") & _
    '        '    Replace(SQLWhere, "'", "'+char(39)+'") & "' 	 EXECUTE	SP_EXECUTESQL @FinalQuery   "
    '        'SQL3 = "DECLARE @FinalQuery NVARCHAR(MAX) SET @FinalQuery = 'SET NOCOUNT ON select " & Replace(SQLFRED, "'", "'+CHAR(39)+'") & "' 	 EXECUTE	SP_EXECUTESQL @FinalQuery   "


    '        lblSQLStatement.Text = SQL3.ToString
    '    Catch ex As Exception

    '    End Try
    'End Sub


#End Region

    Private Sub rblFREDFilter1_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles rblFREDFilter1.SelectedIndexChanged
        FillForcedColumnddl()
    End Sub
    Private Sub FillForcedColumnddl()
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter1.Visible = True
            pnltxtFREDFilter1.Visible = False
            pnlnumFREDFilter1.Visible = False
            pnldtpFREDFilter1.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & rblFREDFilter1.SelectedValue & _
            "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "and DataType like '%date%' " & _
            "order by 1  "

            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDFilter1.DataSource = ds
                ddlFREDFilter1.DataMember = "FRED"
                ddlFREDFilter1.DataTextField = "Column_Alias"
                ddlFREDFilter1.DataValueField = "COLUMN_Name"
                ddlFREDFilter1.DataBind()

            End Using
            If ddlFREDFilter1.Items.Count < 1 Then
                ddlFREDFilter1.Visible = False
                ddlFREDFilterOption1.Visible = False
                btnexample1.Visible = False
            Else
                ddlFREDFilterOption1.Visible = True
                btnexample1.Visible = True
                FREDFILTEROPTION1()
            End If

            lblFREEFilter1.Text = "Filter #1 - " & rblFREDFilter1.SelectedItem.Text
            upFREEFILTER1.Update()



            Dim DTSQL As String = "select Top 1 DataType, convert(varchar,Dateadd(month, -1, convert(varchar,month(GETDATE())) + '/1/' + convert(varchar,year(getdate()))), 101) datestart, " & _
                "convert(varchar,Dateadd(day, -1, convert(varchar,month(GETDATE())) + '/1/' + convert(varchar,year(getdate()))), 101) dateend from WebFD.FRED.vw_AvailableData where TABLE_ID = " & _
                    rblFREDFilter1.SelectedValue.ToString & _
                        "  and Column_Alias = '" & ddlFREDFilter1.SelectedValue & "' "

            Dim startdate As String = ""
            Dim enddate As String = ""

            ddlFREDFilterOption1.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption1.Items.Add("=")
                        ddlFREDFilterOption1.Items.Add("<")
                        ddlFREDFilterOption1.Items.Add("<=")
                        ddlFREDFilterOption1.Items.Add(">")
                        ddlFREDFilterOption1.Items.Add(">=")
                        ddlFREDFilterOption1.Items.Add("like")
                        ddlFREDFilterOption1.Items.Add("contains")
                        ddlFREDFilterOption1.Items.Add("not like")
                        ddlFREDFilterOption1.Items.Add("does not contain")
                        ddlFREDFilterOption1.Items.Add("DATE between")
                        ddlFREDFilterOption1.Items.Add("DATE not between")
                        ddlFREDFilterOption1.Items.Add("NULL")
                        ddlFREDFilterOption1.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption1.Items.Add("=")
                        ddlFREDFilterOption1.Items.Add("≠")
                        ddlFREDFilterOption1.Items.Add("<")
                        ddlFREDFilterOption1.Items.Add("<=")
                        ddlFREDFilterOption1.Items.Add(">")
                        ddlFREDFilterOption1.Items.Add(">=")
                        ddlFREDFilterOption1.Items.Add("like")
                        ddlFREDFilterOption1.Items.Add("contains")
                        ddlFREDFilterOption1.Items.Add("not like")
                        ddlFREDFilterOption1.Items.Add("does not contain")
                        ddlFREDFilterOption1.Items.Add("between")
                        ddlFREDFilterOption1.Items.Add("not between")
                        ddlFREDFilterOption1.Items.Add("NULL")
                        ddlFREDFilterOption1.Items.Add("NOT NULL")
                    End If
                    startdate = Left(dr.Item("datestart").ToString, 10)
                    enddate = Left(dr.Item("dateend").ToString, 10)
                End While
                dr.Close()
            End Using

            ddlFREDFilterOption1.SelectedValue = "DATE between"
            FREDFILTEROPTION1()
            dtpFREDFilter1StartDate.Text = startdate
            dtpFREDFilter1EndDate.Text = enddate

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub rbl1changed(selectedvalue)
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter1.Visible = True
            pnltxtFREDFilter1.Visible = False
            pnlnumFREDFilter1.Visible = False
            pnldtpFREDFilter1.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & selectedvalue & _
            "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "

            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDFilter1.DataSource = ds
                ddlFREDFilter1.DataMember = "FRED"
                ddlFREDFilter1.DataTextField = "Column_Alias"
                ddlFREDFilter1.DataValueField = "COLUMN_Name"
                ddlFREDFilter1.DataBind()

            End Using
            If ddlFREDFilter1.Items.Count < 1 Then
                ddlFREDFilter1.Visible = False
                ddlFREDFilterOption1.Visible = False
                btnexample1.Visible = False
            Else
                ddlFREDFilterOption1.Visible = True
                btnexample1.Visible = True
            End If

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub
    Private Sub rbl2changed(selectedvalue)
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter2.Visible = True
            pnltxtFREDFilter2.Visible = False
            pnlnumFREDFilter2.Visible = False
            pnldtpFREDFilter2.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & selectedvalue & _
            "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "

            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDFilter2.DataSource = ds
                ddlFREDFilter2.DataMember = "FRED"
                ddlFREDFilter2.DataTextField = "Column_Alias"
                ddlFREDFilter2.DataValueField = "COLUMN_Name"
                ddlFREDFilter2.DataBind()

            End Using
            If ddlFREDFilter2.Items.Count < 1 Then
                ddlFREDFilter2.Visible = False
                ddlFREDFilterOption2.Visible = False
                btnexample2.Visible = False
            Else
                ddlFREDFilterOption2.Visible = True
                btnexample2.Visible = True
            End If

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub
    Private Sub rbl3changed(selectedvalue)
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter3.Visible = True
            pnltxtFREDFilter3.Visible = False
            pnlnumFREDFilter3.Visible = False
            pnldtpFREDFilter3.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & selectedvalue & _
            "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "

            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDFilter3.DataSource = ds
                ddlFREDFilter3.DataMember = "FRED"
                ddlFREDFilter3.DataTextField = "Column_Alias"
                ddlFREDFilter3.DataValueField = "COLUMN_Name"
                ddlFREDFilter3.DataBind()

            End Using
            If ddlFREDFilter3.Items.Count < 1 Then
                ddlFREDFilter3.Visible = False
                ddlFREDFilterOption3.Visible = False
                btnexample3.Visible = False
            Else
                ddlFREDFilterOption3.Visible = True
                btnexample3.Visible = True
            End If

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


    End Sub
    Private Sub rbl4changed(selectedvalue)
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter4.Visible = True
            pnltxtFREDFilter4.Visible = False
            pnlnumFREDFilter4.Visible = False
            pnldtpFREDFilter4.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & selectedvalue & _
            "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "


            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDFilter4.DataSource = ds
                ddlFREDFilter4.DataMember = "FRED"
                ddlFREDFilter4.DataTextField = "Column_Alias"
                ddlFREDFilter4.DataValueField = "COLUMN_Name"
                ddlFREDFilter4.DataBind()

            End Using
            If ddlFREDFilter4.Items.Count < 1 Then
                ddlFREDFilter4.Visible = False
                ddlFREDFilterOption4.Visible = False
                btnexample4.Visible = False
            Else
                ddlFREDFilterOption4.Visible = True
                btnexample4.Visible = True
            End If

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


    End Sub
    Private Sub rbl5changed(selectedvalue)
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter5.Visible = True
            pnltxtFREDFilter5.Visible = False
            pnlnumFREDFilter5.Visible = False
            pnldtpFREDFilter5.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & selectedvalue & _
           "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "

            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDFilter5.DataSource = ds
                ddlFREDFilter5.DataMember = "FRED"
                ddlFREDFilter5.DataTextField = "Column_Alias"
                ddlFREDFilter5.DataValueField = "COLUMN_Name"
                ddlFREDFilter5.DataBind()

            End Using
            If ddlFREDFilter5.Items.Count < 1 Then
                ddlFREDFilter5.Visible = False
                ddlFREDFilterOption5.Visible = False
                btnexample5.Visible = False
            Else
                ddlFREDFilterOption5.Visible = True
                btnexample5.Visible = True
            End If

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


    End Sub

    Private Sub ddlFREDFilterOption1_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilterOption1.SelectedIndexChanged
        Try
            FREDFILTEROPTION1()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDFILTEROPTION1()
        Try
            pnltxtFREDFilter1.Visible = False
            pnlnumFREDFilter1.Visible = False
            pnldtpFREDFilter1.Visible = False
            lblFREDFilter1.Visible = False
            lblFREDFilter1b.Visible = False

            Select Case ddlFREDFilterOption1.Text
                Case "between"
                    pnlnumFREDFilter1.Visible = True
                Case "not between"
                    pnlnumFREDFilter1.Visible = True
                Case "DATE between"
                    pnldtpFREDFilter1.Visible = True
                Case "DATE not between"
                    pnldtpFREDFilter1.Visible = True
                Case "contains"
                    lblFREDFilter1.Visible = True
                    lblFREDFilter1b.Visible = True
                    pnltxtFREDFilter1.Visible = True
                Case "does not contain"
                    lblFREDFilter1.Visible = True
                    lblFREDFilter1b.Visible = True
                    pnltxtFREDFilter1.Visible = True
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    pnltxtFREDFilter1.Visible = True
            End Select


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub rblFREDFilter2_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles rblFREDFilter2.SelectedIndexChanged
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter2.Visible = True
            pnltxtFREDFilter2.Visible = False
            pnlnumFREDFilter2.Visible = False
            pnldtpFREDFilter2.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & rblFREDFilter2.SelectedValue & _
           "and Costing in (" & Costing & ") " & _
           "and PHI in (" & PHI & ") " & _
           "and Financial in (" & Financial & ") " & _
           "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "
            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86200
                da.Fill(ds, "FRED")

                ddlFREDFilter2.DataSource = ds
                ddlFREDFilter2.DataMember = "FRED"
                ddlFREDFilter2.DataTextField = "Column_Alias"
                ddlFREDFilter2.DataValueField = "COLUMN_Name"
                ddlFREDFilter2.DataBind()

            End Using
            If ddlFREDFilter2.Items.Count < 1 Then
                ddlFREDFilter2.Visible = False
                ddlFREDFilterOption2.Visible = False
                btnexample2.Visible = False
            Else
                ddlFREDFilterOption2.Visible = True
                btnexample2.Visible = True
                FREDFILTEROPTION2()

            End If

            lblFREEFilter2.Text = "Filter #2 - " & rblFREDFilter2.SelectedItem.Text
            upFREEFILTER2.Update()


            Dim DTSQL As String = "select Top 1 DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter2.SelectedValue.ToString & _
                        "  and Column_Alias = '" & ddlFREDFilter2.SelectedValue & "' "

            ddlFREDFilterOption2.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption2.Items.Add("=")
                        ddlFREDFilterOption2.Items.Add("<")
                        ddlFREDFilterOption2.Items.Add("<=")
                        ddlFREDFilterOption2.Items.Add(">")
                        ddlFREDFilterOption2.Items.Add(">=")
                        ddlFREDFilterOption2.Items.Add("like")
                        ddlFREDFilterOption2.Items.Add("contains")
                        ddlFREDFilterOption2.Items.Add("not like")
                        ddlFREDFilterOption2.Items.Add("does not contain")
                        ddlFREDFilterOption2.Items.Add("DATE between")
                        ddlFREDFilterOption2.Items.Add("DATE not between")
                        ddlFREDFilterOption2.Items.Add("NULL")
                        ddlFREDFilterOption2.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption2.Items.Add("=")
                        ddlFREDFilterOption2.Items.Add("≠")
                        ddlFREDFilterOption2.Items.Add("<")
                        ddlFREDFilterOption2.Items.Add("<=")
                        ddlFREDFilterOption2.Items.Add(">")
                        ddlFREDFilterOption2.Items.Add(">=")
                        ddlFREDFilterOption2.Items.Add("like")
                        ddlFREDFilterOption2.Items.Add("contains")
                        ddlFREDFilterOption2.Items.Add("not like")
                        ddlFREDFilterOption2.Items.Add("does not contain")
                        ddlFREDFilterOption2.Items.Add("between")
                        ddlFREDFilterOption2.Items.Add("not between")
                        ddlFREDFilterOption2.Items.Add("NULL")
                        ddlFREDFilterOption2.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilterOption2_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilterOption2.SelectedIndexChanged
        Try
            FREDFILTEROPTION2()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDFILTEROPTION2()
        Try
            pnltxtFREDFilter2.Visible = False
            pnlnumFREDFilter2.Visible = False
            pnldtpFREDFilter2.Visible = False
            lblFREDFilter2.Visible = False
            lblFREDFilter2b.Visible = False

            Select Case ddlFREDFilterOption2.Text
                Case "between"
                    pnlnumFREDFilter2.Visible = True
                Case "not between"
                    pnlnumFREDFilter2.Visible = True
                Case "DATE between"
                    pnldtpFREDFilter2.Visible = True
                Case "DATE not between"
                    pnldtpFREDFilter2.Visible = True
                Case "contains"
                    lblFREDFilter2.Visible = True
                    lblFREDFilter2b.Visible = True
                    pnltxtFREDFilter2.Visible = True
                Case "does not contain"
                    lblFREDFilter2.Visible = True
                    lblFREDFilter2b.Visible = True
                    pnltxtFREDFilter2.Visible = True
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    pnltxtFREDFilter2.Visible = True
            End Select


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub rblFREDFilter3_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles rblFREDFilter3.SelectedIndexChanged
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter3.Visible = True
            pnltxtFREDFilter3.Visible = False
            pnlnumFREDFilter3.Visible = False
            pnldtpFREDFilter3.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & rblFREDFilter3.SelectedValue & _
            "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "

            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86300
                da.Fill(ds, "FRED")

                ddlFREDFilter3.DataSource = ds
                ddlFREDFilter3.DataMember = "FRED"
                ddlFREDFilter3.DataTextField = "Column_Alias"
                ddlFREDFilter3.DataValueField = "COLUMN_Name"
                ddlFREDFilter3.DataBind()

            End Using
            If ddlFREDFilter3.Items.Count < 1 Then
                ddlFREDFilter3.Visible = False
                ddlFREDFilterOption3.Visible = False
                btnexample3.Visible = False
            Else
                ddlFREDFilterOption3.Visible = True
                btnexample3.Visible = True
                FREDFILTEROPTION3()

            End If

            lblFREEFilter3.Text = "Filter #3 - " & rblFREDFilter3.SelectedItem.Text
            upFREEFILTER3.Update()


            Dim DTSQL As String = "select Top 1 DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter3.SelectedValue.ToString & _
                        "  and Column_Alias = '" & ddlFREDFilter3.SelectedValue & "' "

            ddlFREDFilterOption3.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption3.Items.Add("=")
                        ddlFREDFilterOption3.Items.Add("<")
                        ddlFREDFilterOption3.Items.Add("<=")
                        ddlFREDFilterOption3.Items.Add(">")
                        ddlFREDFilterOption3.Items.Add(">=")
                        ddlFREDFilterOption3.Items.Add("like")
                        ddlFREDFilterOption3.Items.Add("contains")
                        ddlFREDFilterOption3.Items.Add("not like")
                        ddlFREDFilterOption3.Items.Add("does not contain")
                        ddlFREDFilterOption3.Items.Add("DATE between")
                        ddlFREDFilterOption3.Items.Add("DATE not between")
                        ddlFREDFilterOption3.Items.Add("NULL")
                        ddlFREDFilterOption3.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption3.Items.Add("=")
                        ddlFREDFilterOption3.Items.Add("≠")
                        ddlFREDFilterOption3.Items.Add("<")
                        ddlFREDFilterOption3.Items.Add("<=")
                        ddlFREDFilterOption3.Items.Add(">")
                        ddlFREDFilterOption3.Items.Add(">=")
                        ddlFREDFilterOption3.Items.Add("like")
                        ddlFREDFilterOption3.Items.Add("contains")
                        ddlFREDFilterOption3.Items.Add("not like")
                        ddlFREDFilterOption3.Items.Add("does not contain")
                        ddlFREDFilterOption3.Items.Add("between")
                        ddlFREDFilterOption3.Items.Add("not between")
                        ddlFREDFilterOption3.Items.Add("NULL")
                        ddlFREDFilterOption3.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilterOption3_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilterOption3.SelectedIndexChanged
        Try
            FREDFILTEROPTION3()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDFILTEROPTION3()
        Try
            pnltxtFREDFilter3.Visible = False
            pnlnumFREDFilter3.Visible = False
            pnldtpFREDFilter3.Visible = False
            lblFREDFilter3.Visible = False
            lblFREDFilter3b.Visible = False

            Select Case ddlFREDFilterOption3.Text
                Case "between"
                    pnlnumFREDFilter3.Visible = True
                Case "not between"
                    pnlnumFREDFilter3.Visible = True
                Case "DATE between"
                    pnldtpFREDFilter3.Visible = True
                Case "DATE not between"
                    pnldtpFREDFilter3.Visible = True
                Case "contains"
                    lblFREDFilter3.Visible = True
                    lblFREDFilter3b.Visible = True
                    pnltxtFREDFilter3.Visible = True
                Case "does not contain"
                    lblFREDFilter3.Visible = True
                    lblFREDFilter3b.Visible = True
                    pnltxtFREDFilter3.Visible = True
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    pnltxtFREDFilter3.Visible = True
            End Select

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub rblFREDFilter4_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles rblFREDFilter4.SelectedIndexChanged
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter4.Visible = True
            pnltxtFREDFilter4.Visible = False
            pnlnumFREDFilter4.Visible = False
            pnldtpFREDFilter4.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & rblFREDFilter4.SelectedValue & _
            "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "
            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDFilter4.DataSource = ds
                ddlFREDFilter4.DataMember = "FRED"
                ddlFREDFilter4.DataTextField = "Column_Alias"
                ddlFREDFilter4.DataValueField = "COLUMN_Name"
                ddlFREDFilter4.DataBind()

            End Using
            If ddlFREDFilter4.Items.Count < 1 Then
                ddlFREDFilter4.Visible = False
                ddlFREDFilterOption4.Visible = False
                btnexample4.Visible = False
            Else
                ddlFREDFilterOption4.Visible = True
                FREDFILTEROPTION4()
                btnexample4.Visible = True

            End If

            lblFREEFilter4.Text = "Filter #4 - " & rblFREDFilter4.SelectedItem.Text
            upFREEFILTER4.Update()


            Dim DTSQL As String = "select Top 1 DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter4.SelectedValue.ToString & _
                        "  and Column_Alias = '" & ddlFREDFilter4.SelectedValue & "' "

            ddlFREDFilterOption4.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption4.Items.Add("=")
                        ddlFREDFilterOption4.Items.Add("<")
                        ddlFREDFilterOption4.Items.Add("<=")
                        ddlFREDFilterOption4.Items.Add(">")
                        ddlFREDFilterOption4.Items.Add(">=")
                        ddlFREDFilterOption4.Items.Add("like")
                        ddlFREDFilterOption4.Items.Add("contains")
                        ddlFREDFilterOption4.Items.Add("not like")
                        ddlFREDFilterOption4.Items.Add("does not contain")
                        ddlFREDFilterOption4.Items.Add("DATE between")
                        ddlFREDFilterOption4.Items.Add("DATE not between")
                        ddlFREDFilterOption4.Items.Add("NULL")
                        ddlFREDFilterOption4.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption4.Items.Add("=")
                        ddlFREDFilterOption4.Items.Add("≠")
                        ddlFREDFilterOption4.Items.Add("<")
                        ddlFREDFilterOption4.Items.Add("<=")
                        ddlFREDFilterOption4.Items.Add(">")
                        ddlFREDFilterOption4.Items.Add(">=")
                        ddlFREDFilterOption4.Items.Add("like")
                        ddlFREDFilterOption4.Items.Add("contains")
                        ddlFREDFilterOption4.Items.Add("not like")
                        ddlFREDFilterOption4.Items.Add("does not contain")
                        ddlFREDFilterOption4.Items.Add("between")
                        ddlFREDFilterOption4.Items.Add("not between")
                        ddlFREDFilterOption4.Items.Add("NULL")
                        ddlFREDFilterOption4.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilterOption4_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilterOption4.SelectedIndexChanged
        Try
            FREDFILTEROPTION4()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDFILTEROPTION4()
        Try
            pnltxtFREDFilter4.Visible = False
            pnlnumFREDFilter4.Visible = False
            pnldtpFREDFilter4.Visible = False
            lblFREDFilter4.Visible = False
            lblFREDFilter4b.Visible = False

            Select Case ddlFREDFilterOption4.Text
                Case "between"
                    pnlnumFREDFilter4.Visible = True
                Case "not between"
                    pnlnumFREDFilter4.Visible = True
                Case "DATE between"
                    pnldtpFREDFilter4.Visible = True
                Case "DATE not between"
                    pnldtpFREDFilter4.Visible = True
                Case "contains"
                    lblFREDFilter4.Visible = True
                    lblFREDFilter4b.Visible = True
                    pnltxtFREDFilter4.Visible = True
                Case "does not contain"
                    lblFREDFilter4.Visible = True
                    lblFREDFilter4b.Visible = True
                    pnltxtFREDFilter4.Visible = True
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    pnltxtFREDFilter4.Visible = True
            End Select

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub rblFREDFilter5_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles rblFREDFilter5.SelectedIndexChanged
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            Dim Costing As String = ""
            Dim PHI As String = ""
            Dim Financial As String = ""
            Dim BO_Financial As String = ""


            If lblCosting.Text = "" Then
                Costing = "0"
            Else
                Costing = "0,1"
            End If
            If lblPHI.Text = "" Then
                PHI = "0"
            Else
                PHI = "0,1"
            End If
            If lblFinancial.Text = "" Then
                Financial = "0"
            Else
                Financial = "0,1"
            End If
            If lblBO_Financial.Text = "" Then
                BO_Financial = "0"
            Else
                BO_Financial = "0,1"
            End If

            ddlFREDFilter5.Visible = True
            pnltxtFREDFilter5.Visible = False
            pnlnumFREDFilter5.Visible = False
            pnldtpFREDFilter5.Visible = False


            SQL = "select substring(Column_Alias,1,30) Column_Alias, COLUMN_Name  " & _
            "from WebFD.FRED.vw_AvailableData " & _
            "where TABLE_ID = " & rblFREDFilter5.SelectedValue & _
            "and Costing in (" & Costing & ") " & _
            "and PHI in (" & PHI & ") " & _
            "and Financial in (" & Financial & ") " & _
            "and BO_Financial in (" & BO_Financial & ") " & _
            "order by 1  "
            ds = New DataSet
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDFilter5.DataSource = ds
                ddlFREDFilter5.DataMember = "FRED"
                ddlFREDFilter5.DataTextField = "Column_Alias"
                ddlFREDFilter5.DataValueField = "COLUMN_Name"
                ddlFREDFilter5.DataBind()

            End Using
            If ddlFREDFilter5.Items.Count < 1 Then
                ddlFREDFilter5.Visible = False
                ddlFREDFilterOption5.Visible = False
                btnexample5.Visible = False
            Else
                ddlFREDFilterOption5.Visible = True
                btnexample5.Visible = True
                FREDFILTEROPTION5()

            End If

            lblFREEFilter5.Text = "Filter #5 - " & rblFREDFilter5.SelectedItem.Text
            upFREEFILTER5.Update()


            Dim DTSQL As String = "select Top 1 DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter5.SelectedValue.ToString & _
                        "  and Column_Alias = '" & ddlFREDFilter5.SelectedValue & "' "

            ddlFREDFilterOption5.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption5.Items.Add("=")
                        ddlFREDFilterOption5.Items.Add("<")
                        ddlFREDFilterOption5.Items.Add("<=")
                        ddlFREDFilterOption5.Items.Add(">")
                        ddlFREDFilterOption5.Items.Add(">=")
                        ddlFREDFilterOption5.Items.Add("like")
                        ddlFREDFilterOption5.Items.Add("contains")
                        ddlFREDFilterOption5.Items.Add("not like")
                        ddlFREDFilterOption5.Items.Add("does not contain")
                        ddlFREDFilterOption5.Items.Add("DATE between")
                        ddlFREDFilterOption5.Items.Add("DATE not between")
                        ddlFREDFilterOption5.Items.Add("NULL")
                        ddlFREDFilterOption5.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption5.Items.Add("=")
                        ddlFREDFilterOption5.Items.Add("≠")
                        ddlFREDFilterOption5.Items.Add("<")
                        ddlFREDFilterOption5.Items.Add("<=")
                        ddlFREDFilterOption5.Items.Add(">")
                        ddlFREDFilterOption5.Items.Add(">=")
                        ddlFREDFilterOption5.Items.Add("like")
                        ddlFREDFilterOption5.Items.Add("contains")
                        ddlFREDFilterOption5.Items.Add("not like")
                        ddlFREDFilterOption5.Items.Add("does not contain")
                        ddlFREDFilterOption5.Items.Add("between")
                        ddlFREDFilterOption5.Items.Add("not between")
                        ddlFREDFilterOption5.Items.Add("NULL")
                        ddlFREDFilterOption5.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilterOption5_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilterOption5.SelectedIndexChanged
        Try
            FREDFILTEROPTION5()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDFILTEROPTION5()
        Try
            pnltxtFREDFilter5.Visible = False
            pnlnumFREDFilter5.Visible = False
            pnldtpFREDFilter5.Visible = False
            lblFREDFilter5.Visible = False
            lblFREDFilter5b.Visible = False

            Select Case ddlFREDFilterOption5.Text
                Case "between"
                    pnlnumFREDFilter5.Visible = True
                Case "not between"
                    pnlnumFREDFilter5.Visible = True
                Case "DATE between"
                    pnldtpFREDFilter5.Visible = True
                Case "DATE not between"
                    pnldtpFREDFilter5.Visible = True
                Case "contains"
                    lblFREDFilter5.Visible = True
                    lblFREDFilter5b.Visible = True
                    pnltxtFREDFilter5.Visible = True
                Case "does not contain"
                    lblFREDFilter5.Visible = True
                    lblFREDFilter5b.Visible = True
                    pnltxtFREDFilter5.Visible = True
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    pnltxtFREDFilter5.Visible = True
            End Select


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub btnResetFilters_Click(sender As Object, e As System.EventArgs) Handles btnResetFilters.Click
        Try
            ResetFREDFilters()
            acrFREDFilter.SelectedIndex = -1
            gvFREDData.Visible = False
            Colorlegend.Visible = False
            tblCount.Visible = False
            'RecalculateNumbers()
            chbWhereExists.Checked = False
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ResetFREDFilters()
        Try
            rblFREDFilter1.SelectedIndex = 0
            rblFREDFilter2.SelectedIndex = 0
            rblFREDFilter3.SelectedIndex = 0
            rblFREDFilter4.SelectedIndex = 0
            rblFREDFilter5.SelectedIndex = 0

            ddlFREDFilter1.Visible = False
            ddlFREDFilterOption1.Visible = False
            btnexample1.Visible = False
            pnltxtFREDFilter1.Visible = False
            pnlnumFREDFilter1.Visible = False
            pnldtpFREDFilter1.Visible = False
            dtpFREDFilter1StartDate.Text = Date.Today
            dtpFREDFilter1EndDate.Text = Date.Today
            dtpFREDFilter1StartDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            dtpFREDFilter1EndDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            txtFREDFilter1.Text = ""
            numFREDFilter1Start.Text = ""
            numFREDFilter1End.Text = ""
            'ddlFREDFilterOption1.SelectedIndex = 0

            ddlFREDFilter2.Visible = False
            ddlFREDFilterOption2.Visible = False
            btnexample2.Visible = False
            pnltxtFREDFilter2.Visible = False
            pnlnumFREDFilter2.Visible = False
            pnldtpFREDFilter2.Visible = False
            dtpFREDFilter2StartDate.Text = Date.Today
            dtpFREDFilter2EndDate.Text = Date.Today
            dtpFREDFilter2StartDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            dtpFREDFilter2EndDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            txtFREDFilter2.Text = ""
            numFREDFilter2Start.Text = ""
            numFREDFilter2End.Text = ""
            'ddlFREDFilterOption2.SelectedIndex = 0

            ddlFREDFilter3.Visible = False
            ddlFREDFilterOption3.Visible = False
            btnexample3.Visible = False
            pnltxtFREDFilter3.Visible = False
            pnlnumFREDFilter3.Visible = False
            pnldtpFREDFilter3.Visible = False
            dtpFREDFilter3StartDate.Text = Date.Today
            dtpFREDFilter3EndDate.Text = Date.Today
            dtpFREDFilter3StartDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            dtpFREDFilter3EndDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            txtFREDFilter3.Text = ""
            numFREDFilter3Start.Text = ""
            numFREDFilter3End.Text = ""
            ' ddlFREDFilterOption3.SelectedIndex = 0

            ddlFREDFilter4.Visible = False
            ddlFREDFilterOption4.Visible = False
            btnexample4.Visible = False
            pnltxtFREDFilter4.Visible = False
            pnlnumFREDFilter4.Visible = False
            pnldtpFREDFilter4.Visible = False
            dtpFREDFilter4StartDate.Text = Date.Today
            dtpFREDFilter4EndDate.Text = Date.Today
            dtpFREDFilter4StartDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            dtpFREDFilter4EndDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            txtFREDFilter4.Text = ""
            numFREDFilter4Start.Text = ""
            numFREDFilter4End.Text = ""
            'ddlFREDFilterOption4.SelectedIndex = 0

            ddlFREDFilter5.Visible = False
            ddlFREDFilterOption5.Visible = False
            btnexample5.Visible = False
            pnltxtFREDFilter5.Visible = False
            pnlnumFREDFilter5.Visible = False
            pnldtpFREDFilter5.Visible = False
            dtpFREDFilter5StartDate.Text = Date.Today
            dtpFREDFilter5EndDate.Text = Date.Today
            dtpFREDFilter5StartDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            dtpFREDFilter5EndDate.Text = Format(Date.Today(), "yyyy-MM-dd")
            txtFREDFilter5.Text = ""
            numFREDFilter5Start.Text = ""
            numFREDFilter5End.Text = ""
            'ddlFREDFilterOption5.SelectedIndex = 0

            lblFREEFilter1.Text = " Filter #1"
            lblFREEFilter2.Text = " Filter #2"
            lblFREEFilter3.Text = " Filter #3"
            lblFREEFilter4.Text = " Filter #4"
            lblFREEFilter5.Text = " Filter #5"

            LoadForcedFilter()
            FillForcedColumnddl()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDSelectAll1_Click(sender As Object, e As System.EventArgs) Handles FREDSelectAll1.Click
        Try

            For i As Integer = 0 To cblFREDSelect1.Items.Count - 1
                cblFREDSelect1.Items(i).Selected = True

            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDSelectAll2_Click(sender As Object, e As System.EventArgs) Handles FREDSelectAll2.Click
        Try

            For i As Integer = 0 To cblFREDSelect2.Items.Count - 1
                cblFREDSelect2.Items(i).Selected = True

            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDSelectAll3_Click(sender As Object, e As System.EventArgs) Handles FREDSelectAll3.Click
        Try

            For i As Integer = 0 To cblFREDSelect3.Items.Count - 1
                cblFREDSelect3.Items(i).Selected = True

            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDSelectAll4_Click(sender As Object, e As System.EventArgs) Handles FREDSelectAll4.Click
        Try

            For i As Integer = 0 To cblFREDSelect4.Items.Count - 1
                cblFREDSelect4.Items(i).Selected = True

            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDUnSelectAll1_Click(sender As Object, e As System.EventArgs) Handles FREDUnSelectAll1.Click
        Try

            For i As Integer = 0 To cblFREDSelect1.Items.Count - 1
                cblFREDSelect1.Items(i).Selected = False

            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDUnSelectAll2_Click(sender As Object, e As System.EventArgs) Handles FREDUnSelectAll2.Click
        Try

            For i As Integer = 0 To cblFREDSelect2.Items.Count - 1
                cblFREDSelect2.Items(i).Selected = False

            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDUnSelectAll3_Click(sender As Object, e As System.EventArgs) Handles FREDUnSelectAll3.Click
        Try
            For i As Integer = 0 To cblFREDSelect3.Items.Count - 1
                cblFREDSelect3.Items(i).Selected = False
            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub FREDUnSelectAll4_Click(sender As Object, e As System.EventArgs) Handles FREDUnSelectAll4.Click
        Try
            For i As Integer = 0 To cblFREDSelect4.Items.Count - 1
                cblFREDSelect4.Items(i).Selected = False
            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilter1_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilter1.SelectedIndexChanged
        Try
            Dim save As String = ddlFREDFilterOption1.SelectedValue.ToString

            lblFREEFilter1.Text = "Filter #1 - " & rblFREDFilter1.SelectedItem.Text & " (" & ddlFREDFilter1.SelectedValue & ")"
            upFREEFILTER1.Update()

            Dim DTSQL As String = "select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter1.SelectedValue.ToString & _
                     "  and Column_Alias = '" & ddlFREDFilter1.SelectedValue & "' "

            ddlFREDFilterOption1.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption1.Items.Add("=")
                        ddlFREDFilterOption1.Items.Add("<")
                        ddlFREDFilterOption1.Items.Add("<=")
                        ddlFREDFilterOption1.Items.Add(">")
                        ddlFREDFilterOption1.Items.Add(">=")
                        ddlFREDFilterOption1.Items.Add("like")
                        ddlFREDFilterOption1.Items.Add("contains")
                        ddlFREDFilterOption1.Items.Add("not like")
                        ddlFREDFilterOption1.Items.Add("does not contain")
                        ddlFREDFilterOption1.Items.Add("DATE between")
                        ddlFREDFilterOption1.Items.Add("DATE not between")
                        ddlFREDFilterOption1.Items.Add("NULL")
                        ddlFREDFilterOption1.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption1.Items.Add("=")
                        ddlFREDFilterOption1.Items.Add("≠")
                        ddlFREDFilterOption1.Items.Add("<")
                        ddlFREDFilterOption1.Items.Add("<=")
                        ddlFREDFilterOption1.Items.Add(">")
                        ddlFREDFilterOption1.Items.Add(">=")
                        ddlFREDFilterOption1.Items.Add("like")
                        ddlFREDFilterOption1.Items.Add("contains")
                        ddlFREDFilterOption1.Items.Add("not like")
                        ddlFREDFilterOption1.Items.Add("does not contain")
                        ddlFREDFilterOption1.Items.Add("between")
                        ddlFREDFilterOption1.Items.Add("not between")
                        ddlFREDFilterOption1.Items.Add("NULL")
                        ddlFREDFilterOption1.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using

            ddlFREDFilterOption1.SelectedValue = save

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilter2_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilter2.SelectedIndexChanged
        Try

            lblFREEFilter2.Text = "Filter #2 - " & rblFREDFilter2.SelectedItem.Text & " (" & ddlFREDFilter2.SelectedValue & ")"
            upFREEFILTER2.Update()

            Dim DTSQL As String = "select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter2.SelectedValue.ToString & _
             "  and Column_Alias = '" & ddlFREDFilter2.SelectedValue & "' "

            ddlFREDFilterOption2.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption2.Items.Add("=")
                        ddlFREDFilterOption2.Items.Add("<")
                        ddlFREDFilterOption2.Items.Add("<=")
                        ddlFREDFilterOption2.Items.Add(">")
                        ddlFREDFilterOption2.Items.Add(">=")
                        ddlFREDFilterOption2.Items.Add("like")
                        ddlFREDFilterOption2.Items.Add("contains")
                        ddlFREDFilterOption2.Items.Add("not like")
                        ddlFREDFilterOption2.Items.Add("does not contain")
                        ddlFREDFilterOption2.Items.Add("DATE between")
                        ddlFREDFilterOption2.Items.Add("DATE not between")
                        ddlFREDFilterOption2.Items.Add("NULL")
                        ddlFREDFilterOption2.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption2.Items.Add("=")
                        ddlFREDFilterOption2.Items.Add("≠")
                        ddlFREDFilterOption2.Items.Add("<")
                        ddlFREDFilterOption2.Items.Add("<=")
                        ddlFREDFilterOption2.Items.Add(">")
                        ddlFREDFilterOption2.Items.Add(">=")
                        ddlFREDFilterOption2.Items.Add("like")
                        ddlFREDFilterOption2.Items.Add("contains")
                        ddlFREDFilterOption2.Items.Add("not like")
                        ddlFREDFilterOption2.Items.Add("does not contain")
                        ddlFREDFilterOption2.Items.Add("between")
                        ddlFREDFilterOption2.Items.Add("not between")
                        ddlFREDFilterOption2.Items.Add("NULL")
                        ddlFREDFilterOption2.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilter3_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilter3.SelectedIndexChanged
        Try

            lblFREEFilter3.Text = "Filter #3 - " & rblFREDFilter3.SelectedItem.Text & " (" & ddlFREDFilter3.SelectedValue & ")"
            upFREEFILTER3.Update()

            Dim DTSQL As String = "select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter3.SelectedValue.ToString & _
     "  and Column_Alias = '" & ddlFREDFilter3.SelectedValue & "' "

            ddlFREDFilterOption3.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption3.Items.Add("=")
                        ddlFREDFilterOption3.Items.Add("<")
                        ddlFREDFilterOption3.Items.Add("<=")
                        ddlFREDFilterOption3.Items.Add(">")
                        ddlFREDFilterOption3.Items.Add(">=")
                        ddlFREDFilterOption3.Items.Add("like")
                        ddlFREDFilterOption3.Items.Add("contains")
                        ddlFREDFilterOption3.Items.Add("not like")
                        ddlFREDFilterOption3.Items.Add("does not contain")
                        ddlFREDFilterOption3.Items.Add("DATE between")
                        ddlFREDFilterOption3.Items.Add("DATE not between")
                        ddlFREDFilterOption3.Items.Add("NULL")
                        ddlFREDFilterOption3.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption3.Items.Add("=")
                        ddlFREDFilterOption3.Items.Add("≠")
                        ddlFREDFilterOption3.Items.Add("<")
                        ddlFREDFilterOption3.Items.Add("<=")
                        ddlFREDFilterOption3.Items.Add(">")
                        ddlFREDFilterOption3.Items.Add(">=")
                        ddlFREDFilterOption3.Items.Add("like")
                        ddlFREDFilterOption3.Items.Add("contains")
                        ddlFREDFilterOption3.Items.Add("not like")
                        ddlFREDFilterOption3.Items.Add("does not contain")
                        ddlFREDFilterOption3.Items.Add("between")
                        ddlFREDFilterOption3.Items.Add("not between")
                        ddlFREDFilterOption3.Items.Add("NULL")
                        ddlFREDFilterOption3.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilter4_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilter4.SelectedIndexChanged
        Try

            lblFREEFilter4.Text = "Filter #4 - " & rblFREDFilter4.SelectedItem.Text & " (" & ddlFREDFilter4.SelectedValue & ")"
            upFREEFILTER4.Update()

            Dim DTSQL As String = "select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter4.SelectedValue.ToString & _
     "  and Column_Alias = '" & ddlFREDFilter4.SelectedValue & "' "

            ddlFREDFilterOption4.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption4.Items.Add("=")
                        ddlFREDFilterOption4.Items.Add("<")
                        ddlFREDFilterOption4.Items.Add("<=")
                        ddlFREDFilterOption4.Items.Add(">")
                        ddlFREDFilterOption4.Items.Add(">=")
                        ddlFREDFilterOption4.Items.Add("like")
                        ddlFREDFilterOption4.Items.Add("contains")
                        ddlFREDFilterOption4.Items.Add("not like")
                        ddlFREDFilterOption4.Items.Add("does not contain")
                        ddlFREDFilterOption4.Items.Add("DATE between")
                        ddlFREDFilterOption4.Items.Add("DATE not between")
                        ddlFREDFilterOption4.Items.Add("NULL")
                        ddlFREDFilterOption4.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption4.Items.Add("=")
                        ddlFREDFilterOption4.Items.Add("≠")
                        ddlFREDFilterOption4.Items.Add("<")
                        ddlFREDFilterOption4.Items.Add("<=")
                        ddlFREDFilterOption4.Items.Add(">")
                        ddlFREDFilterOption4.Items.Add(">=")
                        ddlFREDFilterOption4.Items.Add("like")
                        ddlFREDFilterOption4.Items.Add("contains")
                        ddlFREDFilterOption4.Items.Add("not like")
                        ddlFREDFilterOption4.Items.Add("does not contain")
                        ddlFREDFilterOption4.Items.Add("between")
                        ddlFREDFilterOption4.Items.Add("not between")
                        ddlFREDFilterOption4.Items.Add("NULL")
                        ddlFREDFilterOption4.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub ddlFREDFilter5_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles ddlFREDFilter5.SelectedIndexChanged
        Try

            lblFREEFilter5.Text = "Filter #5 - " & rblFREDFilter5.SelectedItem.Text & " (" & ddlFREDFilter5.SelectedValue & ")"
            upFREEFILTER5.Update()

            Dim DTSQL As String = "select DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter5.SelectedValue.ToString & _
     "  and Column_Alias = '" & ddlFREDFilter5.SelectedValue & "' "

            ddlFREDFilterOption5.Items.Clear()
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New SqlCommand(DTSQL, conn)
                cmd.CommandTimeout = 86400

                dr = cmd.ExecuteReader
                While dr.Read
                    If IsDBNull(dr.Item("DataType")) Then
                    ElseIf InStr(dr.Item("DataType"), "date") > 0 Or InStr(dr.Item("DataType"), "time") > 0 Then
                        ddlFREDFilterOption5.Items.Add("=")
                        ddlFREDFilterOption5.Items.Add("<")
                        ddlFREDFilterOption5.Items.Add("<=")
                        ddlFREDFilterOption5.Items.Add(">")
                        ddlFREDFilterOption5.Items.Add(">=")
                        ddlFREDFilterOption5.Items.Add("like")
                        ddlFREDFilterOption5.Items.Add("contains")
                        ddlFREDFilterOption5.Items.Add("not like")
                        ddlFREDFilterOption5.Items.Add("does not contain")
                        ddlFREDFilterOption5.Items.Add("DATE between")
                        ddlFREDFilterOption5.Items.Add("DATE not between")
                        ddlFREDFilterOption5.Items.Add("NULL")
                        ddlFREDFilterOption5.Items.Add("NOT NULL")
                    Else
                        ddlFREDFilterOption5.Items.Add("=")
                        ddlFREDFilterOption5.Items.Add("≠")
                        ddlFREDFilterOption5.Items.Add("<")
                        ddlFREDFilterOption5.Items.Add("<=")
                        ddlFREDFilterOption5.Items.Add(">")
                        ddlFREDFilterOption5.Items.Add(">=")
                        ddlFREDFilterOption5.Items.Add("like")
                        ddlFREDFilterOption5.Items.Add("contains")
                        ddlFREDFilterOption5.Items.Add("not like")
                        ddlFREDFilterOption5.Items.Add("does not contain")
                        ddlFREDFilterOption5.Items.Add("between")
                        ddlFREDFilterOption5.Items.Add("not between")
                        ddlFREDFilterOption5.Items.Add("NULL")
                        ddlFREDFilterOption5.Items.Add("NOT NULL")
                    End If
                End While
                dr.Close()
            End Using

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub gvFREDData_PageIndexChanging(sender As Object, e As System.Web.UI.WebControls.GridViewPageEventArgs) Handles gvFREDData.PageIndexChanging
        Try

            gvFREDData.PageIndex = e.NewPageIndex
            BindFred()


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    Private Sub gvFREDData_RowDataBound(sender As Object, e As System.Web.UI.WebControls.GridViewRowEventArgs) Handles gvFREDData.RowDataBound
        'Try
        '    If e.Row.RowType = DataControlRowType.DataRow Then
        '        Dim drv As DataRowView = DirectCast(e.Row.DataItem, DataRowView)
        '        For i As Integer = 0 To drv.DataView.Table.Columns.Count - 1
        '            If drv.DataView.Table.Columns(i).ColumnName.Contains("(TSTAR)") Then            'TSTAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.Gold
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("(STAR)") Then               'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.LawnGreen
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionAdjustment") Then   'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.LightSeaGreen
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionBill") Then         'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.LightSeaGreen
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("Transaction Cash") Then         'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.Green
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionMemo") Then         'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.GreenYellow
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionNote") Then         'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.MediumSeaGreen
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionRefund") Then       'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.SpringGreen
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionTransfer") Then     'STAR Data 
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.PaleGreen
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("FARGLD_ALL_View") Then       'GL Finance (FARGLD) data 
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.CornflowerBlue
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("PatientChargeDetail") Then     'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.BlanchedAlmond
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("MgdCareComponents") Then        'STAR Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.Yellow
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("(MPA)") Then                    'MPA Data
        '                e.Row.Cells(i).BackColor = System.Drawing.Color.Tomato
        '            Else

        '            End If
        '        Next
        '    End If

        'Catch ex As Exception

        'End Try

        Try
            If e.Row.RowType = DataControlRowType.DataRow Then
                Dim drv As DataRowView = DirectCast(e.Row.DataItem, DataRowView)
                For i As Integer = 0 To drv.DataView.Table.Columns.Count - 1
                    For Each colorselect As DataRow In Palette.Rows
                        If drv.DataView.Table.Columns(i).ColumnName.Contains(colorselect("Table_Alias")) Then
                            If IsDBNull(colorselect("GridColor")) Then
                            ElseIf e.Row.RowIndex Mod 2 = 1 Then
                                e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#" & colorselect("GridColor").ToString)
                            End If

                        End If
                        'If drv.DataView.Table.Columns(i).ColumnName.Contains("(TSTAR)") Then            'TSTAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ffffc8")
                        '    legendtable.Rows(0).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("(STAR)") Then               'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#c8c8ff")
                        '    legendtable.Rows(1).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionAdjustment") Then   'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#c8ffff")
                        '    legendtable.Rows(2).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionBill") Then         'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#96c8ff")
                        '    legendtable.Rows(3).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("Transaction Cash") Then         'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#00ffff")
                        '    legendtable.Rows(4).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionMemo") Then         'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.Color.GreenYellow
                        '    legendtable.Rows(5).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionNote") Then         'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.Color.MediumSeaGreen
                        '    legendtable.Rows(6).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionRefund") Then       'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.Color.SpringGreen
                        '    legendtable.Rows(7).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionTransfer") Then     'STAR Data 
                        '    e.Row.Cells(i).BackColor = System.Drawing.Color.PaleGreen
                        '    legendtable.Rows(8).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("FARGLD_ALL_View") Then       'GL Finance (FARGLD) data 
                        '    e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#c8ffc8")
                        '    legendtable.Rows(9).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("PatientChargeDetail") Then     'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#d2b9ff")
                        '    legendtable.Rows(10).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("MgdCareComponents") Then        'STAR Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.Color.Yellow
                        '    legendtable.Rows(11).Visible = True
                        'ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("(MPA)") Then                    'MPA Data
                        '    e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ffc8c8")
                        '    legendtable.Rows(12).Visible = True

                        'MPA reserved colors:
                        'e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ffc8ff")
                        'e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ffc892")
                        'e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ffb9d2")
                        'Else

                        'End If
                        'Else
                        '    If drv.DataView.Table.Columns(i).ColumnName.Contains("(TSTAR)") Then            'TSTAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ffff96")
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("(STAR)") Then               'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#9696ff")
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionAdjustment") Then   'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#96ffff")
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionBill") Then         'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#64afff")
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("Transaction Cash") Then         'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#00c8ff")
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionMemo") Then         'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.Color.GreenYellow
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionNote") Then         'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.Color.MediumSeaGreen
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionRefund") Then       'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.Color.SpringGreen
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("TransactionTransfer") Then     'STAR Data 
                        '        e.Row.Cells(i).BackColor = System.Drawing.Color.PaleGreen
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("FARGLD_ALL_View") Then       'GL Finance (FARGLD) data 
                        '        e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#96ff96")
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("PatientChargeDetail") Then     'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#c896ff")
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("MgdCareComponents") Then        'STAR Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.Color.Yellow
                        '    ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("(MPA)") Then                    'MPA Data
                        '        e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ff9696")
                        '    Else

                        '        'MPA reserved colors
                        '        'e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ff96ff")
                        '        'e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ffb464")
                        '        'e.Row.Cells(i).BackColor = System.Drawing.ColorTranslator.FromHtml("#ff96c8")

                        '    End If
                        'End If
                    Next
                Next
            End If

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try



    End Sub
    Private Sub gvFREDData_Sorting(sender As Object, e As System.Web.UI.WebControls.GridViewSortEventArgs) Handles gvFREDData.Sorting
        Try

            '   BindFred()
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub

    'Private Sub chbSavetoFavorites_CheckedChanged(sender As Object, e As System.EventArgs) Handles chbSavetoFavorites.CheckedChanged
    Private Sub btnAddFavorites_Click(sender As Object, e As System.EventArgs) Handles btnAddFavorites.Click

        Try

            Dim favcountcheck As String
            Dim x As Integer

            If txtnewFavName.Text = "" Then
                ExplanationLabel2.Text = "Please Name Favorite"
                ModalPopupExtender2.Show()
                Exit Sub
            End If

            favcountcheck = "select count(*) FROM [WebFD].[FRED].[FredFavorites]" & _
                " where Userlogin = '" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "'"

            Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                Dim dc As SqlCommand
                dc = New SqlCommand(favcountcheck, conn2)
                Try
                    conn2.Open()
                    x = dc.ExecuteScalar()
                Catch ex As Exception
                    LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                    'gridname = "error1"
                End Try

            End Using

            If x >= 25 Then
                ExplanationLabel2.Text = "Maximum number of Favorites reached"
                ModalPopupExtender2.Show()
                Exit Sub
            End If

            Dim StoreFavorite As String
            Dim selectlisttrans As String = " "
            Dim selectlist1 As String = " "
            Dim selectlist2 As String = " "
            Dim selectlist3 As String = " "
            Dim selectlist4 As String = " "

            If cblFREDSelectTrans IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelectTrans.Items
                    If (checkeditem.Selected) Then
                        selectlisttrans += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If
            If cblFREDSelect1 IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelect1.Items
                    If (checkeditem.Selected) Then
                        selectlist1 += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If
            If cblFREDSelect2 IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelect2.Items
                    If (checkeditem.Selected) Then
                        selectlist2 += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If
            If cblFREDSelect3 IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelect3.Items
                    If (checkeditem.Selected) Then
                        selectlist3 += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If
            If cblFREDSelect4 IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelect4.Items
                    If (checkeditem.Selected) Then
                        selectlist4 += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If

            Dim txtbox1 As String = ""
            Dim txtbox1two As String = ""

            Select Case ddlFREDFilterOption1.Text
                Case "between"
                    txtbox1 = numFREDFilter1Start.Text
                    txtbox1two = numFREDFilter1End.Text
                Case "not between"
                    txtbox1 = numFREDFilter1Start.Text
                    txtbox1two = numFREDFilter1End.Text
                Case "DATE between"
                    txtbox1 = dtpFREDFilter1StartDate.Text
                    txtbox1two = dtpFREDFilter1EndDate.Text
                Case "DATE not between"
                    txtbox1 = dtpFREDFilter1StartDate.Text
                    txtbox1two = dtpFREDFilter1EndDate.Text
                Case "contains"
                    txtbox1 = txtFREDFilter1.Text
                Case "does not contain"
                    txtbox1 = txtFREDFilter1.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox1 = txtFREDFilter1.Text
            End Select

            Dim txtbox2 As String = ""
            Dim txtbox2two As String = ""

            Select Case ddlFREDFilterOption2.Text
                Case "between"
                    txtbox2 = numFREDFilter2Start.Text
                    txtbox2two = numFREDFilter2End.Text
                Case "not between"
                    txtbox2 = numFREDFilter2Start.Text
                    txtbox2two = numFREDFilter2End.Text
                Case "DATE between"
                    txtbox2 = dtpFREDFilter2StartDate.Text
                    txtbox2two = dtpFREDFilter2EndDate.Text
                Case "DATE not between"
                    txtbox2 = dtpFREDFilter2StartDate.Text
                    txtbox2two = dtpFREDFilter2EndDate.Text
                Case "contains"
                    txtbox2 = txtFREDFilter2.Text
                Case "does not contain"
                    txtbox2 = txtFREDFilter2.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox2 = txtFREDFilter2.Text
            End Select

            Dim txtbox3 As String = ""
            Dim txtbox3two As String = ""

            Select Case ddlFREDFilterOption3.Text
                Case "between"
                    txtbox3 = numFREDFilter3Start.Text
                    txtbox3two = numFREDFilter3End.Text
                Case "not between"
                    txtbox3 = numFREDFilter3Start.Text
                    txtbox3two = numFREDFilter3End.Text
                Case "DATE between"
                    txtbox3 = dtpFREDFilter3StartDate.Text
                    txtbox3two = dtpFREDFilter3EndDate.Text
                Case "DATE not between"
                    txtbox3 = dtpFREDFilter3StartDate.Text
                    txtbox3two = dtpFREDFilter3EndDate.Text
                Case "contains"
                    txtbox3 = txtFREDFilter3.Text
                Case "does not contain"
                    txtbox3 = txtFREDFilter3.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox3 = txtFREDFilter3.Text
            End Select

            Dim txtbox4 As String = ""
            Dim txtbox4two As String = ""

            Select Case ddlFREDFilterOption4.Text
                Case "between"
                    txtbox4 = numFREDFilter4Start.Text
                    txtbox4two = numFREDFilter4End.Text
                Case "not between"
                    txtbox4 = numFREDFilter4Start.Text
                    txtbox4two = numFREDFilter4End.Text
                Case "DATE between"
                    txtbox4 = dtpFREDFilter4StartDate.Text
                    txtbox4two = dtpFREDFilter4EndDate.Text
                Case "DATE not between"
                    txtbox4 = dtpFREDFilter4StartDate.Text
                    txtbox4two = dtpFREDFilter4EndDate.Text
                Case "contains"
                    txtbox4 = txtFREDFilter4.Text
                Case "does not contain"
                    txtbox4 = txtFREDFilter4.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox4 = txtFREDFilter4.Text
            End Select

            Dim txtbox5 As String = ""
            Dim txtbox5two As String = ""

            Select Case ddlFREDFilterOption5.Text
                Case "between"
                    txtbox5 = numFREDFilter5Start.Text
                    txtbox5two = numFREDFilter5End.Text
                Case "not between"
                    txtbox5 = numFREDFilter5Start.Text
                    txtbox5two = numFREDFilter5End.Text
                Case "DATE between"
                    txtbox5 = dtpFREDFilter5StartDate.Text
                    txtbox5two = dtpFREDFilter5EndDate.Text
                Case "DATE not between"
                    txtbox5 = dtpFREDFilter5StartDate.Text
                    txtbox5two = dtpFREDFilter5EndDate.Text
                Case "contains"
                    txtbox5 = txtFREDFilter5.Text
                Case "does not contain"
                    txtbox5 = txtFREDFilter5.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox5 = txtFREDFilter5.Text
            End Select


            StoreFavorite = "Insert into WebFD.FRED.FredFavorites " & _
             "([Userlogin], [FavoriteName], [IsEncounter],[TransTableID],[TransTableColumns], " & _
             "[Table1ID], [Table1Columns], " & _
             "[Table2ID], [Table2Columns]," & _
             "[Table3ID], [Table3Columns], " & _
             "[Table4ID], [Table4Columns], " & _
             "[Filter1TID], [Filter1DDColumnID], [Filter1Op], [Filter1Txt1],[Filter1Txt2], " & _
             "[Filter2TID], [Filter2DDColumnID], [Filter2Op], [Filter2Txt1],[Filter2Txt2], " & _
             "[Filter3TID], [Filter3DDColumnID], [Filter3Op], [Filter3Txt1],[Filter3Txt2], " & _
             "[Filter4TID], [Filter4DDColumnID], [Filter4Op], [Filter4Txt1],[Filter4Txt2], " & _
             "[Filter5TID], [Filter5DDColumnID], [Filter5Op], [Filter5Txt1],[Filter5Txt2], " & _
             "[LoadDate], [ExistsChecked]) " & _
             " values " & _
             "('" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "', " & _
             "'" & Replace(txtnewFavName.Text, "'", "''") & "', " & _
             "'" & Replace(rblDataType.SelectedValue, "'", "''") & "', " & _
             "'" & lblFredTableTransID.Text & "', " & _
             "'" & selectlisttrans & "', " & _
             "'" & lblFredTable1ID.Text & "', '" & selectlist1 & "', " & _
             "'" & lblFredTable2ID.Text & "', '" & selectlist2 & "', " & _
             "'" & lblFredTable3ID.Text & "', '" & selectlist3 & "', " & _
             "'" & lblFredTable4ID.Text & "', '" & selectlist4 & "', " & _
            "" & rblFREDFilter1.SelectedValue & ",(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter1.SelectedValue & "' and TABLE_ID = " & rblFREDFilter1.SelectedValue & "),'" & ddlFREDFilterOption1.Text & "','" & Replace(txtbox1, "'", "''") & "','" & Replace(txtbox1two, "'", "''") & "', " & _
           "" & rblFREDFilter2.SelectedValue & ",(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter2.SelectedValue & "' and TABLE_ID = " & rblFREDFilter2.SelectedValue & "),'" & ddlFREDFilterOption2.Text & "','" & Replace(txtbox2, "'", "''") & "','" & Replace(txtbox2two, "'", "''") & "', " & _
             "" & rblFREDFilter3.SelectedValue & ",(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter3.SelectedValue & "' and TABLE_ID = " & rblFREDFilter3.SelectedValue & "),'" & ddlFREDFilterOption3.Text & "','" & Replace(txtbox3, "'", "''") & "','" & Replace(txtbox3two, "'", "''") & "', " & _
            "" & rblFREDFilter4.SelectedValue & ",(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter4.SelectedValue & "' and TABLE_ID = " & rblFREDFilter4.SelectedValue & "),'" & ddlFREDFilterOption4.Text & "','" & Replace(txtbox4, "'", "''") & "','" & Replace(txtbox4two, "'", "''") & "', " & _
             "" & rblFREDFilter5.SelectedValue & ",(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter5.SelectedValue & "' and TABLE_ID = " & rblFREDFilter5.SelectedValue & "),'" & ddlFREDFilterOption5.Text & "','" & Replace(txtbox5, "'", "''") & "','" & Replace(txtbox5two, "'", "''") & "' " & _
            ",convert(date, getdate()), " & CInt(chbWhereExists.Checked) & ")"


            '  "('" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") "', " & _
            'rblFREDFilter1.SelectedValue & ", " & "(SELECT  ID FROM[WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter1.SelectedValue & _
            '"' and TABLE_ID = " & rblFREDFilter1.SelectedValue & ")" & ", '" & ddlFREDFilterOption1.Text & "', '" & Replace(txtbox1, "'", "''") & "', '" & Replace(txtbox1two, "'", "''") & "', " & _
            'rblFREDFilter2.SelectedValue & ", " & "(SELECT  ID FROM[WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter2.SelectedValue & _
            '"' and TABLE_ID = " & rblFREDFilter2.SelectedValue & ")" & ", '" & ddlFREDFilterOption2.Text & "', '" & Replace(txtbox2, "'", "''") & "', '" & Replace(txtbox2two, "'", "''") & "', " & _
            'rblFREDFilter3.SelectedValue & ", " & "(SELECT  ID FROM[WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter3.SelectedValue & _
            '"' and TABLE_ID = " & rblFREDFilter3.SelectedValue & ")" & ", '" & ddlFREDFilterOption3.Text & "', '" & Replace(txtbox3, "'", "''") & "', '" & Replace(txtbox3two, "'", "''") & "', " & _
            'rblFREDFilter4.SelectedValue & ", " & "(SELECT  ID FROM[WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter4.SelectedValue & _
            '"' and TABLE_ID = " & rblFREDFilter4.SelectedValue & ")" & ", '" & ddlFREDFilterOption4.Text & "', '" & Replace(txtbox4, "'", "''") & "', '" & Replace(txtbox4two, "'", "''") & "', " & _
            'rblFREDFilter5.SelectedValue & ", " & "(SELECT  ID FROM[WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter5.SelectedValue & _
            '"' and TABLE_ID = " & rblFREDFilter5.SelectedValue & ")" & ", '" & ddlFREDFilterOption5.Text & "', '" & Replace(txtbox5, "'", "''") & "', '" & Replace(txtbox5two, "'", "''") & "', " & _
            '"convert(date, getdate())" & ")"

            Try

                Using conn As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If

                    cmd = New System.Data.SqlClient.SqlCommand(StoreFavorite, conn)
                    cmd.ExecuteNonQuery()

                End Using

                ExplanationLabel2.Text = "Favorite Saved"
                ModalPopupExtender2.Show()

            Catch ex As Exception
                ExplanationLabel2.Text = "Error Saving Favorite -- Favorite Name must be unique"
                ModalPopupExtender2.Show()
            End Try


            Dim getfavorite As String
            Dim favoriteinfo As New DataSet


            getfavorite = "SELECT [FavoriteName], [LoadDate] " & _
    "  FROM [WebFD].[FRED].[FredFavorites] ff" & _
    " where Userlogin = '" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "' order by FavoriteName asc"

            Try

                Dim da As SqlDataAdapter

                favoriteinfo.Clear()
                Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    da = New SqlDataAdapter(getfavorite, conn2)
                    da.Fill(favoriteinfo, "DEMO")
                    newgvFavorites.DataSource = favoriteinfo
                    newgvFavorites.DataMember = "DEMO"
                    newgvFavorites.DataBind()
                End Using


            Catch ex As Exception
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            End Try
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub

    Private Sub newgvFavorites_SelectedIndexChanged(sender As Object, e As System.EventArgs) Handles newgvFavorites.SelectedIndexChanged
        Try


            ResetFREDFilters()
            acrFREDFilter.SelectedIndex = 0

            Dim dr As DataRow
            Dim tbl1list As String
            Dim tbl2list As String
            Dim tbl3list As String
            Dim tbl4list As String
            Dim tbltranslist As String

            Dim getfavorite As String
            Dim favoriteinfo As New DataSet

            Dim rd As SqlDataReader

            getfavorite = "SELECT ff.[ID],[Userlogin],[FavoriteName],[IsEncounter],[TransTableID],[TransTableColumns],[Table1ID],[Table1Columns],[Table2ID],[Table2Columns],[Table3ID]," & _
    "[Table3Columns],[Table4ID],[Table4Columns],[Filter1TID],[Filter1DDColumnID]	  ,tone.COLUMN_NAME as [Filter1ColumnName],[Filter1Op]," & _
    "[Filter1Txt1],[Filter1Txt2],[Filter2TID],[Filter2DDColumnID]	  ,ttwo.COLUMN_NAME as [Filter2ColumnName],[Filter2Op]," & _
    "[Filter2Txt1],[Filter2Txt2],[Filter3TID],[Filter3DDColumnID]	  ,tthree.COLUMN_NAME as [Filter3ColumnName],[Filter3Op]," & _
    "[Filter3Txt1],[Filter3Txt2],[Filter4TID],[Filter4DDColumnID],tfour.COLUMN_NAME as [Filter4ColumnName],[Filter4Op],[Filter4Txt1]," & _
    " [Filter4Txt2],[Filter5TID],[Filter5DDColumnID]	  ,tfive.COLUMN_NAME as [Filter5ColumnName],[Filter5Op],[Filter5Txt1],[Filter5Txt2], [ExistsChecked]" & _
    "  FROM [WebFD].[FRED].[FredFavorites] ff" & _
    "    left join WebFD.FRED.AvailableColumns tone on tone.TABLE_ID = [Filter1TID] and tone.ID = [Filter1DDColumnID] " & _
    "     left join WebFD.FRED.AvailableColumns ttwo on ttwo.TABLE_ID = [Filter2TID] and ttwo.ID = [Filter2DDColumnID]  " & _
    "         left join WebFD.FRED.AvailableColumns tthree on tthree.TABLE_ID = [Filter3TID] and tthree.ID = [Filter3DDColumnID] " & _
    "             left join WebFD.FRED.AvailableColumns tfour on tfour.TABLE_ID = [Filter4TID] and tfour.ID = [Filter4DDColumnID] " & _
    "                left join WebFD.FRED.AvailableColumns tfive on tfive.TABLE_ID = [Filter5TID] and tfive.ID = [Filter5DDColumnID] " & _
    " where Userlogin = '" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "' order by FavoriteName asc"

            Try

                Dim da4 As SqlDataAdapter

                Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    da4 = New SqlDataAdapter(getfavorite, conn2)
                    da4.Fill(favoriteinfo)
                End Using


            Catch ex As Exception
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            End Try


            doctor = favoriteinfo.Tables(0).Rows(newgvFavorites.SelectedIndex)
            dr = favoriteinfo.Tables(0).Rows(newgvFavorites.SelectedIndex)
            rblDataType.SelectedValue = CInt(dr("IsEncounter")) * -1
            LoadForcedFilter()
            If IsNothing(dr("TransTableID")) Or CInt(dr("IsEncounter")) * -1 <> 1 Then
                rblDataType.SelectedIndex = 0
                chbWhereExists.Visible = False
                ddlFREDTables.SelectedIndex = 0
                ddlFREDTables.Visible = False
                SetFREDSelectAccordion(0)
            ElseIf CInt(dr("IsEncounter")) * -1 = 1 Then
                rblFREDFilter1.SelectedValue = CInt(dr("TransTableID"))
                chbWhereExists.Visible = True
                ddlFREDTables.Visible = True
                ddlFREDTables.SelectedValue = CInt(dr("TransTableID"))
                SetFREDSelectAccordion(CInt(dr("TransTableID")))
                FillForcedColumnddl()
            End If

            txtnewFavName.Text = dr("FavoriteName").ToString
            tbltranslist = dr("TransTableColumns").ToString
            tbl1list = dr("Table1Columns").ToString
            tbl2list = dr("Table2Columns").ToString
            tbl3list = dr("Table3Columns").ToString
            tbl4list = dr("Table4Columns").ToString
            rblFREDFilter1.SelectedValue = CInt(dr("Filter1TID"))
            rblFREDFilter2.SelectedValue = CInt(dr("Filter2TID"))
            rblFREDFilter3.SelectedValue = CInt(dr("Filter3TID"))
            rblFREDFilter4.SelectedValue = CInt(dr("Filter4TID"))
            rblFREDFilter5.SelectedValue = CInt(dr("Filter5TID"))
            chbWhereExists.Checked = dr("ExistsChecked")
            'rblFREDFilter1.Items.FindByValue(CInt(dr("Filter1TID"))).Selected = True
            'rblFREDFilter2.Items.FindByValue(CInt(dr("Filter2TID"))).Selected = True
            'rblFREDFilter3.Items.FindByValue(CInt(dr("Filter3TID"))).Selected = True
            'rblFREDFilter4.Items.FindByValue(CInt(dr("Filter4TID"))).Selected = True
            'rblFREDFilter5.Items.FindByValue(CInt(dr("Filter5TID"))).Selected = True

            rbl1changed(CInt(dr("Filter1TID")))
            rbl2changed(CInt(dr("Filter2TID")))
            rbl3changed(CInt(dr("Filter3TID")))
            rbl4changed(CInt(dr("Filter4TID")))
            rbl5changed(CInt(dr("Filter5TID")))

            If IsDBNull(dr("Filter1ColumnName")) Then
            ElseIf dr("Filter1ColumnName") = " " Then
            Else
                ddlFREDFilter1.Items.FindByValue(dr("Filter1ColumnName")).Selected = True
                pnltxtFREDFilter1.Visible = False
                pnlnumFREDFilter1.Visible = False
                pnldtpFREDFilter1.Visible = False
                lblFREDFilter1.Visible = False
                lblFREDFilter1b.Visible = False

                Select Case dr("Filter1Op").ToString
                    Case "between"
                        ddlFREDFilterOption1.SelectedValue = "between"
                        pnlnumFREDFilter1.Visible = True
                    Case "not between"
                        ddlFREDFilterOption1.SelectedValue = "not between"
                        pnlnumFREDFilter1.Visible = True
                    Case "DATE between"
                        ddlFREDFilterOption1.SelectedValue = "DATE between"
                        pnldtpFREDFilter1.Visible = True
                    Case "DATE not between"
                        ddlFREDFilterOption1.SelectedValue = "DATE not between"
                        pnldtpFREDFilter1.Visible = True
                    Case "contains"
                        ddlFREDFilterOption1.SelectedValue = "contains"
                        lblFREDFilter1.Visible = True
                        lblFREDFilter1b.Visible = True
                        pnltxtFREDFilter1.Visible = True
                    Case "does not contain"
                        ddlFREDFilterOption1.SelectedValue = "does not contain"
                        lblFREDFilter1.Visible = True
                        lblFREDFilter1b.Visible = True
                        pnltxtFREDFilter1.Visible = True
                    Case "NULL"
                        ddlFREDFilterOption1.SelectedValue = "NULL"
                    Case "NOT NULL"
                        ddlFREDFilterOption1.SelectedValue = "NOT NULL"
                    Case ">="
                        ddlFREDFilterOption1.SelectedValue = ">="
                        pnltxtFREDFilter1.Visible = True
                    Case "<="
                        ddlFREDFilterOption1.SelectedValue = "<="
                        pnltxtFREDFilter1.Visible = True
                    Case "="
                        ddlFREDFilterOption1.SelectedValue = "="
                        pnltxtFREDFilter1.Visible = True
                    Case "<"
                        ddlFREDFilterOption1.SelectedValue = "<"
                        pnltxtFREDFilter1.Visible = True
                    Case ">"
                        ddlFREDFilterOption1.SelectedValue = ">"
                        pnltxtFREDFilter1.Visible = True
                    Case "like"
                        ddlFREDFilterOption1.SelectedValue = "like"
                        pnltxtFREDFilter1.Visible = True
                    Case "not like"
                        ddlFREDFilterOption1.SelectedValue = "not like"
                        pnltxtFREDFilter1.Visible = True
                    Case Else
                        ddlFREDFilterOption1.SelectedValue = "≠"
                        pnltxtFREDFilter1.Visible = True
                End Select
            End If
            If IsDBNull(dr("Filter2ColumnName")) Then
            ElseIf dr("Filter2ColumnName") = " " Then
            Else
                ddlFREDFilter2.Items.FindByValue(dr("Filter2ColumnName")).Selected = True

                lblFREEFilter2.Text = "Filter #2 - " & rblFREDFilter2.SelectedItem.Text & " (" & ddlFREDFilter2.SelectedValue & ")"
                upFREEFILTER2.Update()

                Dim DTSQL As String = "select Top 1 DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter2.SelectedValue.ToString & _
                    "  and Column_Alias = '" & dr("Filter2ColumnName") & "' "

                ddlFREDFilterOption2.Items.Clear()
                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If

                    cmd = New SqlCommand(DTSQL, conn)
                    cmd.CommandTimeout = 86400

                    rd = cmd.ExecuteReader
                    While rd.Read
                        If IsDBNull(rd.Item("DataType")) Then
                        ElseIf InStr(rd.Item("DataType"), "date") > 0 Or InStr(rd.Item("DataType"), "time") > 0 Then
                            ddlFREDFilterOption2.Items.Add("=")
                            ddlFREDFilterOption2.Items.Add("<")
                            ddlFREDFilterOption2.Items.Add("<=")
                            ddlFREDFilterOption2.Items.Add(">")
                            ddlFREDFilterOption2.Items.Add(">=")
                            ddlFREDFilterOption2.Items.Add("like")
                            ddlFREDFilterOption2.Items.Add("contains")
                            ddlFREDFilterOption2.Items.Add("not like")
                            ddlFREDFilterOption2.Items.Add("does not contain")
                            ddlFREDFilterOption2.Items.Add("DATE between")
                            ddlFREDFilterOption2.Items.Add("DATE not between")
                            ddlFREDFilterOption2.Items.Add("NULL")
                            ddlFREDFilterOption2.Items.Add("NOT NULL")
                        Else
                            ddlFREDFilterOption2.Items.Add("=")
                            ddlFREDFilterOption2.Items.Add("≠")
                            ddlFREDFilterOption2.Items.Add("<")
                            ddlFREDFilterOption2.Items.Add("<=")
                            ddlFREDFilterOption2.Items.Add(">")
                            ddlFREDFilterOption2.Items.Add(">=")
                            ddlFREDFilterOption2.Items.Add("like")
                            ddlFREDFilterOption2.Items.Add("contains")
                            ddlFREDFilterOption2.Items.Add("not like")
                            ddlFREDFilterOption2.Items.Add("does not contain")
                            ddlFREDFilterOption2.Items.Add("between")
                            ddlFREDFilterOption2.Items.Add("not between")
                            ddlFREDFilterOption2.Items.Add("NULL")
                            ddlFREDFilterOption2.Items.Add("NOT NULL")
                        End If
                    End While
                    rd.Close()
                End Using


                pnltxtFREDFilter2.Visible = False
                pnlnumFREDFilter2.Visible = False
                pnldtpFREDFilter2.Visible = False
                lblFREDFilter2.Visible = False
                lblFREDFilter2b.Visible = False

                Select Case dr("Filter2Op").ToString
                    Case "between"
                        ddlFREDFilterOption2.SelectedValue = "between"
                        pnlnumFREDFilter2.Visible = True
                    Case "not between"
                        ddlFREDFilterOption2.SelectedValue = "not between"
                        pnlnumFREDFilter2.Visible = True
                    Case "DATE between"
                        ddlFREDFilterOption2.SelectedValue = "DATE between"
                        pnldtpFREDFilter2.Visible = True
                    Case "DATE not between"
                        ddlFREDFilterOption2.SelectedValue = "DATE not between"
                        pnldtpFREDFilter2.Visible = True
                    Case "contains"
                        ddlFREDFilterOption2.SelectedValue = "contains"
                        lblFREDFilter2.Visible = True
                        lblFREDFilter2b.Visible = True
                        pnltxtFREDFilter2.Visible = True
                    Case "does not contain"
                        ddlFREDFilterOption2.SelectedValue = "does not contain"
                        lblFREDFilter2.Visible = True
                        lblFREDFilter2b.Visible = True
                        pnltxtFREDFilter2.Visible = True
                    Case "NULL"
                        ddlFREDFilterOption2.SelectedValue = "NULL"
                    Case "NOT NULL"
                        ddlFREDFilterOption2.SelectedValue = "NOT NULL"
                    Case ">="
                        ddlFREDFilterOption2.SelectedValue = ">="
                        pnltxtFREDFilter2.Visible = True
                    Case "<="
                        ddlFREDFilterOption2.SelectedValue = "<="
                        pnltxtFREDFilter2.Visible = True
                    Case "="
                        ddlFREDFilterOption2.SelectedValue = "="
                        pnltxtFREDFilter2.Visible = True
                    Case "<"
                        ddlFREDFilterOption2.SelectedValue = "<"
                        pnltxtFREDFilter2.Visible = True
                    Case ">"
                        ddlFREDFilterOption2.SelectedValue = ">"
                        pnltxtFREDFilter2.Visible = True
                    Case "like"
                        ddlFREDFilterOption2.SelectedValue = "like"
                        pnltxtFREDFilter2.Visible = True
                    Case "not like"
                        ddlFREDFilterOption2.SelectedValue = "not like"
                        pnltxtFREDFilter2.Visible = True
                    Case Else
                        ddlFREDFilterOption2.SelectedValue = "≠"
                        pnltxtFREDFilter2.Visible = True
                End Select
            End If
            If IsDBNull(dr("Filter3ColumnName")) Then
            ElseIf dr("Filter3ColumnName") = " " Then
            Else
                ddlFREDFilter3.Items.FindByValue(dr("Filter3ColumnName")).Selected = True

                lblFREEFilter3.Text = "Filter #3 - " & rblFREDFilter3.SelectedItem.Text & " (" & ddlFREDFilter3.SelectedValue & ")"
                upFREEFILTER3.Update()

                Dim DTSQL As String = "select Top 1 DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter3.SelectedValue.ToString & _
            "  and Column_Alias = '" & dr("Filter3ColumnName") & "' "

                ddlFREDFilterOption3.Items.Clear()
                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If

                    cmd = New SqlCommand(DTSQL, conn)
                    cmd.CommandTimeout = 86400

                    rd = cmd.ExecuteReader
                    While rd.Read
                        If IsDBNull(rd.Item("DataType")) Then
                        ElseIf InStr(rd.Item("DataType"), "date") > 0 Or InStr(rd.Item("DataType"), "time") > 0 Then
                            ddlFREDFilterOption3.Items.Add("=")
                            ddlFREDFilterOption3.Items.Add("<")
                            ddlFREDFilterOption3.Items.Add("<=")
                            ddlFREDFilterOption3.Items.Add(">")
                            ddlFREDFilterOption3.Items.Add(">=")
                            ddlFREDFilterOption3.Items.Add("like")
                            ddlFREDFilterOption3.Items.Add("contains")
                            ddlFREDFilterOption3.Items.Add("not like")
                            ddlFREDFilterOption3.Items.Add("does not contain")
                            ddlFREDFilterOption3.Items.Add("DATE between")
                            ddlFREDFilterOption3.Items.Add("DATE not between")
                            ddlFREDFilterOption3.Items.Add("NULL")
                            ddlFREDFilterOption3.Items.Add("NOT NULL")
                        Else
                            ddlFREDFilterOption3.Items.Add("=")
                            ddlFREDFilterOption3.Items.Add("≠")
                            ddlFREDFilterOption3.Items.Add("<")
                            ddlFREDFilterOption3.Items.Add("<=")
                            ddlFREDFilterOption3.Items.Add(">")
                            ddlFREDFilterOption3.Items.Add(">=")
                            ddlFREDFilterOption3.Items.Add("like")
                            ddlFREDFilterOption3.Items.Add("contains")
                            ddlFREDFilterOption3.Items.Add("not like")
                            ddlFREDFilterOption3.Items.Add("does not contain")
                            ddlFREDFilterOption3.Items.Add("between")
                            ddlFREDFilterOption3.Items.Add("not between")
                            ddlFREDFilterOption3.Items.Add("NULL")
                            ddlFREDFilterOption3.Items.Add("NOT NULL")
                        End If
                    End While
                    rd.Close()
                End Using

                pnltxtFREDFilter3.Visible = False
                pnlnumFREDFilter3.Visible = False
                pnldtpFREDFilter3.Visible = False
                lblFREDFilter3.Visible = False
                lblFREDFilter3b.Visible = False

                Select Case dr("Filter3Op").ToString
                    Case "between"
                        ddlFREDFilterOption3.SelectedValue = "between"
                        pnlnumFREDFilter3.Visible = True
                    Case "not between"
                        ddlFREDFilterOption3.SelectedValue = "not between"
                        pnlnumFREDFilter3.Visible = True
                    Case "DATE between"
                        ddlFREDFilterOption3.SelectedValue = "DATE between"
                        pnldtpFREDFilter3.Visible = True
                    Case "DATE not between"
                        ddlFREDFilterOption3.SelectedValue = "DATE not between"
                        pnldtpFREDFilter3.Visible = True
                    Case "contains"
                        ddlFREDFilterOption3.SelectedValue = "contains"
                        lblFREDFilter3.Visible = True
                        lblFREDFilter3b.Visible = True
                        pnltxtFREDFilter3.Visible = True
                    Case "does not contain"
                        ddlFREDFilterOption3.SelectedValue = "does not contain"
                        lblFREDFilter3.Visible = True
                        lblFREDFilter3b.Visible = True
                        pnltxtFREDFilter3.Visible = True
                    Case "NULL"
                        ddlFREDFilterOption3.SelectedValue = "NULL"
                    Case "NOT NULL"
                        ddlFREDFilterOption3.SelectedValue = "NOT NULL"
                    Case ">="
                        ddlFREDFilterOption3.SelectedValue = ">="
                        pnltxtFREDFilter3.Visible = True
                    Case "<="
                        ddlFREDFilterOption3.SelectedValue = "<="
                        pnltxtFREDFilter3.Visible = True
                    Case "="
                        ddlFREDFilterOption3.SelectedValue = "="
                        pnltxtFREDFilter3.Visible = True
                    Case "<"
                        ddlFREDFilterOption3.SelectedValue = "<"
                        pnltxtFREDFilter3.Visible = True
                    Case ">"
                        ddlFREDFilterOption3.SelectedValue = ">"
                        pnltxtFREDFilter3.Visible = True
                    Case "like"
                        ddlFREDFilterOption3.SelectedValue = "like"
                        pnltxtFREDFilter3.Visible = True
                    Case "not like"
                        ddlFREDFilterOption3.SelectedValue = "not like"
                        pnltxtFREDFilter3.Visible = True
                    Case Else
                        ddlFREDFilterOption3.SelectedValue = "≠"
                        pnltxtFREDFilter3.Visible = True
                End Select
            End If
            If IsDBNull(dr("Filter4ColumnName")) Then
            ElseIf dr("Filter4ColumnName") = " " Then
            Else
                ddlFREDFilter4.Items.FindByValue(dr("Filter4ColumnName")).Selected = True

                lblFREEFilter4.Text = "Filter #4 - " & rblFREDFilter4.SelectedItem.Text & " (" & ddlFREDFilter4.SelectedValue & ")"
                upFREEFILTER4.Update()

                Dim DTSQL As String = "select Top 1 DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter4.SelectedValue.ToString & _
            "  and Column_Alias = '" & dr("Filter4ColumnName") & "' "

                ddlFREDFilterOption4.Items.Clear()
                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If

                    cmd = New SqlCommand(DTSQL, conn)
                    cmd.CommandTimeout = 86400

                    rd = cmd.ExecuteReader
                    While rd.Read
                        If IsDBNull(rd.Item("DataType")) Then
                        ElseIf InStr(rd.Item("DataType"), "date") > 0 Or InStr(rd.Item("DataType"), "time") > 0 Then
                            ddlFREDFilterOption4.Items.Add("=")
                            ddlFREDFilterOption4.Items.Add("<")
                            ddlFREDFilterOption4.Items.Add("<=")
                            ddlFREDFilterOption4.Items.Add(">")
                            ddlFREDFilterOption4.Items.Add(">=")
                            ddlFREDFilterOption4.Items.Add("like")
                            ddlFREDFilterOption4.Items.Add("contains")
                            ddlFREDFilterOption4.Items.Add("not like")
                            ddlFREDFilterOption4.Items.Add("does not contain")
                            ddlFREDFilterOption4.Items.Add("DATE between")
                            ddlFREDFilterOption4.Items.Add("DATE not between")
                            ddlFREDFilterOption4.Items.Add("NULL")
                            ddlFREDFilterOption4.Items.Add("NOT NULL")
                        Else
                            ddlFREDFilterOption4.Items.Add("=")
                            ddlFREDFilterOption4.Items.Add("≠")
                            ddlFREDFilterOption4.Items.Add("<")
                            ddlFREDFilterOption4.Items.Add("<=")
                            ddlFREDFilterOption4.Items.Add(">")
                            ddlFREDFilterOption4.Items.Add(">=")
                            ddlFREDFilterOption4.Items.Add("like")
                            ddlFREDFilterOption4.Items.Add("contains")
                            ddlFREDFilterOption4.Items.Add("not like")
                            ddlFREDFilterOption4.Items.Add("does not contain")
                            ddlFREDFilterOption4.Items.Add("between")
                            ddlFREDFilterOption4.Items.Add("not between")
                            ddlFREDFilterOption4.Items.Add("NULL")
                            ddlFREDFilterOption4.Items.Add("NOT NULL")
                        End If
                    End While
                    rd.Close()
                End Using

                pnltxtFREDFilter4.Visible = False
                pnlnumFREDFilter4.Visible = False
                pnldtpFREDFilter4.Visible = False
                lblFREDFilter4.Visible = False
                lblFREDFilter4b.Visible = False

                Select Case dr("Filter4Op").ToString
                    Case "between"
                        ddlFREDFilterOption4.SelectedValue = "between"
                        pnlnumFREDFilter4.Visible = True
                    Case "not between"
                        ddlFREDFilterOption4.SelectedValue = "not between"
                        pnlnumFREDFilter4.Visible = True
                    Case "DATE between"
                        ddlFREDFilterOption4.SelectedValue = "DATE between"
                        pnldtpFREDFilter4.Visible = True
                    Case "DATE not between"
                        ddlFREDFilterOption4.SelectedValue = "DATE not between"
                        pnldtpFREDFilter4.Visible = True
                    Case "contains"
                        ddlFREDFilterOption4.SelectedValue = "contains"
                        lblFREDFilter4.Visible = True
                        lblFREDFilter4b.Visible = True
                        pnltxtFREDFilter4.Visible = True
                    Case "does not contain"
                        ddlFREDFilterOption4.SelectedValue = "does not contain"
                        lblFREDFilter4.Visible = True
                        lblFREDFilter4b.Visible = True
                        pnltxtFREDFilter4.Visible = True
                    Case "NULL"
                        ddlFREDFilterOption4.SelectedValue = "NULL"
                    Case "NOT NULL"
                        ddlFREDFilterOption4.SelectedValue = "NOT NULL"
                    Case ">="
                        ddlFREDFilterOption4.SelectedValue = ">="
                        pnltxtFREDFilter4.Visible = True
                    Case "<="
                        ddlFREDFilterOption4.SelectedValue = "<="
                        pnltxtFREDFilter4.Visible = True
                    Case "="
                        ddlFREDFilterOption4.SelectedValue = "="
                        pnltxtFREDFilter4.Visible = True
                    Case "<"
                        ddlFREDFilterOption4.SelectedValue = "<"
                        pnltxtFREDFilter4.Visible = True
                    Case ">"
                        ddlFREDFilterOption4.SelectedValue = ">"
                        pnltxtFREDFilter4.Visible = True
                    Case "like"
                        ddlFREDFilterOption4.SelectedValue = "like"
                        pnltxtFREDFilter4.Visible = True
                    Case "not like"
                        ddlFREDFilterOption4.SelectedValue = "not like"
                        pnltxtFREDFilter4.Visible = True
                    Case Else
                        ddlFREDFilterOption4.SelectedValue = "≠"
                        pnltxtFREDFilter4.Visible = True
                End Select
            End If
            If IsDBNull(dr("Filter5ColumnName")) Then
            ElseIf dr("Filter5ColumnName") = " " Then
            Else
                ddlFREDFilter5.Items.FindByValue(dr("Filter5ColumnName")).Selected = True

                lblFREEFilter5.Text = "Filter #5 - " & rblFREDFilter5.SelectedItem.Text & " (" & ddlFREDFilter5.SelectedValue & ")"
                upFREEFILTER5.Update()

                Dim DTSQL As String = "select Top 1 DataType  from WebFD.FRED.vw_AvailableData where TABLE_ID = " & rblFREDFilter5.SelectedValue.ToString & _
            "  and Column_Alias = '" & dr("Filter5ColumnName") & "' "

                ddlFREDFilterOption5.Items.Clear()
                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If

                    cmd = New SqlCommand(DTSQL, conn)
                    cmd.CommandTimeout = 86400

                    rd = cmd.ExecuteReader
                    While rd.Read
                        If IsDBNull(rd.Item("DataType")) Then
                        ElseIf InStr(rd.Item("DataType"), "date") > 0 Or InStr(rd.Item("DataType"), "time") > 0 Then
                            ddlFREDFilterOption5.Items.Add("=")
                            ddlFREDFilterOption5.Items.Add("<")
                            ddlFREDFilterOption5.Items.Add("<=")
                            ddlFREDFilterOption5.Items.Add(">")
                            ddlFREDFilterOption5.Items.Add(">=")
                            ddlFREDFilterOption5.Items.Add("like")
                            ddlFREDFilterOption5.Items.Add("contains")
                            ddlFREDFilterOption5.Items.Add("not like")
                            ddlFREDFilterOption5.Items.Add("does not contain")
                            ddlFREDFilterOption5.Items.Add("DATE between")
                            ddlFREDFilterOption5.Items.Add("DATE not between")
                            ddlFREDFilterOption5.Items.Add("NULL")
                            ddlFREDFilterOption5.Items.Add("NOT NULL")
                        Else
                            ddlFREDFilterOption5.Items.Add("=")
                            ddlFREDFilterOption5.Items.Add("≠")
                            ddlFREDFilterOption5.Items.Add("<")
                            ddlFREDFilterOption5.Items.Add("<=")
                            ddlFREDFilterOption5.Items.Add(">")
                            ddlFREDFilterOption5.Items.Add(">=")
                            ddlFREDFilterOption5.Items.Add("like")
                            ddlFREDFilterOption5.Items.Add("contains")
                            ddlFREDFilterOption5.Items.Add("not like")
                            ddlFREDFilterOption5.Items.Add("does not contain")
                            ddlFREDFilterOption5.Items.Add("between")
                            ddlFREDFilterOption5.Items.Add("not between")
                            ddlFREDFilterOption5.Items.Add("NULL")
                            ddlFREDFilterOption5.Items.Add("NOT NULL")
                        End If
                    End While
                    rd.Close()
                End Using

                pnltxtFREDFilter5.Visible = False
                pnlnumFREDFilter5.Visible = False
                pnldtpFREDFilter5.Visible = False
                lblFREDFilter5.Visible = False
                lblFREDFilter5b.Visible = False

                Select Case dr("Filter5Op").ToString
                    Case "between"
                        ddlFREDFilterOption5.SelectedValue = "between"
                        pnlnumFREDFilter5.Visible = True
                    Case "not between"
                        ddlFREDFilterOption5.SelectedValue = "not between"
                        pnlnumFREDFilter5.Visible = True
                    Case "DATE between"
                        ddlFREDFilterOption5.SelectedValue = "DATE between"
                        pnldtpFREDFilter5.Visible = True
                    Case "DATE not between"
                        ddlFREDFilterOption5.SelectedValue = "DATE not between"
                        pnldtpFREDFilter5.Visible = True
                    Case "contains"
                        ddlFREDFilterOption5.SelectedValue = "contains"
                        lblFREDFilter5.Visible = True
                        lblFREDFilter5b.Visible = True
                        pnltxtFREDFilter5.Visible = True
                    Case "does not contain"
                        ddlFREDFilterOption5.SelectedValue = "does not contain"
                        lblFREDFilter5.Visible = True
                        lblFREDFilter5b.Visible = True
                        pnltxtFREDFilter5.Visible = True
                    Case "NULL"
                        ddlFREDFilterOption5.SelectedValue = "NULL"
                    Case "NOT NULL"
                        ddlFREDFilterOption5.SelectedValue = "NOT NULL"
                    Case ">="
                        ddlFREDFilterOption5.SelectedValue = ">="
                        pnltxtFREDFilter5.Visible = True
                    Case "<="
                        ddlFREDFilterOption5.SelectedValue = "<="
                        pnltxtFREDFilter5.Visible = True
                    Case "="
                        ddlFREDFilterOption5.SelectedValue = "="
                        pnltxtFREDFilter5.Visible = True
                    Case "<"
                        ddlFREDFilterOption5.SelectedValue = "<"
                        pnltxtFREDFilter5.Visible = True
                    Case ">"
                        ddlFREDFilterOption5.SelectedValue = ">"
                        pnltxtFREDFilter5.Visible = True
                    Case "like"
                        ddlFREDFilterOption5.SelectedValue = "like"
                        pnltxtFREDFilter5.Visible = True
                    Case "not like"
                        ddlFREDFilterOption5.SelectedValue = "not like"
                        pnltxtFREDFilter5.Visible = True
                    Case Else
                        ddlFREDFilterOption5.SelectedValue = "≠"
                        pnltxtFREDFilter5.Visible = True
                End Select
            End If

            numFREDFilter5Start.Text = ""
            numFREDFilter5End.Text = ""
            dtpFREDFilter5StartDate.Text = ""
            dtpFREDFilter5EndDate.Text = ""
            txtFREDFilter5.Text = ""
            numFREDFilter4Start.Text = ""
            numFREDFilter4End.Text = ""
            dtpFREDFilter4StartDate.Text = ""
            dtpFREDFilter4EndDate.Text = ""
            txtFREDFilter4.Text = ""
            numFREDFilter3Start.Text = ""
            numFREDFilter3End.Text = ""
            dtpFREDFilter3StartDate.Text = ""
            dtpFREDFilter3EndDate.Text = ""
            txtFREDFilter3.Text = ""
            numFREDFilter2Start.Text = ""
            numFREDFilter2End.Text = ""
            dtpFREDFilter2StartDate.Text = ""
            dtpFREDFilter2EndDate.Text = ""
            txtFREDFilter2.Text = ""
            numFREDFilter1Start.Text = ""
            numFREDFilter1End.Text = ""
            dtpFREDFilter1StartDate.Text = ""
            dtpFREDFilter1EndDate.Text = ""
            txtFREDFilter1.Text = ""

            Select Case dr("Filter1Op").ToString
                Case "between"
                    numFREDFilter1Start.Text = dr("Filter1Txt1").ToString
                    numFREDFilter1End.Text = dr("Filter1Txt2").ToString
                Case "not between"
                    numFREDFilter1Start.Text = dr("Filter1Txt1").ToString
                    numFREDFilter1End.Text = dr("Filter1Txt2").ToString
                Case "DATE between"
                    dtpFREDFilter1StartDate.Text = dr("Filter1Txt1").ToString
                    dtpFREDFilter1EndDate.Text = dr("Filter1Txt2").ToString
                Case "DATE not between"
                    dtpFREDFilter1StartDate.Text = dr("Filter1Txt1").ToString
                    dtpFREDFilter1EndDate.Text = dr("Filter1Txt2").ToString
                Case "contains"
                    txtFREDFilter1.Text = dr("Filter1Txt1").ToString
                Case "does not contain"
                    txtFREDFilter1.Text = dr("Filter1Txt1").ToString
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtFREDFilter1.Text = dr("Filter1Txt1").ToString
            End Select

            Select Case dr("Filter2Op").ToString
                Case "between"
                    numFREDFilter2Start.Text = dr("Filter2Txt1").ToString
                    numFREDFilter2End.Text = dr("Filter2Txt2").ToString
                Case "not between"
                    numFREDFilter2Start.Text = dr("Filter2Txt1").ToString
                    numFREDFilter2End.Text = dr("Filter2Txt2").ToString
                Case "DATE between"
                    dtpFREDFilter2StartDate.Text = dr("Filter2Txt1").ToString
                    dtpFREDFilter2EndDate.Text = dr("Filter2Txt2").ToString
                Case "DATE not between"
                    dtpFREDFilter2StartDate.Text = dr("Filter2Txt1").ToString
                    dtpFREDFilter2EndDate.Text = dr("Filter2Txt2").ToString
                Case "contains"
                    txtFREDFilter2.Text = dr("Filter2Txt1").ToString
                Case "does not contain"
                    txtFREDFilter2.Text = dr("Filter2Txt1").ToString
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtFREDFilter2.Text = dr("Filter2Txt1").ToString
            End Select

            Select Case dr("Filter3Op").ToString
                Case "between"
                    numFREDFilter3Start.Text = dr("Filter3Txt1").ToString
                    numFREDFilter3End.Text = dr("Filter3Txt2").ToString
                Case "not between"
                    numFREDFilter3Start.Text = dr("Filter3Txt1").ToString
                    numFREDFilter3End.Text = dr("Filter3Txt2").ToString
                Case "DATE between"
                    dtpFREDFilter3StartDate.Text = dr("Filter3Txt1").ToString
                    dtpFREDFilter3EndDate.Text = dr("Filter3Txt2").ToString
                Case "DATE not between"
                    dtpFREDFilter3StartDate.Text = dr("Filter3Txt1").ToString
                    dtpFREDFilter3EndDate.Text = dr("Filter3Txt2").ToString
                Case "contains"
                    txtFREDFilter3.Text = dr("Filter3Txt1").ToString
                Case "does not contain"
                    txtFREDFilter3.Text = dr("Filter3Txt1").ToString
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtFREDFilter3.Text = dr("Filter3Txt1").ToString
            End Select

            Select Case dr("Filter4Op").ToString
                Case "between"
                    numFREDFilter4Start.Text = dr("Filter4Txt1").ToString
                    numFREDFilter4End.Text = dr("Filter4Txt2").ToString
                Case "not between"
                    numFREDFilter4Start.Text = dr("Filter4Txt1").ToString
                    numFREDFilter4End.Text = dr("Filter4Txt2").ToString
                Case "DATE between"
                    dtpFREDFilter4StartDate.Text = dr("Filter4Txt1").ToString
                    dtpFREDFilter4EndDate.Text = dr("Filter4Txt2").ToString
                Case "DATE not between"
                    dtpFREDFilter4StartDate.Text = dr("Filter4Txt1").ToString
                    dtpFREDFilter4EndDate.Text = dr("Filter4Txt2").ToString
                Case "contains"
                    txtFREDFilter4.Text = dr("Filter4Txt1").ToString
                Case "does not contain"
                    txtFREDFilter4.Text = dr("Filter4Txt1").ToString
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtFREDFilter4.Text = dr("Filter4Txt1").ToString
            End Select

            Select Case dr("Filter5Op").ToString
                Case "between"
                    numFREDFilter5Start.Text = dr("Filter5Txt1").ToString
                    numFREDFilter5End.Text = dr("Filter5Txt2").ToString
                Case "not between"
                    numFREDFilter5Start.Text = dr("Filter5Txt1").ToString
                    numFREDFilter5End.Text = dr("Filter5Txt2").ToString
                Case "DATE between"
                    dtpFREDFilter5StartDate.Text = dr("Filter5Txt1").ToString
                    dtpFREDFilter5EndDate.Text = dr("Filter5Txt2").ToString
                Case "DATE not between"
                    dtpFREDFilter5StartDate.Text = dr("Filter5Txt1").ToString
                    dtpFREDFilter5EndDate.Text = dr("Filter5Txt2").ToString
                Case "contains"
                    txtFREDFilter5.Text = dr("Filter5Txt1").ToString
                Case "does not contain"
                    txtFREDFilter5.Text = dr("Filter5Txt1").ToString
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtFREDFilter5.Text = dr("Filter5Txt1").ToString
            End Select



            Dim indexcount As Integer = 0

            For Each checkeditem As ListItem In cblFREDSelectTrans.Items
                If InStr(tbltranslist, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0 Then
                    cblFREDSelectTrans.Items(indexcount).Selected = True
                    tbltranslist = tbltranslist.Replace(Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5), " ")
                Else
                    cblFREDSelectTrans.Items(indexcount).Selected = False

                End If
                indexcount += 1
            Next

            indexcount = 0

            For Each checkeditem As ListItem In cblFREDSelect1.Items
                If InStr(tbl1list, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0 Then
                    cblFREDSelect1.Items(indexcount).Selected = True
                    tbl1list = tbl1list.Replace(Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5), " ")
                Else
                    cblFREDSelect1.Items(indexcount).Selected = False

                End If
                indexcount += 1
            Next

            indexcount = 0

            For Each checkeditem As ListItem In cblFREDSelect2.Items
                If InStr(tbl2list, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0 Then
                    cblFREDSelect2.Items(indexcount).Selected = True
                    tbl2list = tbl2list.Replace(Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5), " ")
                Else
                    cblFREDSelect2.Items(indexcount).Selected = False

                End If
                indexcount += 1
            Next

            indexcount = 0

            For Each checkeditem As ListItem In cblFREDSelect3.Items
                If InStr(tbl3list, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0 Then
                    cblFREDSelect3.Items(indexcount).Selected = True
                    tbl3list = tbl3list.Replace(Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5), " ")
                Else
                    cblFREDSelect3.Items(indexcount).Selected = False

                End If
                indexcount += 1
            Next

            indexcount = 0

            For Each checkeditem As ListItem In cblFREDSelect4.Items
                If InStr(tbl4list, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0 Then
                    cblFREDSelect4.Items(indexcount).Selected = True
                    tbl4list = tbl4list.Replace(Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5), " ")
                Else
                    cblFREDSelect4.Items(indexcount).Selected = False

                End If
                indexcount += 1
            Next

            Dim fox As Integer = 0

            While fox < favoriteinfo.Tables(0).Rows.Count
                If fox = newgvFavorites.SelectedIndex Then
                    newgvFavorites.Rows(fox).BackColor = System.Drawing.ColorTranslator.FromHtml("#D3DEEF")
                ElseIf fox Mod 2 = 0 Then
                    newgvFavorites.Rows(fox).BackColor = System.Drawing.ColorTranslator.FromHtml("#FFE885")
                Else
                    newgvFavorites.Rows(fox).BackColor = System.Drawing.Color.White
                End If
                fox += 1
            End While



        Catch ex As Exception
            For Each rw As GridViewRow In newgvFavorites.Rows
                If rw.RowIndex = newgvFavorites.SelectedIndex Then
                    rw.BackColor = System.Drawing.ColorTranslator.FromHtml("#D3DEEF")
                ElseIf rw.RowIndex Mod 2 = 0 Then
                    rw.BackColor = System.Drawing.ColorTranslator.FromHtml("#FFE885")
                Else
                    rw.BackColor = System.Drawing.Color.White
                End If
            Next
            ExplanationLabel2.Text = "This favorite is outdated -- one or more columns is no longer available"
            ModalPopupExtender2.Show()

            Dim newrb1 As Integer = 0
            Dim newrb2 As Integer = 0
            Dim newrb3 As Integer = 0
            Dim newrb4 As Integer = 0
            Dim newrb5 As Integer = 0

            For gr1 As Integer = 0 To rblFREDFilter1.Items.Count - 1
                If rblFREDFilter1.Items.Item(gr1).Value = rblFREDFilter1.SelectedValue Then
                    newrb1 = rblFREDFilter1.SelectedIndex
                End If
            Next
            For gr2 As Integer = 0 To rblFREDFilter2.Items.Count - 1
                If rblFREDFilter2.Items.Item(gr2).Value = rblFREDFilter2.SelectedValue Then
                    newrb2 = rblFREDFilter2.SelectedIndex
                End If
            Next
            For gr3 As Integer = 0 To rblFREDFilter3.Items.Count - 1
                If rblFREDFilter3.Items.Item(gr3).Value = rblFREDFilter3.SelectedValue Then
                    newrb3 = rblFREDFilter3.SelectedIndex
                End If
            Next
            For gr4 As Integer = 0 To rblFREDFilter4.Items.Count - 1
                If rblFREDFilter4.Items.Item(gr4).Value = rblFREDFilter4.SelectedValue Then
                    newrb4 = rblFREDFilter4.SelectedIndex
                End If
            Next
            For gr5 As Integer = 0 To rblFREDFilter5.Items.Count - 1
                If rblFREDFilter5.Items.Item(gr5).Value = rblFREDFilter5.SelectedValue Then
                    newrb5 = rblFREDFilter5.SelectedIndex
                End If
            Next

            rblFREDFilter1.SelectedIndex = newrb1
            rblFREDFilter2.SelectedIndex = newrb2
            rblFREDFilter1.SelectedIndex = newrb3
            rblFREDFilter4.SelectedIndex = newrb4
            rblFREDFilter5.SelectedIndex = newrb5

            Dim newddl1 As Integer = -1
            Dim newddl2 As Integer = -1
            Dim newddl3 As Integer = -1
            Dim newddl4 As Integer = -1
            Dim newddl5 As Integer = -1

            For gr1 As Integer = 0 To ddlFREDFilter1.Items.Count - 1
                If ddlFREDFilter1.Items.Item(gr1).Value = ddlFREDFilter1.SelectedValue Then
                    newddl1 = ddlFREDFilter1.SelectedIndex
                End If
            Next
            For gr2 As Integer = 0 To ddlFREDFilter2.Items.Count - 1
                If ddlFREDFilter2.Items.Item(gr2).Value = ddlFREDFilter2.SelectedValue Then
                    newddl2 = ddlFREDFilter2.SelectedIndex
                End If
            Next
            For gr3 As Integer = 0 To ddlFREDFilter3.Items.Count - 1
                If ddlFREDFilter3.Items.Item(gr3).Value = ddlFREDFilter3.SelectedValue Then
                    newddl3 = ddlFREDFilter3.SelectedIndex
                End If
            Next
            For gr4 As Integer = 0 To ddlFREDFilter4.Items.Count - 1
                If ddlFREDFilter4.Items.Item(gr4).Value = ddlFREDFilter4.SelectedValue Then
                    newddl4 = ddlFREDFilter4.SelectedIndex
                End If
            Next
            For gr5 As Integer = 0 To ddlFREDFilter5.Items.Count - 1
                If ddlFREDFilter5.Items.Item(gr5).Value = ddlFREDFilter5.SelectedValue Then
                    newddl5 = ddlFREDFilter5.SelectedIndex
                End If
            Next

            ddlFREDFilter1.SelectedIndex = newddl1
            ddlFREDFilter2.SelectedIndex = newddl2
            ddlFREDFilter3.SelectedIndex = newddl3
            ddlFREDFilter4.SelectedIndex = newddl4
            ddlFREDFilter5.SelectedIndex = newddl5

        Finally

        End Try

        Try
            lblFavoriteNameActive2.Text = "&nbsp;Currently Selected:"
            lblFavoriteNameActive.Text = "&nbsp;&nbsp;&nbsp;" & doctor("FavoriteName").ToString & "&nbsp;&nbsp;&nbsp;"
            lblFavoriteNameActive.Visible = True
            lblFavoriteNameActive2.Visible = True


            If rblDataType.SelectedValue = 0 Then
                acrFREDSelect.SelectedIndex = 0
            Else
                acrFREDSelect.SelectedIndex = -1
                acrFREDSelectTrans.SelectedIndex = 0
            End If

            If rblDataType.SelectedValue = 0 Then
                ddlFREDTables.Visible = False
            Else
                ddlFREDTables.Visible = True
            End If
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try



    End Sub

    '    Private Sub btnViewFavorites_Click(sender As Object, e As System.EventArgs) Handles btnViewFavorites.Click
    '        gvFREDData.Enabled = False
    '        newgvFavorites.Visible = True
    '        btnUpdateFavorite.Visible = True
    '        btnDeleteFavorite.Visible = True
    '        btnCloseFavorites.Visible = True




    '        Dim getfavorite As String
    '        Dim favoriteinfo As New DataSet


    '        '        getfavorite = "SELECT ff.[ID],[Userlogin],[FavoriteName],[IsEncounter],[Table1ID],[Table1Columns],[Table2ID],[Table2Columns],[Table3ID]," & _
    '        '"[Table3Columns],[Table4ID],[Table4Columns],[Filter1TID],[Filter1DDColumnID]	  ,tone.COLUMN_NAME as [Filter 1 Column Name],[Filter1Op] as [Filter 1 Operator]," & _
    '        '"[Filter1Txt1],[Filter1Txt2],[Filter2TID],[Filter2DDColumnID]	  ,ttwo.COLUMN_NAME as [Filter 2 Column Name],[Filter2Op] as [Filter 2 Operator]," & _
    '        '"[Filter2Txt1],[Filter2Txt2],[Filter3TID],[Filter3DDColumnID]	  ,tthree.COLUMN_NAME as [Filter 3 Column Name],[Filter3Op] as [Filter 3 Operator]," & _
    '        '"[Filter3Txt1],[Filter3Txt2],[Filter4TID],[Filter4DDColumnID],tfour.COLUMN_NAME as [Filter 4 Column Name],[Filter4Op] as [Filter 4 Operator],[Filter4Txt1]," & _
    '        '" [Filter4Txt2],[Filter5TID],[Filter5DDColumnID]	  ,tfive.COLUMN_NAME as [Filter 5 Column Name],[Filter5Op] as [Filter 5 Operator],[Filter5Txt1],[Filter5Txt2]" & _
    '        '"  FROM [WebFD].[FRED].[FredFavorites] ff" & _
    '        '"    left join WebFD.FRED.AvailableColumns tone on tone.TABLE_ID = [Filter1TID] and tone.ID = [Filter1DDColumnID] " & _
    '        '"     left join WebFD.FRED.AvailableColumns ttwo on ttwo.TABLE_ID = [Filter2TID] and ttwo.ID = [Filter1DDColumnID]  " & _
    '        '"         left join WebFD.FRED.AvailableColumns tthree on tthree.TABLE_ID = [Filter3TID] and tthree.ID = [Filter1DDColumnID] " & _
    '        '"             left join WebFD.FRED.AvailableColumns tfour on tfour.TABLE_ID = [Filter4TID] and tfour.ID = [Filter1DDColumnID] " & _
    '        '"                left join WebFD.FRED.AvailableColumns tfive on tfive.TABLE_ID = [Filter5TID] and tfive.ID = [Filter1DDColumnID] " & _
    '        '" where Userlogin = '" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "' order by ff.ID asc"

    '        getfavorite = "SELECT [FavoriteName], [LoadDate] " & _
    '"  FROM [WebFD].[FRED].[FredFavorites] ff" & _
    '" where Userlogin = '" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "' order by FavoriteName asc"

    '        Try

    '            Dim da As SqlDataAdapter

    '            favoriteinfo.Clear()
    '            Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                da = New SqlDataAdapter(getfavorite, conn2)
    '                da.Fill(favoriteinfo, "DEMO")
    '                newgvFavorites.DataSource = favoriteinfo
    '                newgvFavorites.DataMember = "DEMO"
    '                newgvFavorites.DataBind()
    '                newgvFavorites.SelectedIndex = 0
    '            End Using


    '        Catch ex As Exception

    '        End Try




    '        'Dim columnindex As Integer = 0
    '        'While columnindex < 5
    '        '    If newgvFavorites.Columns(columnindex).HeaderText.Contains("Column") Then
    '        '        newgvFavorites.Columns(columnindex).Visible = False
    '        '        newgvFavorites.Columns(columnindex).ShowHeader = False
    '        '    End If
    '        '    columnindex = columnindex + 1
    '        'End While
    '        'columnindex = 0


    '        '    For Each column As DataControlField In newgvFavorites.Columns
    '        '        If column.HeaderText.Contains("Name") Then
    '        '        Else
    '        '        newgvFavorites.Columns(columnindex).Visible = False
    '        '        newgvFavorites.Columns(columnindex).ShowHeader = False
    '        '        End If
    '        '    columnindex += 1
    '        '    Next


    '    End Sub

    Private Sub newgvFavorites_RowDataBound(sender As Object, e As System.Web.UI.WebControls.GridViewRowEventArgs) Handles newgvFavorites.RowDataBound

        'Try
        '    If e.Row.RowType = DataControlRowType.DataRow Then
        '        Dim drv As DataRowView = DirectCast(e.Row.DataItem, DataRowView)
        '        For i As Integer = 0 To drv.DataView.Table.Columns.Count - 1
        '            'If i Mod 2 = 0 Then
        '            If drv.DataView.Table.Columns(i).ColumnName.Contains("Name") Then
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("Column Name") Then
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("Op") Then
        '            ElseIf drv.DataView.Table.Columns(i).ColumnName.Contains("Txt2") Then
        '            Else
        '                e.Row.Cells(i).Visible = False
        '            End If


        '        Next
        '    End If

        'Catch ex As Exception

        'End Try

        Try
            If e.Row.RowType = DataControlRowType.DataRow Then

                e.Row.Attributes.Add("onclick", Page.ClientScript.GetPostBackEventReference(sender, "Select$" & e.Row.RowIndex.ToString))

            End If
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


    End Sub



    'Private Sub btnCloseFavorites_Click(sender As Object, e As System.EventArgs) Handles btnCloseFavorites.Click

    '    newgvFavorites.Visible = False
    '    newgvFavorites.Enabled = False
    '    gvFREDData.Enabled = True
    '    btnDeleteFavorite.Visible = False
    '    btnUpdateFavorite.Visible = False
    '    btnCloseFavorites.Visible = False

    'End Sub

    Private Sub btnDeleteFavorite_Click(sender As Object, e As System.EventArgs) Handles btnDeleteFavorite.Click

        Try
            explantionlabel.Text = "You are attempting to delete one of your favorites, titled '" & doctor(2) & _
            "'.  Once deleted, it cannot be recovered.  Are you sure?"
            ModalPopupExtender1.Show()
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


    End Sub

    Private Sub OkButton_Click(sender As Object, e As System.EventArgs) Handles OkButton.Click


        Try
            ModalPopupExtender1.Hide()
            Dim deletesql As String

            deletesql = "Delete from [WebFD].[FRED].[FredFavorites] where ID = " & doctor(0)
            Using conn As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                cmd = New System.Data.SqlClient.SqlCommand(deletesql, conn)
                cmd.ExecuteNonQuery()
                ExplanationLabel2.Text = "Favorite Deleted"
            End Using
        Catch ex As Exception
            ExplanationLabel2.Text = "Error deleting Favorite"
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

        ModalPopupExtender2.Show()



    End Sub

    Private Sub btnUpdateFavorite_Click(sender As Object, e As System.EventArgs) Handles btnUpdateFavorite.Click
        Try
            If txtnewFavName.Text <> doctor("FavoriteName") Then
                ExplanationLabel2.Text = "You cannot rename a Favorite.  If you want to change the name of your favorite, " & _
                    "please create a new one with identical properties and delete the old one."
                ModalPopupExtender2.Show()
                Exit Sub
            End If

            ExplanationText3.Text = "You are attempting to update one of your favorites, titled '" & doctor(2) & _
    "'.  This will overwrite the previous settings and, once updated, the old values cannot be recovered.  Are you sure?"
            ModalPopupExtender3.Show()
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub

    Private Sub btnupdateconfirm_Click(sender As Object, e As System.EventArgs) Handles btnupdateconfirm.Click

        Try

            Dim StoreFavorite As String
            Dim selectlist1 As String = " "
            Dim selectlist2 As String = " "
            Dim selectlist3 As String = " "
            Dim selectlist4 As String = " "
            Dim selectlisttrans As String = " "

            If cblFREDSelectTrans IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelectTrans.Items
                    If (checkeditem.Selected) Then
                        selectlisttrans += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If
            If cblFREDSelect1 IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelect1.Items
                    If (checkeditem.Selected) Then
                        selectlist1 += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If
            If cblFREDSelect2 IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelect2.Items
                    If (checkeditem.Selected) Then
                        selectlist2 += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If
            If cblFREDSelect3 IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelect3.Items
                    If (checkeditem.Selected) Then
                        selectlist3 += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If
            If cblFREDSelect4 IsNot Nothing Then
                For Each checkeditem As ListItem In cblFREDSelect4.Items
                    If (checkeditem.Selected) Then
                        selectlist4 += Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " "

                    End If
                Next
            End If

            Dim txtbox1 As String = ""
            Dim txtbox1two As String = ""

            Select Case ddlFREDFilterOption1.Text
                Case "between"
                    txtbox1 = numFREDFilter1Start.Text
                    txtbox1two = numFREDFilter1End.Text
                Case "not between"
                    txtbox1 = numFREDFilter1Start.Text
                    txtbox1two = numFREDFilter1End.Text
                Case "DATE between"
                    txtbox1 = dtpFREDFilter1StartDate.Text
                    txtbox1two = dtpFREDFilter1EndDate.Text
                Case "DATE not between"
                    txtbox1 = dtpFREDFilter1StartDate.Text
                    txtbox1two = dtpFREDFilter1EndDate.Text
                Case "contains"
                    txtbox1 = txtFREDFilter1.Text
                Case "does not contain"
                    txtbox1 = txtFREDFilter1.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox1 = txtFREDFilter1.Text
            End Select

            Dim txtbox2 As String = ""
            Dim txtbox2two As String = ""

            Select Case ddlFREDFilterOption2.Text
                Case "between"
                    txtbox2 = numFREDFilter2Start.Text
                    txtbox2two = numFREDFilter2End.Text
                Case "not between"
                    txtbox2 = numFREDFilter2Start.Text
                    txtbox2two = numFREDFilter2End.Text
                Case "DATE between"
                    txtbox2 = dtpFREDFilter2StartDate.Text
                    txtbox2two = dtpFREDFilter2EndDate.Text
                Case "DATE not between"
                    txtbox2 = dtpFREDFilter2StartDate.Text
                    txtbox2two = dtpFREDFilter2EndDate.Text
                Case "contains"
                    txtbox2 = txtFREDFilter2.Text
                Case "does not contain"
                    txtbox2 = txtFREDFilter2.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox2 = txtFREDFilter2.Text
            End Select

            Dim txtbox3 As String = ""
            Dim txtbox3two As String = ""

            Select Case ddlFREDFilterOption3.Text
                Case "between"
                    txtbox3 = numFREDFilter3Start.Text
                    txtbox3two = numFREDFilter3End.Text
                Case "not between"
                    txtbox3 = numFREDFilter3Start.Text
                    txtbox3two = numFREDFilter3End.Text
                Case "DATE between"
                    txtbox3 = dtpFREDFilter3StartDate.Text
                    txtbox3two = dtpFREDFilter3EndDate.Text
                Case "DATE not between"
                    txtbox3 = dtpFREDFilter3StartDate.Text
                    txtbox3two = dtpFREDFilter3EndDate.Text
                Case "contains"
                    txtbox3 = txtFREDFilter3.Text
                Case "does not contain"
                    txtbox3 = txtFREDFilter3.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox3 = txtFREDFilter3.Text
            End Select

            Dim txtbox4 As String = ""
            Dim txtbox4two As String = ""

            Select Case ddlFREDFilterOption4.Text
                Case "between"
                    txtbox4 = numFREDFilter4Start.Text
                    txtbox4two = numFREDFilter4End.Text
                Case "not between"
                    txtbox4 = numFREDFilter4Start.Text
                    txtbox4two = numFREDFilter4End.Text
                Case "DATE between"
                    txtbox4 = dtpFREDFilter4StartDate.Text
                    txtbox4two = dtpFREDFilter4EndDate.Text
                Case "DATE not between"
                    txtbox4 = dtpFREDFilter4StartDate.Text
                    txtbox4two = dtpFREDFilter4EndDate.Text
                Case "contains"
                    txtbox4 = txtFREDFilter4.Text
                Case "does not contain"
                    txtbox4 = txtFREDFilter4.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox4 = txtFREDFilter4.Text
            End Select

            Dim txtbox5 As String = ""
            Dim txtbox5two As String = ""

            Select Case ddlFREDFilterOption5.Text
                Case "between"
                    txtbox5 = numFREDFilter5Start.Text
                    txtbox5two = numFREDFilter5End.Text
                Case "not between"
                    txtbox5 = numFREDFilter5Start.Text
                    txtbox5two = numFREDFilter5End.Text
                Case "DATE between"
                    txtbox5 = dtpFREDFilter5StartDate.Text
                    txtbox5two = dtpFREDFilter5EndDate.Text
                Case "DATE not between"
                    txtbox5 = dtpFREDFilter5StartDate.Text
                    txtbox5two = dtpFREDFilter5EndDate.Text
                Case "contains"
                    txtbox5 = txtFREDFilter5.Text
                Case "does not contain"
                    txtbox5 = txtFREDFilter5.Text
                Case "NULL"

                Case "NOT NULL"

                Case Else
                    txtbox5 = txtFREDFilter5.Text
            End Select


            StoreFavorite = "Update WebFD.FRED.FredFavorites set [Userlogin] = '" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & _
                            "', [FavoriteName] = '" & Replace(txtnewFavName.Text, "'", "''") & "' , [IsEncounter] = " & rblDataType.SelectedValue & _
                            ", [TransTableID] = " & lblFredTableTransID.Text & ", [TransTableColumns] = '" & selectlisttrans & "', [Table1ID] = '" & lblFredTable1ID.Text & "', [Table1Columns] = '" & _
                            selectlist1 & "', [Table2ID] = '" & lblFredTable2ID.Text & "', [Table2Columns] = '" & selectlist2 & "'," & _
                            "[Table3ID] = '" & lblFredTable3ID.Text & "', [Table3Columns] = '" & selectlist3 & "', [Table4ID] = '" & lblFredTable4ID.Text & "', [Table4Columns] = '" & _
                            selectlist4 & "', [Filter1TID] = " & rblFREDFilter1.SelectedValue & ", [Filter1DDColumnID] = (SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter1.SelectedValue & _
                            "' and TABLE_ID = " & rblFREDFilter1.SelectedValue & ")" & ", [Filter1Op] = '" & ddlFREDFilterOption1.Text & "', " & _
                            "[Filter1Txt1] = '" & Replace(txtbox1, "'", "''") & "',[Filter1Txt2] = '" & Replace(txtbox1two, "'", "''") & "', [Filter2TID] = " & rblFREDFilter2.SelectedValue & _
                            ", [Filter2DDColumnID] = " & "(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter2.SelectedValue & _
                            "' and TABLE_ID = " & rblFREDFilter2.SelectedValue & ")" & ", [Filter2Op] = '" & ddlFREDFilterOption2.Text & "', [Filter2Txt1] = '" & Replace(txtbox2, "'", "''") & _
                            "',[Filter2Txt2] = '" & Replace(txtbox2two, "'", "''") & "', [Filter3TID] = " & rblFREDFilter3.SelectedValue & ", [Filter3DDColumnID] = " & _
                            "(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter3.SelectedValue & _
                            "' and TABLE_ID = " & rblFREDFilter3.SelectedValue & ")" & ",[Filter3Op] = '" & ddlFREDFilterOption3.Text & "', [Filter3Txt1] = '" & Replace(txtbox3, "'", "''") & _
                            "',[Filter3Txt2] = '" & Replace(txtbox3two, "'", "''") & "', [Filter4TID] = " & rblFREDFilter4.SelectedValue & ", [Filter4DDColumnID] = " & _
                            "(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter4.SelectedValue & _
                            "' and TABLE_ID = " & rblFREDFilter4.SelectedValue & ")" & _
                            ", [Filter4Op] = '" & ddlFREDFilterOption4.Text & "', [Filter4Txt1] = '" & Replace(txtbox4, "'", "''") & "',[Filter4Txt2] = '" & Replace(txtbox4two, "'", "''") & _
                            "', [Filter5TID] = " & rblFREDFilter5.SelectedValue & ",[Filter5DDColumnID] = " & _
                            "(SELECT  ID FROM [WebFD].[FRED].[AvailableColumns] where COLUMN_NAME = '" & ddlFREDFilter5.SelectedValue & _
                            "' and TABLE_ID = " & rblFREDFilter5.SelectedValue & ")" & ", [Filter5Op] = '" & ddlFREDFilterOption5.Text & "', [Filter5Txt1] = '" & Replace(txtbox5, "'", "''") & _
                            "',[Filter5Txt2] = '" & Replace(txtbox5two, "'", "''") & "', [ExistsChecked] = " & CInt(chbWhereExists.Checked) & " where ID = " & doctor(0)

            Try

                Using conn As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

                    If conn.State = ConnectionState.Closed Then
                        conn.Open()
                    End If

                    cmd = New System.Data.SqlClient.SqlCommand(StoreFavorite, conn)
                    cmd.ExecuteNonQuery()

                End Using

                ExplanationLabel2.Text = "Favorite Updated"
                ModalPopupExtender2.Show()

            Catch ex As Exception
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                ExplanationLabel2.Text = "Error Updating Favorite"
                ModalPopupExtender2.Show()
            End Try
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub

    Private Sub Ok_Click(sender As Object, e As System.EventArgs) Handles Ok.Click
        Dim getfavorite As String
        Dim favoriteinfo As New DataSet


        getfavorite = "SELECT [FavoriteName] as [Favorite Name], convert(varchar, LoadDate, 107) as [Date Added] " & _
"  FROM [WebFD].[FRED].[FredFavorites] ff" & _
" where Userlogin = '" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "' order by FavoriteName asc"

        Try

            Dim da As SqlDataAdapter

            favoriteinfo.Clear()
            Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                da = New SqlDataAdapter(getfavorite, conn2)
                da.Fill(favoriteinfo, "DEMO")
                newgvFavorites.DataSource = favoriteinfo
                newgvFavorites.DataMember = "DEMO"
                newgvFavorites.DataBind()
            End Using


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub

    Public Sub CheckFavorite()

        Try


            If IsNothing(doctor) Then
                Exit Sub
            ElseIf chbWhereExists.Checked <> doctor("ExistsChecked") Then
                favorite = False
            ElseIf rblDataType.SelectedValue <> CInt(doctor("IsEncounter")) * -1 Then
                favorite = False

            ElseIf rblFREDFilter1.SelectedValue <> CInt(doctor("Filter1TID")) Then
                favorite = False

            ElseIf rblFREDFilter2.SelectedValue <> CInt(doctor("Filter2TID")) Then
                favorite = False

            ElseIf rblFREDFilter3.SelectedValue <> CInt(doctor("Filter3TID")) Then
                favorite = False

            ElseIf rblFREDFilter4.SelectedValue <> CInt(doctor("Filter4TID")) Then
                favorite = False

            ElseIf rblFREDFilter5.SelectedValue <> CInt(doctor("Filter5TID")) Then
                favorite = False

            ElseIf IsDBNull(doctor("Filter1ColumnName")) And ddlFREDFilter1.SelectedIndex <> -1 Then
                favorite = False

            ElseIf If(Not IsDBNull(doctor("Filter1ColumnName")), ddlFREDFilter1.Items.FindByValue(doctor("Filter1ColumnName").ToString).Selected.ToString, "notrelevant") = "False" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "=" And ddlFREDFilterOption1.SelectedValue <> "=" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "?" And ddlFREDFilterOption1.SelectedValue <> "≠" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "<" And ddlFREDFilterOption1.SelectedValue <> "<" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "<=" And ddlFREDFilterOption1.SelectedValue <> "<=" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = ">" And ddlFREDFilterOption1.SelectedValue <> ">" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = ">=" And ddlFREDFilterOption1.SelectedValue <> ">=" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "like" And ddlFREDFilterOption1.SelectedValue <> "like" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "contains" And ddlFREDFilterOption1.SelectedValue <> "contains" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "not like" And ddlFREDFilterOption1.SelectedValue <> "not like" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "does not contain" And ddlFREDFilterOption1.SelectedValue <> "does not contain" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "between" And ddlFREDFilterOption1.SelectedValue <> "between" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "not between" And ddlFREDFilterOption1.SelectedValue <> "not between" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "DATE between" And ddlFREDFilterOption1.SelectedValue <> "DATE between" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "DATE not between" And ddlFREDFilterOption1.SelectedValue <> "DATE not between" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "NULL" And ddlFREDFilterOption1.SelectedValue <> "NULL" Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString = "NOT NULL" And ddlFREDFilterOption1.SelectedValue <> "NOT NULL" Then
                favorite = False


            ElseIf IsDBNull(doctor("Filter2ColumnName")) And ddlFREDFilter2.SelectedIndex <> -1 Then
                favorite = False

            ElseIf If(Not IsDBNull(doctor("Filter2ColumnName")), ddlFREDFilter2.Items.FindByValue(doctor("Filter2ColumnName").ToString).Selected.ToString, "notrelevant") = "False" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "=" And ddlFREDFilterOption2.SelectedValue <> "=" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "?" And ddlFREDFilterOption2.SelectedValue <> "≠" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "<" And ddlFREDFilterOption2.SelectedValue <> "<" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "<=" And ddlFREDFilterOption2.SelectedValue <> "<=" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = ">" And ddlFREDFilterOption2.SelectedValue <> ">" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = ">=" And ddlFREDFilterOption2.SelectedValue <> ">=" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "like" And ddlFREDFilterOption2.SelectedValue <> "like" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "contains" And ddlFREDFilterOption2.SelectedValue <> "contains" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "not like" And ddlFREDFilterOption2.SelectedValue <> "not like" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "does not contain" And ddlFREDFilterOption2.SelectedValue <> "does not contain" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "between" And ddlFREDFilterOption2.SelectedValue <> "between" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "not between" And ddlFREDFilterOption2.SelectedValue <> "not between" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "DATE between" And ddlFREDFilterOption2.SelectedValue <> "DATE between" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "DATE not between" And ddlFREDFilterOption2.SelectedValue <> "DATE not between" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "NULL" And ddlFREDFilterOption2.SelectedValue <> "NULL" Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString = "NOT NULL" And ddlFREDFilterOption2.SelectedValue <> "NOT NULL" Then
                favorite = False


            ElseIf IsDBNull(doctor("Filter3ColumnName")) And ddlFREDFilter3.SelectedIndex <> -1 Then
                favorite = False

            ElseIf If(Not IsDBNull(doctor("Filter3ColumnName")), ddlFREDFilter3.Items.FindByValue(doctor("Filter3ColumnName").ToString).Selected.ToString, "notrelevant") = "False" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "=" And ddlFREDFilterOption3.SelectedValue <> "=" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "?" And ddlFREDFilterOption3.SelectedValue <> "≠" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "<" And ddlFREDFilterOption3.SelectedValue <> "<" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "<=" And ddlFREDFilterOption3.SelectedValue <> "<=" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = ">" And ddlFREDFilterOption3.SelectedValue <> ">" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = ">=" And ddlFREDFilterOption3.SelectedValue <> ">=" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "like" And ddlFREDFilterOption3.SelectedValue <> "like" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "contains" And ddlFREDFilterOption3.SelectedValue <> "contains" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "not like" And ddlFREDFilterOption3.SelectedValue <> "not like" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "does not contain" And ddlFREDFilterOption3.SelectedValue <> "does not contain" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "between" And ddlFREDFilterOption3.SelectedValue <> "between" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "not between" And ddlFREDFilterOption3.SelectedValue <> "not between" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "DATE between" And ddlFREDFilterOption3.SelectedValue <> "DATE between" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "DATE not between" And ddlFREDFilterOption3.SelectedValue <> "DATE not between" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "NULL" And ddlFREDFilterOption3.SelectedValue <> "NULL" Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString = "NOT NULL" And ddlFREDFilterOption3.SelectedValue <> "NOT NULL" Then
                favorite = False


            ElseIf IsDBNull(doctor("Filter4ColumnName")) And ddlFREDFilter4.SelectedIndex <> -1 Then
                favorite = False

            ElseIf If(Not IsDBNull(doctor("Filter4ColumnName")), ddlFREDFilter4.Items.FindByValue(doctor("Filter4ColumnName").ToString).Selected.ToString, "notrelevant") = "False" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "=" And ddlFREDFilterOption4.SelectedValue <> "=" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "?" And ddlFREDFilterOption4.SelectedValue <> "≠" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "<" And ddlFREDFilterOption4.SelectedValue <> "<" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "<=" And ddlFREDFilterOption4.SelectedValue <> "<=" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = ">" And ddlFREDFilterOption4.SelectedValue <> ">" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = ">=" And ddlFREDFilterOption4.SelectedValue <> ">=" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "like" And ddlFREDFilterOption4.SelectedValue <> "like" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "contains" And ddlFREDFilterOption4.SelectedValue <> "contains" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "not like" And ddlFREDFilterOption4.SelectedValue <> "not like" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "does not contain" And ddlFREDFilterOption4.SelectedValue <> "does not contain" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "between" And ddlFREDFilterOption4.SelectedValue <> "between" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "not between" And ddlFREDFilterOption4.SelectedValue <> "not between" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "DATE between" And ddlFREDFilterOption4.SelectedValue <> "DATE between" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "DATE not between" And ddlFREDFilterOption4.SelectedValue <> "DATE not between" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "NULL" And ddlFREDFilterOption4.SelectedValue <> "NULL" Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString = "NOT NULL" And ddlFREDFilterOption4.SelectedValue <> "NOT NULL" Then
                favorite = False


            ElseIf IsDBNull(doctor("Filter5ColumnName")) And ddlFREDFilter5.SelectedIndex <> -1 Then
                favorite = False

            ElseIf If(Not IsDBNull(doctor("Filter5ColumnName")), ddlFREDFilter5.Items.FindByValue(doctor("Filter5ColumnName").ToString).Selected.ToString, "notrelevant") = "False" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "=" And ddlFREDFilterOption5.SelectedValue <> "=" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "?" And ddlFREDFilterOption5.SelectedValue <> "≠" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "<" And ddlFREDFilterOption5.SelectedValue <> "<" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "<=" And ddlFREDFilterOption5.SelectedValue <> "<=" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = ">" And ddlFREDFilterOption5.SelectedValue <> ">" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = ">=" And ddlFREDFilterOption5.SelectedValue <> ">=" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "like" And ddlFREDFilterOption5.SelectedValue <> "like" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "contains" And ddlFREDFilterOption5.SelectedValue <> "contains" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "not like" And ddlFREDFilterOption5.SelectedValue <> "not like" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "does not contain" And ddlFREDFilterOption5.SelectedValue <> "does not contain" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "between" And ddlFREDFilterOption5.SelectedValue <> "between" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "not between" And ddlFREDFilterOption5.SelectedValue <> "not between" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "DATE between" And ddlFREDFilterOption5.SelectedValue <> "DATE between" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "DATE not between" And ddlFREDFilterOption5.SelectedValue <> "DATE not between" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "NULL" And ddlFREDFilterOption5.SelectedValue <> "NULL" Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString = "NOT NULL" And ddlFREDFilterOption5.SelectedValue <> "NOT NULL" Then
                favorite = False


            ElseIf doctor("Filter1Op").ToString() = "between" And (numFREDFilter1End.Text <> doctor("Filter1Txt2").ToString Or numFREDFilter1Start.Text <> doctor("Filter1Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString() = "not between" And (numFREDFilter1End.Text <> doctor("Filter1Txt2").ToString Or numFREDFilter1Start.Text <> doctor("Filter1Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString() = "DATE between" And (dtpFREDFilter1EndDate.Text <> doctor("Filter1Txt2").ToString Or dtpFREDFilter1StartDate.Text <> doctor("Filter1Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString() = "DATE not between" And (dtpFREDFilter1EndDate.Text <> doctor("Filter1Txt2").ToString Or dtpFREDFilter1StartDate.Text <> doctor("Filter1Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString() = "contains" And txtFREDFilter1.Text <> doctor("Filter1Txt1").ToString Then
                favorite = False

            ElseIf doctor("Filter1Op").ToString() = "does not contain" And txtFREDFilter1.Text <> doctor("Filter1Txt1").ToString Then
                favorite = False

            ElseIf txtFREDFilter1.Text <> doctor("Filter1Txt1").ToString And doctor("Filter1Op").ToString() <> "between" And doctor("Filter1Op").ToString() <> "not between" And
                    doctor("Filter1Op").ToString() <> "DATE between" And doctor("Filter1Op").ToString() <> "DATE not between" And doctor("Filter1Op").ToString() <> "contains" And
                    doctor("Filter1Op").ToString() <> "does not contain" Then
                favorite = False




            ElseIf doctor("Filter2Op").ToString() = "between" And (numFREDFilter2End.Text <> doctor("Filter2Txt2").ToString Or numFREDFilter2Start.Text <> doctor("Filter2Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString() = "not between" And (numFREDFilter2End.Text <> doctor("Filter2Txt2").ToString Or numFREDFilter2Start.Text <> doctor("Filter2Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString() = "DATE between" And (dtpFREDFilter2EndDate.Text <> doctor("Filter2Txt2").ToString Or dtpFREDFilter2StartDate.Text <> doctor("Filter2Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString() = "DATE not between" And (dtpFREDFilter2EndDate.Text <> doctor("Filter2Txt2").ToString Or dtpFREDFilter2StartDate.Text <> doctor("Filter2Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString() = "contains" And txtFREDFilter2.Text <> doctor("Filter2Txt1").ToString Then
                favorite = False

            ElseIf doctor("Filter2Op").ToString() = "does not contain" And txtFREDFilter2.Text <> doctor("Filter2Txt1").ToString Then
                favorite = False

            ElseIf txtFREDFilter2.Text <> doctor("Filter2Txt1").ToString And doctor("Filter2Op").ToString() <> "between" And doctor("Filter2Op").ToString() <> "not between" And
                    doctor("Filter2Op").ToString() <> "DATE between" And doctor("Filter2Op").ToString() <> "DATE not between" And doctor("Filter2Op").ToString() <> "contains" And
                    doctor("Filter2Op").ToString() <> "does not contain" Then
                favorite = False


            ElseIf doctor("Filter3Op").ToString() = "between" And (numFREDFilter3End.Text <> doctor("Filter3Txt2").ToString Or numFREDFilter3Start.Text <> doctor("Filter3Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString() = "not between" And (numFREDFilter3End.Text <> doctor("Filter3Txt2").ToString Or numFREDFilter3Start.Text <> doctor("Filter3Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString() = "DATE between" And (dtpFREDFilter3EndDate.Text <> doctor("Filter3Txt2").ToString Or dtpFREDFilter3StartDate.Text <> doctor("Filter3Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString() = "DATE not between" And (dtpFREDFilter3EndDate.Text <> doctor("Filter3Txt2").ToString Or dtpFREDFilter3StartDate.Text <> doctor("Filter3Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString() = "contains" And txtFREDFilter3.Text <> doctor("Filter3Txt1").ToString Then
                favorite = False

            ElseIf doctor("Filter3Op").ToString() = "does not contain" And txtFREDFilter3.Text <> doctor("Filter3Txt1").ToString Then
                favorite = False

            ElseIf txtFREDFilter3.Text <> doctor("Filter3Txt1").ToString And doctor("Filter3Op").ToString() <> "between" And doctor("Filter3Op").ToString() <> "not between" And
                    doctor("Filter3Op").ToString() <> "DATE between" And doctor("Filter3Op").ToString() <> "DATE not between" And doctor("Filter3Op").ToString() <> "contains" And
                    doctor("Filter3Op").ToString() <> "does not contain" Then
                favorite = False


            ElseIf doctor("Filter4Op").ToString() = "between" And (numFREDFilter4End.Text <> doctor("Filter4Txt2").ToString Or numFREDFilter4Start.Text <> doctor("Filter4Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString() = "not between" And (numFREDFilter4End.Text <> doctor("Filter4Txt2").ToString Or numFREDFilter4Start.Text <> doctor("Filter4Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString() = "DATE between" And (dtpFREDFilter4EndDate.Text <> doctor("Filter4Txt2").ToString Or dtpFREDFilter4StartDate.Text <> doctor("Filter4Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString() = "DATE not between" And (dtpFREDFilter4EndDate.Text <> doctor("Filter4Txt2").ToString Or dtpFREDFilter4StartDate.Text <> doctor("Filter4Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString() = "contains" And txtFREDFilter4.Text <> doctor("Filter4Txt1").ToString Then
                favorite = False

            ElseIf doctor("Filter4Op").ToString() = "does not contain" And txtFREDFilter4.Text <> doctor("Filter4Txt1").ToString Then
                favorite = False

            ElseIf txtFREDFilter4.Text <> doctor("Filter4Txt1").ToString And doctor("Filter4Op").ToString() <> "between" And doctor("Filter4Op").ToString() <> "not between" And
                    doctor("Filter4Op").ToString() <> "DATE between" And doctor("Filter4Op").ToString() <> "DATE not between" And doctor("Filter4Op").ToString() <> "contains" And
                    doctor("Filter4Op").ToString() <> "does not contain" Then
                favorite = False


            ElseIf doctor("Filter5Op").ToString() = "between" And (numFREDFilter5End.Text <> doctor("Filter5Txt2").ToString Or numFREDFilter5Start.Text <> doctor("Filter5Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString() = "not between" And (numFREDFilter5End.Text <> doctor("Filter5Txt2").ToString Or numFREDFilter5Start.Text <> doctor("Filter5Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString() = "DATE between" And (dtpFREDFilter5EndDate.Text <> doctor("Filter5Txt2").ToString Or dtpFREDFilter5StartDate.Text <> doctor("Filter5Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString() = "DATE not between" And (dtpFREDFilter5EndDate.Text <> doctor("Filter5Txt2").ToString Or dtpFREDFilter5StartDate.Text <> doctor("Filter5Txt1").ToString) Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString() = "contains" And txtFREDFilter5.Text <> doctor("Filter5Txt1").ToString Then
                favorite = False

            ElseIf doctor("Filter5Op").ToString() = "does not contain" And txtFREDFilter5.Text <> doctor("Filter5Txt1").ToString Then
                favorite = False

            ElseIf txtFREDFilter5.Text <> doctor("Filter5Txt1").ToString And doctor("Filter5Op").ToString() <> "between" And doctor("Filter5Op").ToString() <> "not between" And
                    doctor("Filter5Op").ToString() <> "DATE between" And doctor("Filter5Op").ToString() <> "DATE not between" And doctor("Filter5Op").ToString() <> "contains" And
                    doctor("Filter5Op").ToString() <> "does not contain" Then
                favorite = False


            Else
                favorite = True

            End If

            If favorite = True Then
                Dim indexcount As Integer = 0

                For Each checkeditem As ListItem In cblFREDSelectTrans.Items
                    If (InStr(doctor("Table1Columns").ToString, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0) <> cblFREDSelectTrans.Items(indexcount).Selected Then
                        favorite = False

                        Exit Sub
                    End If
                    indexcount += 1
                Next

                indexcount = 0

                For Each checkeditem As ListItem In cblFREDSelect1.Items
                    If (InStr(doctor("Table1Columns").ToString, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0) <> cblFREDSelect1.Items(indexcount).Selected Then
                        favorite = False

                        Exit Sub
                    End If
                    indexcount += 1
                Next

                indexcount = 0

                For Each checkeditem As ListItem In cblFREDSelect2.Items
                    If (InStr(doctor("Table2Columns").ToString, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0) <> cblFREDSelect2.Items(indexcount).Selected Then
                        favorite = False

                        Exit Sub
                    End If
                    indexcount += 1
                Next
                indexcount = 0

                For Each checkeditem As ListItem In cblFREDSelect3.Items
                    If (InStr(doctor("Table3Columns").ToString, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0) <> cblFREDSelect3.Items(indexcount).Selected Then
                        favorite = False

                        Exit Sub
                    End If
                    indexcount += 1
                Next

                indexcount = 0

                For Each checkeditem As ListItem In cblFREDSelect4.Items
                    If (InStr(doctor("Table4Columns").ToString, " " + Mid(checkeditem.Value, 4, InStr(checkeditem.Value, "Desc:") - 5) + " ", CompareMethod.Text) > 0) <> cblFREDSelect4.Items(indexcount).Selected Then
                        favorite = False

                        Exit Sub
                    End If
                    indexcount += 1
                Next
            End If

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub


    Private Sub btnexample1_Click(sender As Object, e As System.EventArgs) Handles btnexample1.Click

        Try

            Dim examplesql As String
            Dim namessql As String
            Dim quickinfo As New DataSet
            'Dim qr As DataRow

            examplesql = "Error"

            namessql = "select " & _
                         "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                         ",COLUMN_NAME as FREDConnect " & _
                         " from WebFD.FRED.vw_AvailableData " & _
                         " where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and COLUMN_Alias = '" & ddlFREDFilter1.SelectedValue & "'"


            Try

                Dim da As SqlDataAdapter

                Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    da = New SqlDataAdapter(namessql, conn2)
                    da.Fill(quickinfo)
                End Using

                qr = quickinfo.Tables(0).Rows(0)

                examplesql = "Select distinct top 25 [" & qr("FREDConnect").ToString & "] from " & qr("FREDTable").ToString
                Dim exampleinfo As New DataSet

                Try

                    Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                        da = New SqlDataAdapter(examplesql, conn2)
                        da.Fill(exampleinfo, "DEMO")
                        gvExample.DataSource = exampleinfo
                        gvExample.DataMember = "DEMO"
                        gvExample.DataBind()
                        gvExample.Visible = True
                        pnlExportExample.Visible = True
                    End Using


                Catch ex As Exception
                    LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                End Try

            Catch ex As Exception
                explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                ModalPopupExtenderexample.Show()
            End Try

            explantionlabelexample.Text = examplesql
            ModalPopupExtenderexample.Show()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub

    Private Sub btnexample2_Click(sender As Object, e As System.EventArgs) Handles btnexample2.Click

        Try



            Dim examplesql As String
            Dim namessql As String
            Dim quickinfo As New DataSet
            'Dim qr As DataRow

            examplesql = "Error"

            namessql = "select " & _
                         "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                         ",COLUMN_NAME as FREDConnect " & _
                         "from WebFD.FRED.vw_AvailableData " & _
                         "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and COLUMN_Alias = '" & ddlFREDFilter2.SelectedValue & "'"


            Try

                Dim da As SqlDataAdapter

                Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    da = New SqlDataAdapter(namessql, conn2)
                    da.Fill(quickinfo)
                End Using

                qr = quickinfo.Tables(0).Rows(0)

                examplesql = "Select distinct top 25 [" & qr("FREDConnect").ToString & "] from " & qr("FREDTable").ToString
                Dim exampleinfo As New DataSet

                Try

                    Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                        da = New SqlDataAdapter(examplesql, conn2)
                        da.Fill(exampleinfo, "DEMO")
                        gvExample.DataSource = exampleinfo
                        gvExample.DataMember = "DEMO"
                        gvExample.DataBind()
                        gvExample.Visible = True
                        pnlExportExample.Visible = True
                    End Using


                Catch ex As Exception
                    LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                End Try

            Catch ex As Exception
                explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                ModalPopupExtenderexample.Show()

            End Try

            explantionlabelexample.Text = examplesql
            ModalPopupExtenderexample.Show()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub

    Private Sub btnexample3_Click(sender As Object, e As System.EventArgs) Handles btnexample3.Click

        Try

            Dim examplesql As String
            Dim namessql As String
            Dim quickinfo As New DataSet
            'Dim qr As DataRow

            examplesql = "Error"

            namessql = "select " & _
                         "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                         ",COLUMN_NAME as FREDConnect " & _
                         "from WebFD.FRED.vw_AvailableData " & _
                         "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and COLUMN_Alias = '" & ddlFREDFilter3.SelectedValue & "'"


            Try

                Dim da As SqlDataAdapter

                Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    da = New SqlDataAdapter(namessql, conn2)
                    da.Fill(quickinfo)
                End Using

                qr = quickinfo.Tables(0).Rows(0)

                examplesql = "Select distinct top 25 [" & qr("FREDConnect").ToString & "] from " & qr("FREDTable").ToString
                Dim exampleinfo As New DataSet

                Try

                    Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                        da = New SqlDataAdapter(examplesql, conn2)
                        da.Fill(exampleinfo, "DEMO")
                        gvExample.DataSource = exampleinfo
                        gvExample.DataMember = "DEMO"
                        gvExample.DataBind()
                        gvExample.Visible = True
                        pnlExportExample.Visible = True
                    End Using


                Catch ex As Exception
                    LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                End Try

            Catch ex As Exception
                explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
                ModalPopupExtenderexample.Show()
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            End Try

            explantionlabelexample.Text = examplesql
            ModalPopupExtenderexample.Show()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub

    Private Sub btnexample4_Click(sender As Object, e As System.EventArgs) Handles btnexample4.Click


        Try

            Dim examplesql As String
            Dim namessql As String
            Dim quickinfo As New DataSet
            'Dim qr As DataRow

            examplesql = "Error"

            namessql = "select " & _
                         "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                         ",COLUMN_NAME as FREDConnect " & _
                         "from WebFD.FRED.vw_AvailableData " & _
                         "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and COLUMN_Alias = '" & ddlFREDFilter4.SelectedValue & "'"


            Try

                Dim da As SqlDataAdapter

                Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    da = New SqlDataAdapter(namessql, conn2)
                    da.Fill(quickinfo)
                End Using

                qr = quickinfo.Tables(0).Rows(0)

                examplesql = "Select distinct top 25 [" & qr("FREDConnect").ToString & "] from " & qr("FREDTable").ToString
                Dim exampleinfo As New DataSet

                Try

                    Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                        da = New SqlDataAdapter(examplesql, conn2)
                        da.Fill(exampleinfo, "DEMO")
                        gvExample.DataSource = exampleinfo
                        gvExample.DataMember = "DEMO"
                        gvExample.DataBind()
                        gvExample.Visible = True
                        pnlExportExample.Visible = True
                    End Using


                Catch ex As Exception
                    LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                End Try

            Catch ex As Exception
                explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
                ModalPopupExtenderexample.Show()
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            End Try

            explantionlabelexample.Text = examplesql
            ModalPopupExtenderexample.Show()

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub

    Private Sub btnexample5_Click(sender As Object, e As System.EventArgs) Handles btnexample5.Click


        Try

            Dim examplesql As String
            Dim namessql As String
            Dim quickinfo As New DataSet
            'Dim qr As DataRow

            examplesql = "Error"

            namessql = "select " & _
                         "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
                         ",COLUMN_NAME as FREDConnect " & _
                         "from WebFD.FRED.vw_AvailableData " & _
                         "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and COLUMN_Alias = '" & ddlFREDFilter5.SelectedValue & "'"


            Try

                Dim da As SqlDataAdapter

                Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                    da = New SqlDataAdapter(namessql, conn2)
                    da.Fill(quickinfo)
                End Using

                qr = quickinfo.Tables(0).Rows(0)

                examplesql = "Select distinct top 25 [" & qr("FREDConnect").ToString & "] from " & qr("FREDTable").ToString
                Dim exampleinfo As New DataSet

                Try

                    Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                        da = New SqlDataAdapter(examplesql, conn2)
                        da.Fill(exampleinfo, "DEMO")
                        gvExample.DataSource = exampleinfo
                        gvExample.DataMember = "DEMO"
                        gvExample.DataBind()
                        gvExample.Visible = True
                        pnlExportExample.Visible = True
                    End Using


                Catch ex As Exception
                    LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
                End Try

            Catch ex As Exception
                explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
                ModalPopupExtenderexample.Show()
                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            End Try

            explantionlabelexample.Text = examplesql
            ModalPopupExtenderexample.Show()


        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub

    Public Sub blankpopup(n As Integer, y As String, z As String)

        Try
            explantionlabelexample.Text = "Column '" & z & "' is a " & y & " Data Type -- blank values are not allowed.  Please enter a value into the Filter " & n & " text field."
            ModalPopupExtenderexample.Show()
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub
    Public Sub baddata(n As Integer, y As String, z As String, a As String)

        Try
            explantionlabelexample.Text = "Column " & a & " is a " & y & " Data Type -- '" & z & "' is an invalid value -- please enter a " & y & " value into the Filter " & n & " text field."
            ModalPopupExtenderexample.Show()
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub
    Public Sub longdata(n As Integer, y As String, z As String)

        Try
            explantionlabelexample.Text = "Column '" & z & "' is a " & y & " Data Type -- maximum allowed length is 38 digits.  Please adjust the value in Filter " & n & " accordingly."
            ModalPopupExtenderexample.Show()
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub

    Private Sub FREDSelectAllTrans_Click(sender As Object, e As System.EventArgs) Handles FREDSelectAllTrans.Click
        Try

            For i As Integer = 0 To cblFREDSelectTrans.Items.Count - 1
                cblFREDSelectTrans.Items(i).Selected = True

            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub

    Private Sub FREDUnSelectAllTrans_Click(sender As Object, e As System.EventArgs) Handles FREDUnSelectAllTrans.Click
        Try

            For i As Integer = 0 To cblFREDSelectTrans.Items.Count - 1
                cblFREDSelectTrans.Items(i).Selected = False

            Next

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub
    'Public Sub RecalculateNumbers()

    '    Try


    '        Dim notNumbers As List(Of Double) = New List(Of Double)
    '        notNumbers.Add(1)
    '        notNumbers.Add(8)
    '        notNumbers.Add(9)
    '        notNumbers.Add(11)
    '        notNumbers.Add(13)



    '        If lblFREDTable1.Text <> "" Then

    '            Try

    '                Dim numbercheck As String = "Select count(*) as cnt from " & lblFREDTable1.Text & " enc "
    '                Dim tempFRED1 As String = ""
    '                Dim tempFRED2 As String = ""
    '                Dim tempFRED3 As String = ""
    '                Dim tempFRED4 As String = ""
    '                Dim tempFRED5 As String = ""
    '                Dim exists1 As String = ""
    '                Dim exists2 As String = ""
    '                Dim exists3 As String = ""
    '                Dim exists4 As String = ""
    '                Dim exists5 As String = ""
    '                Dim temp As String
    '                Dim SQL As String

    '                If rblFREDFilter1.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption1.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter1.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " " & ddlFREDFilterOption1.Text & " '" & Replace(txtFREDFilter1.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter1.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTable1ID.Text Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                        Else

    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKey1.Text & " = FF1." & dr.Item("FREDConnect")
    '                                End While


    '                            End Using
    '                            tempFRED1 = " " & tempFRED1 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTable1ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then

    '                            '    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '        SQL = "select " & _
    '                            '     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '     ",COLUMN_NAME as FREDConnect " & _
    '                            '     "from WebFD.FRED.vw_AvailableData " & _
    '                            '     "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '        If conn.State = ConnectionState.Closed Then
    '                            '            conn.Open()
    '                            '        End If
    '                            '        cmd = New SqlCommand(SQL, conn)
    '                            '        dr = cmd.ExecuteReader
    '                            '        While dr.Read
    '                            '            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKey1.Text & " = FF1." & dr.Item("FREDConnect")
    '                            '        End While


    '                            '    End Using

    '                            '    tempFRED1 = " " & tempFRED1 & " and "
    '                        Else

    '                            Select Case ddlFREDFilterOption1.SelectedIndex
    '                                Case 1
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " <> ", " = ")
    '                                Case 8
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not like '%", " like '%")
    '                                Case 9
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not in (", " in (")
    '                                Case 11
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case 13
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case Else
    '                            End Select

    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    tempFRED1 = exists1 & " exists ( select * from " & dr.Item("FredTable") & " FF1 where enc." & lblFREDKey1.Text & " = FF1." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED1 & ") and "
    '                                End While


    '                            End Using


    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter2.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption2.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter2.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " " & ddlFREDFilterOption2.Text & " '" & Replace(txtFREDFilter2.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter2.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTable1ID.Text Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter2.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED2 = Replace(tempFRED2, "FF2.", "FF1.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKey1.Text & " = FF2." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED2 = " " & tempFRED2 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTable1ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter2.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED2 = Replace(tempFRED3, "FF2.", "FF1.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKey1.Text & " = FF2." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED2 = " " & tempFRED2 & " and "
    '                        Else
    '                            If rblFREDFilter2.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED2, "FF2", "FF1") & ") and "
    '                                        tempFRED2 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " <> ", " = ")
    '                                    Case 8
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not in (", " in (")
    '                                    Case 11
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case 13
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED2 = exists2 & " exists ( select * from " & dr.Item("FredTable") & " FF2 where enc." & lblFREDKey1.Text & " = FF2." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED2 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter3.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption3.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter3.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp) - InStr(temp, ",") + 1)
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " " & ddlFREDFilterOption3.Text & " '" & Replace(txtFREDFilter3.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter3.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTable1ID.Text Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter3.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKey1.Text & " = FF3." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED3 = " " & tempFRED3 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTable1ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter3.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKey1.Text & " = FF3." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED3 = " " & tempFRED3 & " and "
    '                        Else
    '                            If rblFREDFilter3.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED3, "FF3", "FF1") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter3.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED3, "FF3", "FF2") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " <> ", " = ")
    '                                    Case 8
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not in (", " in (")
    '                                    Case 11
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case 13
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED3 = exists3 & " exists ( select * from " & dr.Item("FredTable") & " FF3 where enc." & lblFREDKey1.Text & " = FF3." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED3 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter4.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption4.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter4.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED4 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED4 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED4.EndsWith(",") Then
    '                                tempFRED4 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " " & ddlFREDFilterOption4.Text & " '" & Replace(txtFREDFilter4.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter4.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTable1ID.Text Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter4.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF3.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKey1.Text & " = FF4." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED4 = " " & tempFRED4 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTable1ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter4.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF3.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKey1.Text & " = FF4." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED4 = " " & tempFRED4 & " and "
    '                        Else
    '                            Dim teststring As Boolean
    '                            Dim test2 As Boolean
    '                            teststring = notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex)
    '                            test2 = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex)

    '                            If rblFREDFilter4.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED4, "FF4", "FF1") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED4, "FF4", "FF2") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED4, "FF4", "FF3") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " <> ", " = ")
    '                                    Case 8
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not in (", " in (")
    '                                    Case 11
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case 13
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED4 = exists4 & " exists ( select * from " & dr.Item("FredTable") & " FF4 where enc." & lblFREDKey1.Text & " = FF4." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED4 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter5.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption5.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter5.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " " & ddlFREDFilterOption5.Text & " '" & Replace(txtFREDFilter5.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter5.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTable1ID.Text Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter5.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                                Case rblFREDFilter4.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKey1.Text & " = FF5." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED5 = " " & tempFRED5 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTable1ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter5.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                            '        Case rblFREDFilter4.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKey1.Text & " = FF5." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED5 = " " & tempFRED5 & " and "
    '                        Else
    '                            If rblFREDFilter5.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED5, "FF5", "FF1") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED5, "FF5", "FF2") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED5, "FF5", "FF3") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter4.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(tempFRED5, "FF5", "FF4") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " <> ", " = ")
    '                                    Case 8
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not in (", " in (")
    '                                    Case 11
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case 13
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED5 = exists5 & " exists ( select * from " & dr.Item("FredTable") & " FF5 where enc." & lblFREDKey1.Text & " = FF5." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED5 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If


    '                numbercheck = numbercheck & " where" & tempFRED1 & tempFRED2 & tempFRED3 & tempFRED4 & tempFRED5
    '                numbercheck = Mid(numbercheck, 1, Len(numbercheck) - 5)


    '                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

    '                    If conn.State = ConnectionState.Closed Then
    '                        conn.Open()
    '                    End If
    '                    Dim da As New SqlDataAdapter
    '                    cmd = New SqlCommand(numbercheck, conn)
    '                    da.SelectCommand = cmd
    '                    da.SelectCommand.CommandTimeout = 600
    '                    dr = cmd.ExecuteReader
    '                    While dr.Read
    '                        lblFredSelectCount1.Text = " (" & dr("cnt") & ")"
    '                    End While


    '                End Using

    '            Catch ex As Exception
    '                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
    '            End Try
    '        End If


    '        If lblFREDTable2.Text <> "" Then

    '            Try

    '                Dim numbercheck As String = "Select count(*) as cnt from " & lblFREDTable2.Text & " enc "
    '                Dim tempFRED1 As String = ""
    '                Dim tempFRED2 As String = ""
    '                Dim tempFRED3 As String = ""
    '                Dim tempFRED4 As String = ""
    '                Dim tempFRED5 As String = ""
    '                Dim exists1 As String = ""
    '                Dim exists2 As String = ""
    '                Dim exists3 As String = ""
    '                Dim exists4 As String = ""
    '                Dim exists5 As String = ""
    '                Dim temp As String
    '                Dim SQL As String

    '                If rblFREDFilter1.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption1.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter1.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " " & ddlFREDFilterOption1.Text & " '" & Replace(txtFREDFilter1.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter1.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTable2ID.Text Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                        Else


    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKey2.Text & " = FF1." & dr.Item("FREDConnect")
    '                                End While


    '                            End Using
    '                            tempFRED1 = " " & tempFRED1 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTable2ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then

    '                            '    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '        SQL = "select " & _
    '                            '     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '     ",COLUMN_NAME as FREDConnect " & _
    '                            '     "from WebFD.FRED.vw_AvailableData " & _
    '                            '     "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '        If conn.State = ConnectionState.Closed Then
    '                            '            conn.Open()
    '                            '        End If
    '                            '        cmd = New SqlCommand(SQL, conn)
    '                            '        dr = cmd.ExecuteReader
    '                            '        While dr.Read
    '                            '            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKey2.Text & " = FF1." & dr.Item("FREDConnect")
    '                            '        End While


    '                            '    End Using
    '                            '    tempFRED1 = " " & tempFRED1 & " and "

    '                        Else

    '                            Select Case ddlFREDFilterOption1.SelectedIndex
    '                                Case 1
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " <> ", " = ")
    '                                Case 8
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not like '%", " like '%")
    '                                Case 9
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not in (", " in (")
    '                                Case 11
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case 13
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case Else
    '                            End Select

    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    tempFRED1 = exists1 & " exists ( select * from " & dr.Item("FredTable") & " FF1 where enc." & lblFREDKey2.Text & " = FF1." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED1 & ") and "
    '                                End While


    '                            End Using


    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter2.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption2.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter2.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " " & ddlFREDFilterOption2.Text & " '" & Replace(txtFREDFilter2.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter2.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTable2ID.Text Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter2.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED2 = Replace(tempFRED2, "FF2.", "FF1.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKey2.Text & " = FF2." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED2 = " " & tempFRED2 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTable2ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter2.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED2 = Replace(tempFRED3, "FF2.", "FF1.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKey2.Text & " = FF2." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED2 = " " & tempFRED2 & " and "
    '                        Else
    '                            If rblFREDFilter2.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED2, "FF2", "FF1") & ") and "
    '                                        tempFRED2 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " <> ", " = ")
    '                                    Case 8
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not in (", " in (")
    '                                    Case 11
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case 13
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED2 = exists2 & " exists ( select * from " & dr.Item("FredTable") & " FF2 where enc." & lblFREDKey2.Text & " = FF2." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED2 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter3.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption3.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter3.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " " & ddlFREDFilterOption3.Text & " '" & Replace(txtFREDFilter3.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter3.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTable2ID.Text Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter3.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKey2.Text & " = FF3." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED3 = " " & tempFRED3 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTable2ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter3.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKey2.Text & " = FF3." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED3 = " " & tempFRED3 & " and "
    '                        Else
    '                            If rblFREDFilter3.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED3, "FF3", "FF1") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter3.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED3, "FF3", "FF2") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " <> ", " = ")
    '                                    Case 8
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not in (", " in (")
    '                                    Case 11
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case 13
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED3 = exists3 & " exists ( select * from " & dr.Item("FredTable") & " FF3 where enc." & lblFREDKey2.Text & " = FF3." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED3 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter4.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption4.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter4.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED4 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED4 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED4.EndsWith(",") Then
    '                                tempFRED4 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " " & ddlFREDFilterOption4.Text & " '" & Replace(txtFREDFilter4.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter4.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTable2ID.Text Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter4.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF3.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKey2.Text & " = FF4." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED4 = " " & tempFRED4 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTable2ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter4.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF3.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKey2.Text & " = FF4." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED4 = " " & tempFRED4 & " and "
    '                        Else
    '                            If rblFREDFilter4.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED4, "FF4", "FF1") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED4, "FF4", "FF2") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED4, "FF4", "FF3") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " <> ", " = ")
    '                                    Case 8
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not in (", " in (")
    '                                    Case 11
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case 13
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED4 = exists4 & " exists ( select * from " & dr.Item("FredTable") & " FF4 where enc." & lblFREDKey2.Text & " = FF4." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED4 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter5.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption5.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter5.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " " & ddlFREDFilterOption5.Text & " '" & Replace(txtFREDFilter5.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter5.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTable2ID.Text Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter5.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                                Case rblFREDFilter4.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKey2.Text & " = FF5." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED5 = " " & tempFRED5 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTable2ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter5.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                            '        Case rblFREDFilter4.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKey2.Text & " = FF5." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED5 = " " & tempFRED5 & " and "
    '                        Else
    '                            If rblFREDFilter5.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED5, "FF5", "FF1") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED5, "FF5", "FF2") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED5, "FF5", "FF3") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter4.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(tempFRED5, "FF5", "FF4") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " <> ", " = ")
    '                                    Case 8
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not in (", " in (")
    '                                    Case 11
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case 13
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED5 = exists5 & " exists ( select * from " & dr.Item("FredTable") & " FF5 where enc." & lblFREDKey2.Text & " = FF5." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED5 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                numbercheck = numbercheck & " where" & tempFRED1 & tempFRED2 & tempFRED3 & tempFRED4 & tempFRED5
    '                numbercheck = Mid(numbercheck, 1, Len(numbercheck) - 5)


    '                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

    '                    If conn.State = ConnectionState.Closed Then
    '                        conn.Open()
    '                    End If
    '                    Dim da As New SqlDataAdapter
    '                    cmd = New SqlCommand(numbercheck, conn)
    '                    da.SelectCommand = cmd
    '                    da.SelectCommand.CommandTimeout = 600
    '                    dr = cmd.ExecuteReader
    '                    While dr.Read
    '                        lblFredSelectCount2.Text = " (" & dr("cnt") & ")"
    '                    End While


    '                End Using

    '            Catch ex As Exception
    '                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
    '            End Try
    '        End If

    '        If lblFREDTable3.Text <> "" Then


    '            Try

    '                Dim numbercheck As String = "Select count(*) as cnt from " & lblFREDTable3.Text & " enc "
    '                Dim tempFRED1 As String = ""
    '                Dim tempFRED2 As String = ""
    '                Dim tempFRED3 As String = ""
    '                Dim tempFRED4 As String = ""
    '                Dim tempFRED5 As String = ""
    '                Dim exists1 As String = ""
    '                Dim exists2 As String = ""
    '                Dim exists3 As String = ""
    '                Dim exists4 As String = ""
    '                Dim exists5 As String = ""
    '                Dim temp As String
    '                Dim SQL As String

    '                If rblFREDFilter1.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption1.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter1.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " " & ddlFREDFilterOption1.Text & " '" & Replace(txtFREDFilter1.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter1.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTable3ID.Text Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                        Else


    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKey3.Text & " = FF1." & dr.Item("FREDConnect")
    '                                End While


    '                            End Using
    '                            tempFRED1 = " " & tempFRED1 & " and "

    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTable3ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then

    '                            '    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '        SQL = "select " & _
    '                            '     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '     ",COLUMN_NAME as FREDConnect " & _
    '                            '     "from WebFD.FRED.vw_AvailableData " & _
    '                            '     "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '        If conn.State = ConnectionState.Closed Then
    '                            '            conn.Open()
    '                            '        End If
    '                            '        cmd = New SqlCommand(SQL, conn)
    '                            '        dr = cmd.ExecuteReader
    '                            '        While dr.Read
    '                            '            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKey3.Text & " = FF1." & dr.Item("FREDConnect")
    '                            '        End While


    '                            '    End Using
    '                            '    tempFRED1 = " " & tempFRED1 & " and "

    '                        Else

    '                            Select Case ddlFREDFilterOption1.SelectedIndex
    '                                Case 1
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " <> ", " = ")
    '                                Case 8
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not like '%", " like '%")
    '                                Case 9
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not in (", " in (")
    '                                Case 11
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case 13
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case Else
    '                            End Select

    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    tempFRED1 = exists1 & " exists ( select * from " & dr.Item("FredTable") & " FF1 where enc." & lblFREDKey3.Text & " = FF1." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED1 & ") and "
    '                                End While


    '                            End Using


    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter2.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption2.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter2.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " " & ddlFREDFilterOption2.Text & " '" & Replace(txtFREDFilter2.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter2.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTable3ID.Text Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter2.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED2 = Replace(tempFRED2, "FF2.", "FF1.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKey3.Text & " = FF2." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED2 = " " & tempFRED2 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTable3ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter2.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED2 = Replace(tempFRED3, "FF2.", "FF1.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKey3.Text & " = FF2." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED2 = " " & tempFRED2 & " and "
    '                        Else
    '                            If rblFREDFilter2.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED2, "FF2", "FF1") & ") and "
    '                                        tempFRED2 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " <> ", " = ")
    '                                    Case 8
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not in (", " in (")
    '                                    Case 11
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case 13
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED2 = exists2 & " exists ( select * from " & dr.Item("FredTable") & " FF2 where enc." & lblFREDKey3.Text & " = FF2." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED2 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter3.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption3.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter3.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " " & ddlFREDFilterOption3.Text & " '" & Replace(txtFREDFilter3.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter3.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTable3ID.Text Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter3.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKey3.Text & " = FF3." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED3 = " " & tempFRED3 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter3.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKey3.Text & " = FF3." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED3 = " " & tempFRED3 & " and "
    '                        Else
    '                            If rblFREDFilter3.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED3, "FF3", "FF1") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter3.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED3, "FF3", "FF2") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " <> ", " = ")
    '                                    Case 8
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not in (", " in (")
    '                                    Case 11
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case 13
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED3 = exists3 & " exists ( select * from " & dr.Item("FredTable") & " FF3 where enc." & lblFREDKey3.Text & " = FF3." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED3 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter4.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption4.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter4.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED4 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED4 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED4.EndsWith(",") Then
    '                                tempFRED4 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " " & ddlFREDFilterOption4.Text & " '" & Replace(txtFREDFilter4.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter4.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTable3ID.Text Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter4.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF3.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKey3.Text & " = FF4." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED4 = " " & tempFRED4 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTable3ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter4.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF3.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKey3.Text & " = FF4." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED4 = " " & tempFRED4 & " and "
    '                        Else
    '                            If rblFREDFilter4.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED4, "FF4", "FF1") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED4, "FF4", "FF2") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED4, "FF4", "FF3") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " <> ", " = ")
    '                                    Case 8
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not in (", " in (")
    '                                    Case 11
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case 13
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED4 = exists4 & " exists ( select * from " & dr.Item("FredTable") & " FF4 where enc." & lblFREDKey3.Text & " = FF4." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED4 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter5.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption5.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter5.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " " & ddlFREDFilterOption5.Text & " '" & Replace(txtFREDFilter5.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter5.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTable3ID.Text Then
    '                            tempFRED5 = Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter5.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                                Case rblFREDFilter4.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKey3.Text & " = FF5." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED5 = tempFRED5 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTable3ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter5.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                            '        Case rblFREDFilter4.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKey3.Text & " = FF5." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED5 = " " & tempFRED5 & " and "
    '                        Else
    '                            If rblFREDFilter5.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED5, "FF5", "FF1") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED5, "FF5", "FF2") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED5, "FF5", "FF3") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter4.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(tempFRED5, "FF5", "FF4") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " <> ", " = ")
    '                                    Case 8
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not in (", " in (")
    '                                    Case 11
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case 13
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED5 = exists5 & " exists ( select * from " & dr.Item("FredTable") & " FF5 where enc." & lblFREDKey3.Text & " = FF5." & dr.Item("FREDConnect") & _
    '                                            "and " & tempFRED5 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                numbercheck = numbercheck & " where" & tempFRED1 & tempFRED2 & tempFRED3 & tempFRED4 & tempFRED5
    '                numbercheck = Mid(numbercheck, 1, Len(numbercheck) - 5)


    '                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

    '                    If conn.State = ConnectionState.Closed Then
    '                        conn.Open()
    '                    End If
    '                    Dim da As New SqlDataAdapter
    '                    cmd = New SqlCommand(numbercheck, conn)
    '                    da.SelectCommand = cmd
    '                    da.SelectCommand.CommandTimeout = 600
    '                    dr = cmd.ExecuteReader
    '                    While dr.Read
    '                        lblFredSelectCount3.Text = " (" & dr("cnt") & ")"
    '                    End While


    '                End Using

    '            Catch ex As Exception
    '                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
    '            End Try
    '        End If

    '        If lblFREDTable4.Text <> "" Then

    '            Try

    '                Dim numbercheck As String = "Select count(*) as cnt from " & lblFREDTable4.Text & " enc "
    '                Dim tempFRED1 As String = ""
    '                Dim tempFRED2 As String = ""
    '                Dim tempFRED3 As String = ""
    '                Dim tempFRED4 As String = ""
    '                Dim tempFRED5 As String = ""
    '                Dim exists1 As String = ""
    '                Dim exists2 As String = ""
    '                Dim exists3 As String = ""
    '                Dim exists4 As String = ""
    '                Dim exists5 As String = ""
    '                Dim temp As String
    '                Dim SQL As String

    '                If rblFREDFilter1.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption1.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter1.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " " & ddlFREDFilterOption1.Text & " '" & Replace(txtFREDFilter1.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter1.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTable4ID.Text Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                        Else


    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKey4.Text & " = FF1." & dr.Item("FREDConnect")
    '                                End While


    '                            End Using
    '                            tempFRED1 = " " & tempFRED1 & " and "

    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTable4ID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then

    '                            '    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '        SQL = "select " & _
    '                            '     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '     ",COLUMN_NAME as FREDConnect " & _
    '                            '     "from WebFD.FRED.vw_AvailableData " & _
    '                            '     "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '        If conn.State = ConnectionState.Closed Then
    '                            '            conn.Open()
    '                            '        End If
    '                            '        cmd = New SqlCommand(SQL, conn)
    '                            '        dr = cmd.ExecuteReader
    '                            '        While dr.Read
    '                            '            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKey4.Text & " = FF1." & dr.Item("FREDConnect")
    '                            '        End While


    '                            '    End Using
    '                            '    tempFRED1 = " " & tempFRED1 & " and "
    '                        Else

    '                            Select Case ddlFREDFilterOption1.SelectedIndex
    '                                Case 1
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " <> ", " = ")
    '                                Case 8
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not like '%", " like '%")
    '                                Case 9
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not in (", " in (")
    '                                Case 11
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case 13
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case Else
    '                            End Select

    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    tempFRED1 = exists1 & " exists ( select * from " & dr.Item("FredTable") & " FF1 where enc." & lblFREDKey4.Text & " = FF1." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED1 & ") and "
    '                                End While


    '                            End Using


    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter2.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption2.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter2.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " " & ddlFREDFilterOption2.Text & " '" & Replace(txtFREDFilter2.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter2.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTableTransID.Text Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter2.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED2 = Replace(tempFRED2, "FF2.", "FF1.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKeyTrans.Text & " = FF2." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED2 = " " & tempFRED2 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter2.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED2 = Replace(tempFRED3, "FF2.", "FF1.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKeyTrans.Text & " = FF2." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED2 = " " & tempFRED2 & " and "
    '                        Else
    '                            If rblFREDFilter2.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED2, "FF2", "FF1") & ") and "
    '                                        tempFRED2 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " <> ", " = ")
    '                                    Case 8
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not in (", " in (")
    '                                    Case 11
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case 13
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED2 = exists2 & " exists ( select * from " & dr.Item("FredTable") & " FF2 where enc." & lblFREDKeyTrans.Text & " = FF2." & dr.Item("FREDConnect") & _
    '                                            "and " & tempFRED2 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter3.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption3.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter3.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " " & ddlFREDFilterOption3.Text & " '" & Replace(txtFREDFilter3.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter3.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTableTransID.Text Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter3.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKeyTrans.Text & " = FF3." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED3 = " " & tempFRED3 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter3.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKeyTrans.Text & " = FF3." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED3 = " " & tempFRED3 & " and "
    '                        Else
    '                            If rblFREDFilter3.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED3, "FF3", "FF1") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter3.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED3, "FF3", "FF2") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " <> ", " = ")
    '                                    Case 8
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not in (", " in (")
    '                                    Case 11
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case 13
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED3 = exists3 & " exists ( select * from " & dr.Item("FredTable") & " FF3 where enc." & lblFREDKeyTrans.Text & " = FF3." & dr.Item("FREDConnect") & _
    '                                            "and " & tempFRED3 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter4.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption4.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter4.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED4 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED4 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED4.EndsWith(",") Then
    '                                tempFRED4 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " " & ddlFREDFilterOption4.Text & " '" & Replace(txtFREDFilter4.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter4.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTableTransID.Text Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter4.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF3.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKeyTrans.Text & " = FF4." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED4 = " " & tempFRED4 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter4.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF3.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKeyTrans.Text & " = FF4." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED4 = " " & tempFRED4 & " and "
    '                        Else
    '                            If rblFREDFilter4.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED4, "FF4", "FF1") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED4, "FF4", "FF2") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED4, "FF4", "FF3") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " <> ", " = ")
    '                                    Case 8
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not in (", " in (")
    '                                    Case 11
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case 13
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED4 = exists4 & " exists ( select * from " & dr.Item("FredTable") & " FF4 where enc." & lblFREDKeyTrans.Text & " = FF4." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED4 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter5.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption5.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter5.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " " & ddlFREDFilterOption5.Text & " '" & Replace(txtFREDFilter5.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter5.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTableTransID.Text Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter5.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                                Case rblFREDFilter4.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKeyTrans.Text & " = FF5." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED5 = " " & tempFRED5 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter5.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                            '        Case rblFREDFilter4.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKeyTrans.Text & " = FF5." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED5 = " " & tempFRED5 & " and "
    '                        Else
    '                            If rblFREDFilter5.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED5, "FF5", "FF1") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED5, "FF5", "FF2") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED5, "FF5", "FF3") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter4.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(tempFRED5, "FF5", "FF4") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " <> ", " = ")
    '                                    Case 8
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not in (", " in (")
    '                                    Case 11
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case 13
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED5 = exists5 & " exists ( select * from " & dr.Item("FredTable") & " FF5 where enc." & lblFREDKeyTrans.Text & " = FF5." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED5 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                numbercheck = numbercheck & " where" & tempFRED1 & tempFRED2 & tempFRED3 & tempFRED4 & tempFRED5
    '                numbercheck = Mid(numbercheck, 1, Len(numbercheck) - 5)


    '                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

    '                    If conn.State = ConnectionState.Closed Then
    '                        conn.Open()
    '                    End If
    '                    Dim da As New SqlDataAdapter
    '                    cmd = New SqlCommand(numbercheck, conn)
    '                    da.SelectCommand = cmd
    '                    da.SelectCommand.CommandTimeout = 600
    '                    dr = cmd.ExecuteReader
    '                    While dr.Read
    '                        lblFredSelectCount3.Text = " (" & dr("cnt") & ")"
    '                    End While


    '                End Using

    '            Catch ex As Exception
    '                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
    '            End Try
    '        End If

    '        If lblFREDTableTrans.Text <> "" And rblDataType.SelectedIndex = 1 Then


    '            Try

    '                Dim numbercheck As String = "Select count(*) as cnt from " & lblFREDTableTrans.Text & " enc "
    '                Dim tempFRED1 As String = ""
    '                Dim tempFRED2 As String = ""
    '                Dim tempFRED3 As String = ""
    '                Dim tempFRED4 As String = ""
    '                Dim tempFRED5 As String = ""
    '                Dim exists1 As String = ""
    '                Dim exists2 As String = ""
    '                Dim exists3 As String = ""
    '                Dim exists4 As String = ""
    '                Dim exists5 As String = ""
    '                Dim temp As String
    '                Dim SQL As String

    '                If rblFREDFilter1.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption1.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter1.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter1.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter1.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED1 = tempFRED1 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED1 = tempFRED1 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED1.EndsWith(",") Then
    '                                tempFRED1 = Mid(tempFRED1, 1, Len(tempFRED1) - 1)
    '                            End If
    '                            tempFRED1 = tempFRED1 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter1Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter1End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter1StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter1EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED1 = "FF1.[" & ddlFREDFilter1.SelectedValue & "]" & " " & ddlFREDFilterOption1.Text & " '" & Replace(txtFREDFilter1.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter1.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                        Else


    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKeyTrans.Text & " = FF1." & dr.Item("FREDConnect")
    '                                End While


    '                            End Using
    '                            tempFRED1 = " " & tempFRED1 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter1.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED1 = " " & Replace(tempFRED1, "FF1.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then

    '                            '    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '        SQL = "select " & _
    '                            '     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '     ",COLUMN_NAME as FREDConnect " & _
    '                            '     "from WebFD.FRED.vw_AvailableData " & _
    '                            '     "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '        If conn.State = ConnectionState.Closed Then
    '                            '            conn.Open()
    '                            '        End If
    '                            '        cmd = New SqlCommand(SQL, conn)
    '                            '        dr = cmd.ExecuteReader
    '                            '        While dr.Read
    '                            '            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF1 on enc." & lblFREDKeyTrans.Text & " = FF1." & dr.Item("FREDConnect")
    '                            '        End While


    '                            '    End Using
    '                            '    tempFRED1 = " " & tempFRED1 & " and "
    '                        Else

    '                            Select Case ddlFREDFilterOption1.SelectedIndex
    '                                Case 1
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " <> ", " = ")
    '                                Case 8
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not like '%", " like '%")
    '                                Case 9
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not in (", " in (")
    '                                Case 11
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case 13
    '                                    exists1 = " not "
    '                                    tempFRED1 = Replace(tempFRED1, " not between ", " between ")
    '                                Case Else
    '                            End Select

    '                            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                SQL = "select " & _
    '                             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                             ",COLUMN_NAME as FREDConnect " & _
    '                             "from WebFD.FRED.vw_AvailableData " & _
    '                             "where TABLE_ID  = " & rblFREDFilter1.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                If conn.State = ConnectionState.Closed Then
    '                                    conn.Open()
    '                                End If
    '                                Dim da As New SqlDataAdapter
    '                                cmd = New SqlCommand(SQL, conn)
    '                                da.SelectCommand = cmd
    '                                da.SelectCommand.CommandTimeout = 600
    '                                dr = cmd.ExecuteReader
    '                                While dr.Read
    '                                    tempFRED1 = exists1 & " exists ( select * from " & dr.Item("FredTable") & " FF1 where enc." & lblFREDKeyTrans.Text & " = FF1." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED1 & ") and "
    '                                End While


    '                            End Using


    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter2.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption2.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter2.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter2.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter2.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED2 = tempFRED2 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED2 = tempFRED2 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED2.EndsWith(",") Then
    '                                tempFRED2 = Mid(tempFRED2, 1, Len(tempFRED2) - 1)
    '                            End If
    '                            tempFRED2 = tempFRED2 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter2Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter2End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter2StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter2EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED2 = "FF2.[" & ddlFREDFilter2.SelectedValue & "]" & " " & ddlFREDFilterOption2.Text & " '" & Replace(txtFREDFilter2.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter2.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter2.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED2 = Replace(tempFRED2, "FF2.", "FF1.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKeyTrans.Text & " = FF2." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED2 = " " & tempFRED2 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter2.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED2 = " " & Replace(tempFRED2, "FF2.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter2.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED2 = Replace(tempFRED3, "FF2.", "FF1.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF2 on enc." & lblFREDKeyTrans.Text & " = FF2." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED2 = " " & tempFRED2 & " and "
    '                        Else
    '                            If rblFREDFilter2.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED2, "FF2", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED2 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED2, "FF2", "FF1") & ") and "
    '                                        tempFRED2 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption2.SelectedIndex
    '                                    Case 1
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " <> ", " = ")
    '                                    Case 8
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not in (", " in (")
    '                                    Case 11
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case 13
    '                                        exists2 = " not "
    '                                        tempFRED2 = Replace(tempFRED2, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter2.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED2 = exists2 & " exists ( select * from " & dr.Item("FredTable") & " FF2 where enc." & lblFREDKeyTrans.Text & " = FF2." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED2 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter3.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption3.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter3.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter3.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter3.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED3 = tempFRED3 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED3 = tempFRED3 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED3.EndsWith(",") Then
    '                                tempFRED3 = Mid(tempFRED3, 1, Len(tempFRED3) - 1)
    '                            End If
    '                            tempFRED3 = tempFRED3 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter3Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter3End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter3StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter3EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED3 = "FF3.[" & ddlFREDFilter3.SelectedValue & "]" & " " & ddlFREDFilterOption3.Text & " '" & Replace(txtFREDFilter3.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter3.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter3.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKeyTrans.Text & " = FF3." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED3 = " " & tempFRED3 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter3.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED3 = " " & Replace(tempFRED3, "FF3.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter3.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED3 = Replace(tempFRED3, "FF3.", "FF2.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF3 on enc." & lblFREDKeyTrans.Text & " = FF3." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED3 = " " & tempFRED3 & " and "
    '                        Else
    '                            If rblFREDFilter3.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED3, "FF3", "FF1") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter3.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED3, "FF3", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED3 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED3, "FF3", "FF2") & ") and "
    '                                        tempFRED3 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption3.SelectedIndex
    '                                    Case 1
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " <> ", " = ")
    '                                    Case 8
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not in (", " in (")
    '                                    Case 11
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case 13
    '                                        exists3 = " not "
    '                                        tempFRED3 = Replace(tempFRED3, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter3.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED3 = exists3 & " exists ( select * from " & dr.Item("FredTable") & " FF3 where enc." & lblFREDKeyTrans.Text & " = FF3." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED3 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter4.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption4.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter4.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter4.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter4.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED4 = tempFRED4 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED4 = tempFRED4 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED4.EndsWith(",") Then
    '                                tempFRED4 = Mid(tempFRED4, 1, Len(tempFRED4) - 1)
    '                            End If
    '                            tempFRED4 = tempFRED4 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter4Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter4End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter4StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter4EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED4 = "FF4.[" & ddlFREDFilter4.SelectedValue & "]" & " " & ddlFREDFilterOption4.Text & " '" & Replace(txtFREDFilter4.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter4.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter4.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED4 = Replace(tempFRED4, "FF4.", "FF3.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKeyTrans.Text & " = FF4." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED4 = " " & tempFRED4 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter4.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED4 = " " & Replace(tempFRED4, "FF4.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter4.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED4 = Replace(tempFRED5, "FF4.", "FF3.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF4 on enc." & lblFREDKeyTrans.Text & " = FF4." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using
    '                            '    End Select
    '                            '    tempFRED4 = " " & tempFRED4 & " and "
    '                        Else
    '                            If rblFREDFilter4.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED4, "FF4", "FF1") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED4, "FF4", "FF2") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter4.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED4, "FF4", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED4 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED4, "FF4", "FF3") & ") and "
    '                                        tempFRED4 = ""
    '                                End Select

    '                            Else
    '                                Select Case ddlFREDFilterOption4.SelectedIndex
    '                                    Case 1
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " <> ", " = ")
    '                                    Case 8
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not in (", " in (")
    '                                    Case 11
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case 13
    '                                        exists4 = " not "
    '                                        tempFRED4 = Replace(tempFRED4, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter4.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED4 = exists4 & " exists ( select * from " & dr.Item("FredTable") & " FF4 where enc." & lblFREDKeyTrans.Text & " = FF4." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED4 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                If rblFREDFilter5.SelectedIndex <> 0 Then

    '                    Select Case ddlFREDFilterOption5.SelectedIndex
    '                        Case 1 '<> 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " <> '" & Replace(txtFREDFilter5.Text, " '", "''") & "' "
    '                        Case 6 'like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"
    '                        Case 7 'contains AKA in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 8 'not like 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not like '%" & Replace(txtFREDFilter5.Text, "'", "''") & "%'"

    '                        Case 9 'not contains AKA not in 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not in ("
    '                            temp = Replace(txtFREDFilter5.Text, "'", "''")
    '                            Do While temp.Contains(",")
    '                                If InStr(temp, ",") > 0 Then
    '                                    tempFRED5 = tempFRED5 & "'" & Mid(temp, 1, InStr(temp, ",") - 1) & "',"
    '                                    temp = Mid(temp, InStr(temp, ",") + 1, Len(temp))
    '                                End If
    '                            Loop
    '                            If Len(temp) > 0 Then
    '                                tempFRED5 = tempFRED5 & "'" & temp & "'"
    '                            End If
    '                            If tempFRED5.EndsWith(",") Then
    '                                tempFRED5 = Mid(tempFRED5, 1, Len(tempFRED5) - 1)
    '                            End If
    '                            tempFRED5 = tempFRED5 & ") "
    '                            temp = ""
    '                        Case 10 'between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 11 'not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between  '" & Replace(numFREDFilter5Start.Text, "'", "''") & "' and '" & Replace(numFREDFilter5End.Text, "'", "''") & "'  "
    '                        Case 12 'Date between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 13 'Date not between 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " not between '" & Replace(dtpFREDFilter5StartDate.Text, "'", "''") & "' and '" & Replace(dtpFREDFilter5EndDate.Text, "'", "''") & "'  "
    '                        Case 14 'Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NULL "
    '                        Case 15 'Not Null 
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " is NOT NULL "
    '                        Case Else  '=,  <, <=, >, >=
    '                            tempFRED5 = "FF5.[" & ddlFREDFilter5.SelectedValue & "]" & " " & ddlFREDFilterOption5.Text & " '" & Replace(txtFREDFilter5.Text, "'", "''") & "' "

    '                    End Select

    '                    Dim EncTrans As DataRow
    '                    EncTrans = FilterSet.Tables(0).Rows(rblFREDFilter5.SelectedIndex)
    '                    If CInt(EncTrans("FREDType").ToString) = 0 Then
    '                        'Encounter Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                        Else
    '                            Select Case rblFREDFilter5.SelectedIndex
    '                                Case rblFREDFilter1.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                                Case rblFREDFilter2.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                                Case rblFREDFilter3.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                                Case rblFREDFilter4.SelectedIndex
    '                                    tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                                Case Else
    '                                    Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                        SQL = "select " & _
    '                                     "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                     ",COLUMN_NAME as FREDConnect " & _
    '                                     "from WebFD.FRED.vw_AvailableData " & _
    '                                     "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                        If conn.State = ConnectionState.Closed Then
    '                                            conn.Open()
    '                                        End If
    '                                        Dim da As New SqlDataAdapter
    '                                        cmd = New SqlCommand(SQL, conn)
    '                                        da.SelectCommand = cmd
    '                                        da.SelectCommand.CommandTimeout = 600
    '                                        dr = cmd.ExecuteReader
    '                                        While dr.Read
    '                                            numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKeyTrans.Text & " = FF5." & dr.Item("FREDConnect")
    '                                        End While


    '                                    End Using
    '                            End Select
    '                            tempFRED5 = " " & tempFRED5 & " and "
    '                        End If

    '                    Else
    '                        'Transaction Table
    '                        If CStr(rblFREDFilter5.SelectedValue) = lblFredTableTransID.Text And chbWhereExists.Checked = True Then
    '                            tempFRED5 = " " & Replace(tempFRED5, "FF5.", "enc.", , 1) & " and "
    '                            'ElseIf chbWhereExists.Checked = True Then
    '                            '    Select Case rblFREDFilter5.SelectedIndex
    '                            '        Case rblFREDFilter1.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF1.", , 1)
    '                            '        Case rblFREDFilter2.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF2.", , 1)
    '                            '        Case rblFREDFilter3.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF3.", , 1)
    '                            '        Case rblFREDFilter4.SelectedIndex
    '                            '            tempFRED5 = Replace(tempFRED5, "FF5.", "FF4.", , 1)
    '                            '        Case Else
    '                            '            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                            '                SQL = "select " & _
    '                            '             "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                            '             ",COLUMN_NAME as FREDConnect " & _
    '                            '             "from WebFD.FRED.vw_AvailableData " & _
    '                            '             "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                            '                If conn.State = ConnectionState.Closed Then
    '                            '                    conn.Open()
    '                            '                End If
    '                            '                cmd = New SqlCommand(SQL, conn)
    '                            '                dr = cmd.ExecuteReader
    '                            '                While dr.Read
    '                            '                    numbercheck = numbercheck & " join " & dr.Item("FredTable") & " FF5 on enc." & lblFREDKeyTrans.Text & " = FF5." & dr.Item("FREDConnect")
    '                            '                End While


    '                            '            End Using

    '                            '    End Select
    '                            '    tempFRED5 = " " & tempFRED5 & " and "
    '                        Else
    '                            If rblFREDFilter5.SelectedIndex = rblFREDFilter1.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption1.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF1"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED1 = Left(tempFRED1, Len(tempFRED1) - 6) & " and " & Replace(tempFRED5, "FF5", "FF1") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter2.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption2.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF2"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED2 = Left(tempFRED2, Len(tempFRED2) - 6) & " and " & Replace(tempFRED5, "FF5", "FF2") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter3.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption3.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF3"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED3 = Left(tempFRED3, Len(tempFRED3) - 6) & " and " & Replace(tempFRED5, "FF5", "FF3") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select
    '                            ElseIf rblFREDFilter5.SelectedIndex = rblFREDFilter4.SelectedIndex And notNumbers.Contains(ddlFREDFilterOption4.SelectedIndex) = notNumbers.Contains(ddlFREDFilterOption5.SelectedIndex) Then
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " <> ", " = ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 8
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not like '%", " like '%") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 9
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not in (", " in (") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 11
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case 13
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(Replace(tempFRED5, "FF5", "FF4"), " not between ", " between ") & ") and "
    '                                        tempFRED5 = ""
    '                                    Case Else
    '                                        tempFRED4 = Left(tempFRED4, Len(tempFRED4) - 6) & " and " & Replace(tempFRED5, "FF5", "FF4") & ") and "
    '                                        tempFRED5 = ""
    '                                End Select


    '                            Else
    '                                Select Case ddlFREDFilterOption5.SelectedIndex
    '                                    Case 1
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " <> ", " = ")
    '                                    Case 8
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not like '%", " like '%")
    '                                    Case 9
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not in (", " in (")
    '                                    Case 11
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case 13
    '                                        exists5 = " not "
    '                                        tempFRED5 = Replace(tempFRED5, " not between ", " between ")
    '                                    Case Else
    '                                End Select

    '                                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '                                    SQL = "select " & _
    '                                 "(TABLE_CATALOG + '.'+ TABLE_SCHEMA + '.' + TABLE_NAME) as FREDTable " & _
    '                                 ",COLUMN_NAME as FREDConnect " & _
    '                                 "from WebFD.FRED.vw_AvailableData " & _
    '                                 "where TABLE_ID  = " & rblFREDFilter5.SelectedValue.ToString & " and FREDConnect = 1 "

    '                                    If conn.State = ConnectionState.Closed Then
    '                                        conn.Open()
    '                                    End If
    '                                    Dim da As New SqlDataAdapter
    '                                    cmd = New SqlCommand(SQL, conn)
    '                                    da.SelectCommand = cmd
    '                                    da.SelectCommand.CommandTimeout = 600
    '                                    dr = cmd.ExecuteReader
    '                                    While dr.Read
    '                                        tempFRED5 = exists5 & " exists ( select * from " & dr.Item("FredTable") & " FF5 where enc." & lblFREDKeyTrans.Text & " = FF5." & dr.Item("FREDConnect") & _
    '                                            " and " & tempFRED5 & ") and "
    '                                    End While


    '                                End Using

    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                numbercheck = numbercheck & " where" & tempFRED1 & tempFRED2 & tempFRED3 & tempFRED4 & tempFRED5
    '                numbercheck = Mid(numbercheck, 1, Len(numbercheck) - 5)


    '                Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)

    '                    If conn.State = ConnectionState.Closed Then
    '                        conn.Open()
    '                    End If
    '                    Dim da As New SqlDataAdapter
    '                    cmd = New SqlCommand(numbercheck, conn)
    '                    da.SelectCommand = cmd
    '                    da.SelectCommand.CommandTimeout = 600
    '                    dr = cmd.ExecuteReader
    '                    While dr.Read
    '                        lblFredSelectCountTrans.Text = " (" & dr("cnt") & ")"
    '                    End While


    '                End Using

    '            Catch ex As Exception
    '                LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
    '            End Try
    '        End If
    '    Catch ex As Exception
    '        LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
    '    End Try
    'End Sub

    'Private Sub btnResetCount_Click(sender As Object, e As System.EventArgs) Handles btnResetCount.Click
    '    Try
    '        RecalculateNumbers()
    '    Catch ex As Exception
    '        LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
    '    End Try

    'End Sub

    'Private Sub Image1_Click(sender As Object, e As System.Web.UI.ImageClickEventArgs) Handles Image1.Click
    '    Try
    '        Dim ds As DataSet
    '        Dim da As New SqlDataAdapter
    '        ddlFREDTables.Visible = True


    '        SQL = "select distinct FREDType, Table_Alias, TABLE_ID from WebFD.FRED.vw_AvailableData where FREDType <> 0  order by 1 desc, 2   "


    '        Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
    '            If conn.State = ConnectionState.Closed Then
    '                conn.Open()
    '            End If
    '            ds = New DataSet
    '            cmd = New SqlCommand(SQL, conn)
    '            da.SelectCommand = cmd
    '            da.SelectCommand.CommandTimeout = 86400
    '            da.Fill(ds, "FRED")

    '            ddlFREDTables.DataSource = ds
    '            ddlFREDTables.DataMember = "FRED"
    '            ddlFREDTables.DataTextField = "Table_Alias"
    '            ddlFREDTables.DataValueField = "TABLE_ID"
    '            ddlFREDTables.DataBind()
    '        End Using

    '    Catch ex As Exception
    '    End Try


    '    ddlFREDTables.SelectedIndex = 0
    '    SetFREDSelectAccordion(ddlFREDTables.SelectedValue)
    '    acrFREDSelectTrans.Visible = False
    '    ddlFREDTables.Visible = False
    '    rblDataType.SelectedIndex = 0
    '    'FREDReportType(0)
    '    LoadFREDFreeFilters()

    '    ResetFREDFilters()
    '    'acrFREDSelect.
    '    'pnlEncounterChk



    '    RecalculateNumbers()

    'End Sub

    Private Sub imagebutton_Click(sender As Object, e As System.Web.UI.ImageClickEventArgs) Handles imagebutton.Click
        Try
            Dim ds As DataSet
            Dim da As New SqlDataAdapter
            ddlFREDTables.Visible = True


            SQL = "select distinct FREDType, Table_Alias, TABLE_ID from WebFD.FRED.vw_AvailableData where FREDType <> 0  order by 1 desc, 2   "


            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If
                ds = New DataSet
                cmd = New SqlCommand(SQL, conn)
                da.SelectCommand = cmd
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds, "FRED")

                ddlFREDTables.DataSource = ds
                ddlFREDTables.DataMember = "FRED"
                ddlFREDTables.DataTextField = "Table_Alias"
                ddlFREDTables.DataValueField = "TABLE_ID"
                ddlFREDTables.DataBind()
            End Using

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


        Try
            ddlFREDTables.SelectedIndex = 0
            SetFREDSelectAccordion(ddlFREDTables.SelectedValue)
            acrFREDSelectTrans.Visible = False
            ddlFREDTables.Visible = False
            rblDataType.SelectedIndex = 0
            FavoriteAccordion.SelectedIndex = -1
            'FREDReportType(0)
            LoadFREDFreeFilters()
            tblCount.Visible = False
            gvFREDData.Visible = False
            Colorlegend.Visible = False
            ResetFREDFilters()
            'acrFREDSelect.
            'pnlEncounterChk



            'RecalculateNumbers()
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


    End Sub

    Private Sub OkButtonexample_Click(sender As Object, e As System.EventArgs) Handles OkButtonexample.Click

        Try
            gvExample.Visible = False
            pnlExportExample.Visible = False
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try


    End Sub

    'Private Sub btnExportExample_Click(sender As Object, e As System.EventArgs) Handles btnExportExample.Click

    '    'Try
    '    '    ExportExample()
    '    'Catch ex As Exception
    '    '    LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
    '    'End Try

    '    rbltesting = rblExampleExportType.SelectedValue
    '    ModalPopupExtenderexample.Hide()
    '    'HiddenButton_Click()
    'End Sub
    Sub ExportExample()
        ' Try
        Dim ds As DataSet
        Dim da As SqlDataAdapter
        Dim FileName As String = "FRED_" & Replace(qr("FREDTable").ToString, ".", "_") & "_" & Replace(qr("FREDConnect").ToString, ".", "_")


        'SQL3 = "select  * from WebFD.FREDTemp." & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "_" & timestamp
        SQL3 = "Select distinct [" & qr("FREDConnect").ToString & "] from " & qr("FREDTable").ToString
        Dim exampleinfo As New DataSet

        If Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") = "" Then
            Exit Sub
        End If



        If rbltesting = 0 Then

            Dim dtcsv As DataTable = GetDataForCSV()

            Response.Clear()
            Response.ContentType = "text/csv"
            Response.AddHeader("content-disposition", "attachment;filename=FRED_COLUMN_FILE.csv")

            Dim sb As New StringBuilder()
            For i As Integer = 0 To dtcsv.Columns.Count - 1
                sb.Append(Replace(dtcsv.Columns(i).ColumnName, "CarriageReturn", " ") + ",")
            Next
            sb.Append(Environment.NewLine)

            For j As Integer = 0 To dtcsv.Rows.Count - 1
                For k As Integer = 0 To dtcsv.Columns.Count - 1
                    sb.Append(dtcsv.Rows(j)(k).ToString() + ",")
                Next
                sb.Append(Environment.NewLine)
            Next



            Response.Write(sb.ToString())
            Response.End()

        ElseIf rbltesting = 1 Then
            'If chbExcel2007.Checked = True Then
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                ds = New DataSet

                da = New SqlDataAdapter(SQL3, conn)
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(ds)
            End Using

            ''Dim ds2 As New DataSet
            ''ds2.Tables.Add()

            ''ds.Tables(0).Rows(1).Item(0) = Replace(ds.Tables(0).Rows(1).Item(0), "CarriageReturn", " ")
            'For ta As Integer = 1 To ds.Tables(0).Rows(1).ItemArray.Count()
            '    ds.Tables(0).Rows(1).Item(ta) = Replace(ds.Tables(0).Rows(1).Item(ta), "CarriageReturn", " ")
            'Next


            Dim filepath As String = "C:\Users\" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "\Downloads\" & FileName & ".xlsx"
            If File.Exists(filepath) Then
                File.Delete(filepath)
            End If

            'CreateExcelFile.CreateExcelDocument(ds, "C:\TEMP\FREDDUMP\" & FileName & ".xlsx")
            CreateExcelFile.CreateExcelDocument(ds, "C:\Users\" & Replace(Request.ServerVariables("AUTH_USER"), "NS\", "") & "\Downloads\" & FileName & ".xlsx")

            Dim buffer As Byte() = Nothing
            'Dim filepath As String = "C:\TEMP\FREDDUMP\" & FileName & ".xlsx"

            FileName = FileName & ".xlsx"
            If Not ReadByteStreamFromFileAndOutput(buffer, filepath) Then
                Return
            End If
            Response.ClearContent()
            Response.ClearHeaders()
            Response.ContentType = "application/octet-stream"

            Response.AddHeader("Content-disposition", "attachment; filename=" & FileName)
            Response.BinaryWrite(buffer)

            Response.Flush()
            Response.Close()

            Exit Sub
        Else
            Dim dt As New DataTable
            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                ds = New DataSet

                da = New SqlDataAdapter(SQL3, conn)
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(dt)
                dt.TableName = "DEMO"
            End Using

            'SAVE THIS CODE UNTIL THIS PART IS COMPLETE, THIS IS A BACK UP OF THE WORKING EXPORT
            Dim attachment As String = "attachment; filename=" & FileName & ".xls"
            Response.ClearContent()
            Response.AddHeader("content-disposition", attachment)
            Response.ContentType = "application/vnd.ms-excel"

            Dim tab As String = ""
            For Each dc As DataColumn In dt.Columns
                Response.Write(tab + dc.ColumnName)
                tab = vbTab
            Next
            Response.Write(vbLf)

            Dim i As Integer
            For Each dr As DataRow In dt.Rows
                tab = ""
                For i = 0 To dt.Columns.Count - 1
                    Response.Write(tab & dr(i).ToString())
                    tab = vbTab
                Next
                Response.Write(vbLf)
            Next
            Response.End()
        End If

      

   

            'Catch ex As Exception
            'LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            ' End Try
    End Sub
    Sub CreateColorPalette()



        Try
            Dim colorsql As String
            colorsql = "SELECT  [Table_Alias], [GridColor] " & _
            "FROM [WebFD].[FRED].[AvailableTables]"

            Palette = New DataTable
            Dim da As New SqlDataAdapter

            Using conn As New SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                If conn.State = ConnectionState.Closed Then
                    conn.Open()
                End If

                da = New SqlDataAdapter(colorsql, conn)
                da.SelectCommand.CommandTimeout = 86400
                da.Fill(Palette)
                Palette.TableName = "ColorPalette"
            End Using

        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try

    End Sub
    Sub ApplyPalette()

        Try

            If rblDataType.SelectedIndex = 0 Then
                clRow1.Visible = False
            Else
                clRow1.Visible = True
            End If

            For Each colorselect As DataRow In Palette.Rows
                If clText1.Text = colorselect("Table_Alias") And IsDBNull(colorselect("GridColor")) = False Then
                    clColor1.BackColor = System.Drawing.ColorTranslator.FromHtml("#" & colorselect("GridColor").ToString)
                End If
                If clText2.Text = colorselect("Table_Alias") Then
                    If Not IsDBNull(colorselect("GridColor")) Then
                        clColor2.BackColor = System.Drawing.ColorTranslator.FromHtml("#" & colorselect("GridColor").ToString)
                    End If
                    clRow2.Visible = True
                End If
                If clText3.Text = colorselect("Table_Alias") Then
                    If Not IsDBNull(colorselect("GridColor")) Then
                        clColor3.BackColor = System.Drawing.ColorTranslator.FromHtml("#" & colorselect("GridColor").ToString)
                    End If
                    clRow3.Visible = True
                End If
                If clText4.Text = colorselect("Table_Alias") Then
                    If Not IsDBNull(colorselect("GridColor")) Then
                        clColor4.BackColor = System.Drawing.ColorTranslator.FromHtml("#" & colorselect("GridColor").ToString)
                    End If
                    clRow4.Visible = True
                End If
                If clText5.Text = colorselect("Table_Alias") Then
                    If Not IsDBNull(colorselect("GridColor")) Then
                        clColor5.BackColor = System.Drawing.ColorTranslator.FromHtml("#" & colorselect("GridColor").ToString)
                    End If
                    clRow5.Visible = True
                End If
            Next
        Catch ex As Exception
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
        End Try
    End Sub


    Private Sub HiddenButton_Click() Handles HiddenButton.Click
        rbltesting = rblExampleExportType.SelectedValue

        If rbltesting < 4 Then
            ExportExample()
        End If
        rbltesting = 4
    End Sub

    Private Sub lbTableExample1_Click(sender As Object, e As System.EventArgs) Handles lbTableExample1.Click

        Dim example As String = "Select top 25 * from " & lblFREDTable1.Text
        Dim da As SqlDataAdapter
        Dim exampleinfo As New DataSet

        Try

            Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                da = New SqlDataAdapter(example, conn2)
                da.Fill(exampleinfo, "DEMO")
                gvFREDData.DataSource = exampleinfo
                gvFREDData.DataMember = "DEMO"
                gvFREDData.DataBind()
                gvFREDData.Visible = True
                Colorlegend.Visible = False
                tblCount.Visible = False

            End Using

        Catch ex As Exception
            explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            ModalPopupExtenderexample.Show()
        End Try

    End Sub
    Private Sub lbTableExample2_Click(sender As Object, e As System.EventArgs) Handles lbTableExample2.Click

        Dim example As String = "Select top 25 * from " & lblFREDTable2.Text
        Dim da As SqlDataAdapter
        Dim exampleinfo As New DataSet

        Try

            Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                da = New SqlDataAdapter(example, conn2)
                da.Fill(exampleinfo, "DEMO")
                gvFREDData.DataSource = exampleinfo
                gvFREDData.DataMember = "DEMO"
                gvFREDData.DataBind()
                gvFREDData.Visible = True
                Colorlegend.Visible = False
                tblCount.Visible = False

            End Using

        Catch ex As Exception
            explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            ModalPopupExtenderexample.Show()
        End Try

    End Sub
    Private Sub lbTableExample3_Click(sender As Object, e As System.EventArgs) Handles lbTableExample3.Click

        Dim example As String = "Select top 25 * from " & lblFREDTable3.Text
        Dim da As SqlDataAdapter
        Dim exampleinfo As New DataSet

        Try

            Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                da = New SqlDataAdapter(example, conn2)
                da.Fill(exampleinfo, "DEMO")
                gvFREDData.DataSource = exampleinfo
                gvFREDData.DataMember = "DEMO"
                gvFREDData.DataBind()
                gvFREDData.Visible = True
                Colorlegend.Visible = False
                tblCount.Visible = False

            End Using

        Catch ex As Exception
            explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            ModalPopupExtenderexample.Show()
        End Try

    End Sub
    Private Sub lbTableExample4_Click(sender As Object, e As System.EventArgs) Handles lbTableExample4.Click

        Dim example As String = "Select top 25 * from " & lblFREDTable4.Text
        Dim da As SqlDataAdapter
        Dim exampleinfo As New DataSet

        Try

            Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                da = New SqlDataAdapter(example, conn2)
                da.Fill(exampleinfo, "DEMO")
                gvFREDData.DataSource = exampleinfo
                gvFREDData.DataMember = "DEMO"
                gvFREDData.DataBind()
                gvFREDData.Visible = True
                Colorlegend.Visible = False
                tblCount.Visible = False

            End Using

        Catch ex As Exception
            explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            ModalPopupExtenderexample.Show()
        End Try

    End Sub
    Private Sub lbTableExampleTrans_Click(sender As Object, e As System.EventArgs) Handles lbTableExampleTrans.Click

        Dim example As String = "Select top 25 * from " & lblFREDTableTrans.Text
        Dim da As SqlDataAdapter
        Dim exampleinfo As New DataSet

        Try

            Using conn2 As New System.Data.SqlClient.SqlConnection(ConfigurationManager.ConnectionStrings("PRDconn").ConnectionString)
                da = New SqlDataAdapter(example, conn2)
                da.Fill(exampleinfo, "DEMO")
                gvFREDData.DataSource = exampleinfo
                gvFREDData.DataMember = "DEMO"
                gvFREDData.DataBind()
                gvFREDData.Visible = True
                Colorlegend.Visible = False
                tblCount.Visible = False

            End Using

        Catch ex As Exception
            explantionlabelexample.Text = "Error pulling example data -- please report to Admin."
            LogWebFinError(Replace(Request.ServerVariables("AUTH_USER"), "NS\", ""), Request.ServerVariables("HTTP_X_FORWARDED_FOR"), Request.ServerVariables("REMOTE_ADDR"), System.Reflection.MethodBase.GetCurrentMethod().ReflectedType.Name, System.Reflection.MethodBase.GetCurrentMethod.Name(), ex.ToString())
            ModalPopupExtenderexample.Show()
        End Try

    End Sub
End Class
